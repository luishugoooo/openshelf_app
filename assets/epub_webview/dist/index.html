<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <title>EPUB Reader</title>

    <style>
      body {
        margin: 0;
        padding: 0;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
      }

      #reader {
        width: 100%;
        height: 100%;
      }
    </style>
    <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();var Pt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function be(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var de={exports:{}},Ne={exports:{}},Re,Dn;function Ai(){if(Dn)return Re;Dn=1;var p=void 0;return Re=function(t){return t!==p&&t!==null},Re}var Oe,Ln;function Pr(){if(Ln)return Oe;Ln=1;var p=Ai(),t={object:!0,function:!0,undefined:!0};return Oe=function(e){return p(e)?hasOwnProperty.call(t,typeof e):!1},Oe}var De,zn;function Br(){if(zn)return De;zn=1;var p=Pr();return De=function(t){if(!p(t))return!1;try{return t.constructor?t.constructor.prototype===t:!1}catch{return!1}},De}var Le,Pn;function jr(){if(Pn)return Le;Pn=1;var p=Br();return Le=function(t){if(typeof t!="function"||!hasOwnProperty.call(t,"length"))return!1;try{if(typeof t.length!="number"||typeof t.call!="function"||typeof t.apply!="function")return!1}catch{return!1}return!p(t)},Le}var ze,Bn;function Mr(){if(Bn)return ze;Bn=1;var p=jr(),t=/^\s*class[\s{/}]/,e=Function.prototype.toString;return ze=function(n){return!(!p(n)||t.test(e.call(n)))},ze}var Pe,jn;function Fr(){return jn||(jn=1,Pe=function(){var p=Object.assign,t;return typeof p!="function"?!1:(t={foo:"raz"},p(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}),Pe}var Be,Mn;function Ur(){return Mn||(Mn=1,Be=function(){try{return Object.keys("primitive"),!0}catch{return!1}}),Be}var je,Fn;function Wr(){return Fn||(Fn=1,je=function(){}),je}var Me,Un;function wn(){if(Un)return Me;Un=1;var p=Wr()();return Me=function(t){return t!==p&&t!==null},Me}var Fe,Wn;function qr(){if(Wn)return Fe;Wn=1;var p=wn(),t=Object.keys;return Fe=function(e){return t(p(e)?Object(e):e)},Fe}var Ue,qn;function Hr(){return qn||(qn=1,Ue=Ur()()?Object.keys:qr()),Ue}var We,Hn;function Vr(){if(Hn)return We;Hn=1;var p=wn();return We=function(t){if(!p(t))throw new TypeError("Cannot use null or undefined");return t},We}var qe,Vn;function Zr(){if(Vn)return qe;Vn=1;var p=Hr(),t=Vr(),e=Math.max;return qe=function(n,i){var r,s,o=e(arguments.length,2),a;for(n=Object(t(n)),a=function(c){try{n[c]=i[c]}catch(m){r||(r=m)}},s=1;s<o;++s)i=arguments[s],p(i).forEach(a);if(r!==void 0)throw r;return n},qe}var He,Zn;function Yr(){return Zn||(Zn=1,He=Fr()()?Object.assign:Zr()),He}var Ve,Yn;function $r(){if(Yn)return Ve;Yn=1;var p=wn(),t=Array.prototype.forEach,e=Object.create,n=function(i,r){var s;for(s in i)r[s]=i[s]};return Ve=function(i){var r=e(null);return t.call(arguments,function(s){p(s)&&n(Object(s),r)}),r},Ve}var Ze,$n;function Gr(){if($n)return Ze;$n=1;var p="razdwatrzy";return Ze=function(){return typeof p.contains!="function"?!1:p.contains("dwa")===!0&&p.contains("foo")===!1},Ze}var Ye,Gn;function Xr(){if(Gn)return Ye;Gn=1;var p=String.prototype.indexOf;return Ye=function(t){return p.call(this,t,arguments[1])>-1},Ye}var $e,Xn;function Kr(){return Xn||(Xn=1,$e=Gr()()?String.prototype.contains:Xr()),$e}var Kn;function Jr(){if(Kn)return Ne.exports;Kn=1;var p=Ai(),t=Mr(),e=Yr(),n=$r(),i=Kr(),r=Ne.exports=function(s,o){var a,c,m,l,b;return arguments.length<2||typeof s!="string"?(l=o,o=s,s=null):l=arguments[2],p(s)?(a=i.call(s,"c"),c=i.call(s,"e"),m=i.call(s,"w")):(a=m=!0,c=!1),b={value:o,configurable:a,enumerable:c,writable:m},l?e(n(l),b):b};return r.gs=function(s,o,a){var c,m,l,b;return typeof s!="string"?(l=a,a=o,o=s,s=null):l=arguments[3],p(o)?t(o)?p(a)?t(a)||(l=a,a=void 0):a=void 0:(l=o,o=a=void 0):o=void 0,p(s)?(c=i.call(s,"c"),m=i.call(s,"e")):(c=!0,m=!1),b={get:o,set:a,configurable:c,enumerable:m},l?e(n(l),b):b},Ne.exports}var Ge,Jn;function Qr(){return Jn||(Jn=1,Ge=function(p){if(typeof p!="function")throw new TypeError(p+" is not a function");return p}),Ge}var Qn;function ts(){return Qn||(Qn=1,function(p,t){var e=Jr(),n=Qr(),i=Function.prototype.apply,r=Function.prototype.call,s=Object.create,o=Object.defineProperty,a=Object.defineProperties,c=Object.prototype.hasOwnProperty,m={configurable:!0,enumerable:!1,writable:!0},l,b,f,v,d,y,w;l=function(E,T){var A;return n(T),c.call(this,"__ee__")?A=this.__ee__:(A=m.value=s(null),o(this,"__ee__",m),m.value=null),A[E]?typeof A[E]=="object"?A[E].push(T):A[E]=[A[E],T]:A[E]=T,this},b=function(E,T){var A,k;return n(T),k=this,l.call(this,E,A=function(){f.call(k,E,A),i.call(T,this,arguments)}),A.__eeOnceListener__=T,this},f=function(E,T){var A,k,z,D;if(n(T),!c.call(this,"__ee__"))return this;if(A=this.__ee__,!A[E])return this;if(k=A[E],typeof k=="object")for(D=0;z=k[D];++D)(z===T||z.__eeOnceListener__===T)&&(k.length===2?A[E]=k[D?0:1]:k.splice(D,1));else(k===T||k.__eeOnceListener__===T)&&delete A[E];return this},v=function(E){var T,A,k,z,D;if(c.call(this,"__ee__")&&(z=this.__ee__[E],!!z))if(typeof z=="object"){for(A=arguments.length,D=new Array(A-1),T=1;T<A;++T)D[T-1]=arguments[T];for(z=z.slice(),T=0;k=z[T];++T)i.call(k,this,D)}else switch(arguments.length){case 1:r.call(z,this);break;case 2:r.call(z,this,arguments[1]);break;case 3:r.call(z,this,arguments[1],arguments[2]);break;default:for(A=arguments.length,D=new Array(A-1),T=1;T<A;++T)D[T-1]=arguments[T];i.call(z,this,D)}},d={on:l,once:b,off:f,emit:v},y={on:e(l),once:e(b),off:e(f),emit:e(v)},w=a({},y),p.exports=t=function(E){return E==null?s(w):a(Object(E),y)},t.methods=d}(de,de.exports)),de.exports}var es=ts();const Bt=be(es),_n=()=>{let p=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=(p+Math.random()*16)%16|0;return p=Math.floor(p/16),(e=="x"?n:n&7|8).toString(16)})},ns=()=>Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight),is=p=>!!(p&&p.nodeType==Node.ELEMENT_NODE),Ft=p=>!isNaN(parseFloat(p))&&isFinite(p),Ni=p=>{const t=parseFloat(p);return Ft(p)===!1?!1:typeof p=="string"&&p.indexOf(".")>-1?!0:Math.floor(t)!==t},Ri=p=>{const t=["Webkit","webkit","Moz","O","ms"],e=["-webkit-","-webkit-","-moz-","-o-","-ms-"],n=p.toLowerCase(),i=t.length;if(typeof document>"u"||typeof document.body.style[n]<"u")return p;for(let r=0;r<i;r++)if(typeof document.body.style[e[r]+n]<"u")return e[r]+n;return p},Oi=(p,...t)=>{for(let e=1,n=t.length;e<n;e++){const i=t[e];for(const r in i)p[r]===void 0&&(p[r]=i[r])}return p},Ut=(p,...t)=>(t.forEach(e=>{e&&Object.getOwnPropertyNames(e).forEach(n=>{Object.defineProperty(p,n,Object.getOwnPropertyDescriptor(e,n))})}),p),ie=(p,t,e,n,i)=>{const r=n||0,s=i||t.length,o=parseInt(r+(s-r)/2);if(e||(e=(c,m)=>{if(c>m)return 1;if(c<m)return-1;if(c==m)return 0}),s-r<=0)return o;const a=e(t[o],p);return s-r===1?a>=0?o:o+1:a===0?o:a===-1?ie(p,t,e,o,s):ie(p,t,e,r,o)},rs=(p,t,e)=>{const n=ie(p,t,e);return t.splice(n,0,p),n},ge=(p,t,e,n,i)=>{const r=n||0,s=i||t.length,o=parseInt(r+(s-r)/2);if(e||(e=(c,m)=>{if(c>m)return 1;if(c<m)return-1;if(c==m)return 0}),s-r<=0)return-1;const a=e(t[o],p);return s-r===1?a===0?o:-1:a===0?o:a===-1?ge(p,t,e,o,s):ge(p,t,e,r,o)},ss=p=>{const t=window.getComputedStyle(p),e=["width","paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],n=["height","paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],i={height:0,width:0};return e.forEach(r=>{i.width+=parseFloat(t[r])||0}),n.forEach(r=>{i.height+=parseFloat(t[r])||0}),i},Di=p=>{const t=window.getComputedStyle(p),e=["paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],n=["paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],i={height:0,width:0};return e.forEach(r=>{i.width+=parseFloat(t[r])||0}),n.forEach(r=>{i.height+=parseFloat(t[r])||0}),i},pn=p=>{let t;const e=p.ownerDocument;if(p.nodeType==Node.TEXT_NODE){const n=e.createRange();n.selectNodeContents(p),t=n.getBoundingClientRect()}else t=p.getBoundingClientRect();return t},os=()=>{const p=window.innerWidth,t=window.innerHeight;return{top:0,left:0,right:p,bottom:t,width:p,height:t}},we=(p,t)=>{const n=p.parentNode.childNodes;let i=-1;for(let r=0;r<n.length;r++){const s=n[r];if(s.nodeType===t&&i++,s==p)break}return i},as=p=>we(p,Node.TEXT_NODE),hs=p=>we(p,Node.ELEMENT_NODE),_e=p=>["xml","opf","ncx"].indexOf(p)>-1,Li=(p,t)=>new Blob([p],{type:t}),En=(p,t)=>{const e=Li(p,t);return URL.createObjectURL(e)},zi=p=>URL.revokeObjectURL(p),ls=(p,t)=>{if(typeof p!="string")return;const e=btoa(p);return"data:"+t+";base64,"+e},cs=p=>Object.prototype.toString.call(p).slice(8,-1),Gt=(p,t)=>(p.charCodeAt(0)===65279&&(p=p.slice(1)),new DOMParser().parseFromString(p,t)),Tt=(p,t)=>{if(!p)throw new Error("No Element Provided");if(typeof p.querySelector<"u")return p.querySelector(t);{const e=p.getElementsByTagName(t);if(e.length)return e[0]}},re=(p,t)=>typeof p.querySelector<"u"?p.querySelectorAll(t):p.getElementsByTagName(t),Pi=(p,t,e)=>{if(typeof p.querySelector<"u"){t+="[";for(const n in e)t+=n+"~='"+e[n]+"'";return t+="]",p.querySelector(t)}else{const n=p.getElementsByTagName(t),i=Array.prototype.slice.call(n,0).filter(r=>{for(const s in e)if(r.getAttribute(s)===e[s])return!0;return!1});if(i)return i[0]}},Bi=(p,t)=>{typeof(p.ownerDocument||p).createTreeWalker<"u"?ji(p,t,NodeFilter.SHOW_TEXT):xn(p,n=>{n&&n.nodeType===Node.TEXT_NODE&&t(n)})},ji=(p,t,e)=>{const n=document.createTreeWalker(p,e,null,!1);let i;for(;i=n.nextNode();)t(i)},xn=(p,t)=>{if(t(p))return!0;if(p=p.firstChild,p)do{if(xn(p,t))return!0;p=p.nextSibling}while(p);return!1},Mi=p=>new Promise((t,e)=>{const n=new FileReader;n.readAsDataURL(p),n.onloadend=()=>{t(n.result)}}),us=(p,t,e)=>{let n;if(typeof p.querySelector<"u"&&(n=p.querySelector(`${t}[*|type="${e}"]`)),!n||n.length===0){n=re(p,t);for(let i=0;i<n.length;i++)if(n[i].getAttributeNS("http://www.idpf.org/2007/ops","type")===e||n[i].getAttribute("epub:type")===e)return n[i]}else return n},mn=p=>{const t=[],e=p.childNodes;for(let n=0;n<e.length;n++){const i=e[n];i.nodeType===Node.ELEMENT_NODE&&t.push(i)}return t},gn=p=>{const t=[p];for(;p;p=p.parentNode)t.unshift(p);return t},kn=(p,t,e)=>{const n=[],i=p.childNodes;for(let r=0;r<i.length;r++){const s=i[r];if(s.nodeType===Node.ELEMENT_NODE&&s.nodeName.toLowerCase()===t){if(e)return s;n.push(s)}}if(!e)return n},fs=(p,t)=>{if(p===null||t==="")return;let e=p.parentNode;for(;e.nodeType===Node.ELEMENT_NODE;){if(e.tagName.toLowerCase()===t)return e;e=e.parentNode}},ds=Object.freeze(Object.defineProperty({__proto__:null,blob2base64:Mi,borders:Di,bounds:ss,createBase64Url:ls,createBlob:Li,createBlobUrl:En,defaults:Oi,documentHeight:ns,extend:Ut,filterChildren:kn,findChildren:mn,getParentByTagName:fs,indexOfElementNode:hs,indexOfNode:we,indexOfSorted:ge,indexOfTextNode:as,insert:rs,isElement:is,isFloat:Ni,isNumber:Ft,isXml:_e,locationOf:ie,nodeBounds:pn,parents:gn,parse:Gt,prefixed:Ri,qs:Tt,qsa:re,qsp:Pi,querySelectorByType:us,revokeBlobUrl:zi,sprint:Bi,treeWalker:ji,type:cs,uuid:_n,walk:xn,windowBounds:os},Symbol.toStringTag,{value:"Module"}));class Et{constructor(){this.id=_n(),this.dump={},this.resolve=null,this.reject=null,this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}destroy(){Object.keys(this).forEach(t=>this[t]=void 0)}}class Yt{constructor(t){t.indexOf("://")>-1&&(t=new URL(t).pathname);const e=this.parse(t);this.directory=e.dir+"/",this.filename=e.base,this.extension=e.ext.slice(1),this.path=t}parse(t){const e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;const n=this.splitPath(t);if(!n||n.length!==4)throw new Error(`Invalid path: ${t}`);return e.root=n[0],this.isDirectory(t)?e.dir=n[0]+n[1]+n[2]:(e.dir=n[0]+n[1].slice(0,-1),e.base=n[2],e.ext=n[3],e.name=n[2].slice(0,n[2].length-n[3].length)),e}dirname(t){const e=this.splitPath(t),n=e[0],i=e[1];return!n&&!i?".":n+i}isAbsolute(t){return t.charAt(0)==="/"}isDirectory(t){return t.charAt(t.length-1)==="/"}resolve(){let t="",e=!1;for(let n=arguments.length-1;n>=-1&&!e;n--){let i;n>=0?i=arguments[n]:i="/",i.length!==0&&(t=i+"/"+t,e=this.isAbsolute(i))}return t=this.normalizeArray(t.split("/"),!e).join("/"),(e?"/":"")+t||"."}relative(t,e){if(t===e||(t=this.resolve(t),e=this.resolve(e),t===e))return"";const n=this.trimArray(t.split("/")),i=this.trimArray(e.split("/")),r=Math.min(n.length,i.length);let s=r;for(let a=0;a<r;a++)if(n[a]!==i[a]){s=a;break}let o=[];for(let a=s;a<n.length;a++)o.push("..");return o=o.concat(i.slice(s)),o.join("/")}normalize(t){const e=this.isAbsolute(t),n=t&&t[t.length-1]==="/";return t=this.normalizeArray(t.split("/"),!e).join("/"),!t&&!e&&(t="."),t&&n&&(t+="/"),(e?"/":"")+t}toString(){return this.path}normalizeArray(t,e){const n=[];for(let i=0;i<t.length;i++){const r=t[i];!r||r==="."||(r===".."?n.length&&n[n.length-1]!==".."?n.pop():e&&n.push(".."):n.push(r))}return n}splitPath(t){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1)}trimArray(t){const e=t.length-1;let n=0;for(;n<=e&&!t[n];n++);let i=e;for(;i>=0&&!t[i];i--);return n===0&&i===e?t:n>i?[]:t.slice(n,i+1)}}class Qt{constructor(t,e){this.Url=void 0,this.href=t,this.protocol="",this.origin="",this.hash="",this.hash="",this.search="",this.base=e;const n=t.indexOf("://")>-1;!n&&e!==!1&&typeof e!="string"&&window&&window.location&&(this.base=window.location.href);let i=t;if(n||this.base){try{this.base?this.Url=new URL(t,this.base):this.Url=new URL(t),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,i=this.Url.pathname+(this.Url.search?this.Url.search:"")}catch(r){this.Url=void 0,this.base&&(i=new Yt(this.base).resolve(i)),console.error(r)}this.origin==="null"&&this.protocol==="file:"&&(this.origin="file://")}this.path=new Yt(i),this.directory=this.path.directory,this.filename=this.path.filename,this.extension=this.path.extension}resolve(t){if(t.indexOf("://")>-1)return t;const e=this.path.directory,n=Yt.prototype.resolve(e,t);return this.origin+n}relative(t){const e=this.path.directory;return Yt.prototype.relative(t,e)}toString(){return this.href}}class ps{constructor(){this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}setStart(t,e){this.startContainer=t,this.startOffset=e,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}setEnd(t,e){this.endContainer=t,this.endOffset=e,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}collapse(t){this.collapsed=!0,t?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}selectNode(t){const e=t.parentNode,n=Array.prototype.indexOf.call(e.childNodes,t);this.setStart(e,n),this.setEnd(e,n+1)}selectNodeContents(t){const e=t.nodeType===Node.TEXT_NODE?t.textContent.length:parent.childNodes.length;this.setStart(t,0),this.setEnd(t,e)}_commonAncestorContainer(t,e){const n=gn(t||this.startContainer),i=gn(e||this.endContainer);if(n[0]==i[0]){for(let r=0;r<n.length;r++)if(n[r]!=i[r])return n[r-1]}}_checkCollapsed(){this.startContainer===this.endContainer&&this.startOffset===this.endOffset?this.collapsed=!0:this.collapsed=!1}toString(){}}class vt{constructor(t,e,n){this.base={},this.hash="",this.ignoreClass="",this.path={},this.range=!1,this.spinePos=0,this.start=null,this.end=null,this.type=void 0,this.set({data:t,base:e,ignoreClass:n})}set(t){let e,n,i,r;const s=c=>{n||(typeof c=="string"?(this.base=this.parseComponent(c),this.spinePos=this.base.steps[1].index):typeof c=="object"&&c.steps&&(this.base=c),n=this.base)},o=c=>{i||(typeof c=="string"&&(this.ignoreClass=c),i=this.ignoreClass)},a=c=>{if(!e){if(r=r||this.checkType(c),r==="string")e=this.parse(c);else if(r==="range")e=this.fromRange(c,n,i);else if(r==="node")e=this.fromNode(c,n,i);else if(r==="EpubCFI")e=c;else if(!c)e=this;else throw new TypeError("not a valid argument for EpubCFI");e.type=r||this.type}};return Object.keys(t).forEach(c=>{const m=t[c];this[c]===m||typeof m>"u"?delete t[c]:c==="data"?(s(t.base),o(t.ignoreClass),a(m)):c==="base"?(s(m),o(t.ignoreClass),a(t.data)):c==="ignoreClass"&&(s(t.base),o(m),a(t.data))}),e?Object.assign(this,e):this}checkType(t){if(!(typeof t>"u"))return this.isCfiString(t)?"string":typeof t=="object"?t instanceof Range||typeof t.startContainer<"u"?"range":t instanceof Node?"node":t instanceof vt?"EpubCFI":void 0:void 0}collapse(t){this.range!==!1&&(t?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal),this.range=!1)}compare(t,e){if(typeof t=="string"&&(t=new vt(t)),typeof e=="string"&&(e=new vt(e)),t.spinePos>e.spinePos)return 1;if(t.spinePos<e.spinePos)return-1;let n,i;t.range?(n=t.path.steps.concat(t.start.steps),i=t.start.terminal):(n=t.path.steps,i=t.path.terminal);let r,s;e.range?(r=e.path.steps.concat(e.start.steps),s=e.start.terminal):(r=e.path.steps,s=e.path.terminal);for(let o=0;o<n.length;o++){if(!n[o])return-1;if(!r[o]||n[o].index>r[o].index)return 1;if(n[o].index<r[o].index)return-1}return n.length<r.length?-1:i.offset>s.offset?1:i.offset<s.offset?-1:0}generateChapterComponent(t,e,n){const i=parseInt(e);let s="/"+(t+1)*2+"/";return s+=(i+1)*2,n&&(s+="["+n+"]"),s}getBaseComponent(t){return t.split("!")[0]}getPathComponent(t){const e=t.split("!");if(e[1])return e[1].split(",")[0]}getRange(t){const e=t.split(",");return e.length===3?[e[1],e[2]]:null}getCharacterOffsetComponent(t){return t.split(":")[1]||""}isCfiString(t){return typeof t=="string"&&t.indexOf("epubcfi(")===0&&t[t.length-1]===")"}joinSteps(t){return t?t.map(e=>{let n="";return e.type==="element"&&(n+=(e.index+1)*2),e.type==="text"&&(n+=1+2*e.index),e.id&&(n+="["+e.id+"]"),n}).join("/"):""}pathTo(t,e,n){const i={steps:[],terminal:{offset:null,assertion:null}};let r,s=t;for(;s&&s.parentNode&&s.parentNode.nodeType!==Node.DOCUMENT_NODE;)n?r=this.filteredStep(s,n):r=this.step(s),r&&i.steps.unshift(r),s=s.parentNode;if(e!==null&&e>=0){i.terminal.offset=e;const o=i.steps.length,a=o&&o-1,c=a?i.steps[a].type:null;c&&c!=="text"&&i.steps.push({index:0,type:"text"})}return i}equalStep(t,e){return!!(t&&e&&t.id===e.id&&t.index===e.index&&t.type===e.type)}filter(t,e){let n,i,r;if(t.nodeType===Node.TEXT_NODE?(i=!0,n=t.parentNode,r=t.parentNode.classList.contains(e)):(i=!1,r=t.classList.contains(e)),r&&i){const s=n.previousSibling,o=n.nextSibling;let a;return s&&s.nodeType===Node.TEXT_NODE?a=s:o&&o.nodeType===Node.TEXT_NODE&&(a=o),a||t}else return r&&!i?null:t}filteredPosition(t,e){let n,i;t.nodeType===Node.ELEMENT_NODE?(n=t.parentNode.children,i=this.normalizedMap(n,Node.ELEMENT_NODE,e)):(n=t.parentNode.childNodes,t.parentNode.classList.contains(e)&&(t=t.parentNode,n=t.parentNode.childNodes),i=this.normalizedMap(n,Node.TEXT_NODE,e));const r=Array.prototype.indexOf.call(n,t);return i[r]}filteredStep(t,e){const n=this.filter(t,e);if(n!==null)return{id:n.id,index:this.filteredPosition(n,e),tagName:n.tagName,type:n.nodeType===Node.TEXT_NODE?"text":"element"}}findNode(t,e,n){const i=e||document;let r;if(n)r=this.walkToNode(t,i,n);else if(typeof i.evaluate<"u"){const s=this.stepsToXpath(t),o=XPathResult.FIRST_ORDERED_NODE_TYPE;r=i.evaluate(s,i,null,o,null).singleNodeValue}else r=this.walkToNode(t,i);return r}fixMiss(t,e,n,i){let r=this.findNode(t.slice(0,-1),n,i);const s=r.childNodes,o=t[t.length-1].index,a=this.normalizedMap(s,Node.TEXT_NODE,i);for(const c in a){if(!a.hasOwnProperty(c))return;if(a[c]===o){const m=s[c],l=m.textContent.length;if(e>l)e=e-l;else{m.nodeType===Node.ELEMENT_NODE?r=m.childNodes[0]:r=m;break}}}return{container:r,offset:e}}fromNode(t,e,n){const i=new vt;return typeof e=="string"?(i.base=this.parseComponent(e),i.spinePos=i.base.steps[1].index):typeof e=="object"&&(i.base=e),i.path=this.pathTo(t,null,n),i}fromRange(t,e,n){const i=new vt,r=t.startContainer,s=t.endContainer;let o=t.startOffset,a=t.endOffset,c=!1;const m=r.ownerDocument;n&&(c=m.querySelector("."+n)!==null),typeof e=="string"?(i.base=this.parseComponent(e),i.spinePos=i.base.steps[1].index):typeof e=="object"&&(i.base=e);const l=()=>{c&&(o=this.patchOffset(r,o,n))};if(t.collapsed)l(),i.path=this.pathTo(r,o,n);else{i.range=!0,l(),i.start=this.pathTo(r,o,n),c&&(a=this.patchOffset(s,a,n)),i.end=this.pathTo(s,a,n),i.path={steps:[],terminal:null};for(let b=0,f=i.start.steps.length;b<f&&this.equalStep(i.start.steps[b],i.end.steps[b]);b++)b===f-1?i.start.terminal===i.end.terminal&&(i.path.steps.push(i.start.steps[b]),i.range=!1):i.path.steps.push(i.start.steps[b]);i.start.steps=i.start.steps.slice(i.path.steps.length),i.end.steps=i.end.steps.slice(i.path.steps.length)}return i}normalizedMap(t,e,n){const i={};let r=-1,s,o;for(let a=0,c=t.length;a<c;a++)s=t[a].nodeType,s===Node.ELEMENT_NODE&&t[a].classList.contains(n)&&(s=Node.TEXT_NODE),a>0&&s===Node.TEXT_NODE&&o===Node.TEXT_NODE?i[a]=r:e===s&&(r=r+1,i[a]=r),o=s;return i}parse(t){const e=new vt;if(typeof t!="string")throw new TypeError("invalid argument type");if(this.isCfiString(t))e.hash=t,e.type="string",t=t.slice(8,t.length-1);else throw new Error("invalid EpubCFI string format");const n=this.getBaseComponent(t);if(!n)return e.spinePos=-1,e;e.base=this.parseComponent(n);const i=this.getPathComponent(t);e.path=this.parseComponent(i);const r=this.getRange(t);return r&&(e.range=!0,e.start=this.parseComponent(r[0]),e.end=this.parseComponent(r[1])),e.spinePos=e.base.steps[1].index,e}parseComponent(t){const e={steps:[],terminal:{offset:null,assertion:null}},n=t.split(":"),i=n[0].split("/");return n.length>1&&(e.terminal=this.parseTerminal(n[1])),i[0]===""&&i.shift(),e.steps=i.map(r=>this.parseStep(r)),e}parseStep(t){const e=parseInt(t);if(isNaN(e))return;const n=e%2===0,i=t.match(/\[(.*)\]/);return{id:i&&i[1]?i[1]:null,index:n?e/2-1:(e-1)/2,type:n?"element":"text"}}parseTerminal(t){const e=t.match(/\[(.*)\]/),n=e&&e[1],i=n?t.split("[")[0]:t,r=parseInt(i);return{assertion:n?e[1]:null,offset:Ft(r)?r:null}}patchOffset(t,e,n){if(t.nodeType!==Node.TEXT_NODE)throw new Error("Anchor must be a text node");let i=t,r=e;for(t.parentNode.classList.contains(n)&&(i=t.parentNode);i.previousSibling;){if(i.previousSibling.nodeType===Node.ELEMENT_NODE)if(i.previousSibling.classList.contains(n))r+=i.previousSibling.textContent.length;else break;else r+=i.previousSibling.textContent.length;i=i.previousSibling}return r}position(t){let e,n;return t.nodeType===Node.ELEMENT_NODE?(e=t.parentNode.children,e||(e=mn(t.parentNode)),n=Array.prototype.indexOf.call(e,t)):(e=this.textNodes(t.parentNode),n=e.indexOf(t)),n}segmentString(t){let e="/";return e+=this.joinSteps(t.steps),t.terminal&&t.terminal.offset!==null&&(e+=":"+t.terminal.offset),t.terminal&&t.terminal.assertion!==null&&(e+="["+t.terminal.assertion+"]"),e}step(t){return{id:t.id,index:this.position(t),tagName:t.tagName,type:t.nodeType===Node.TEXT_NODE?"text":"element"}}stepsToXpath(t){const e=[".","*"];return t.forEach(n=>{const i=n.index+1;n.id?e.push("*[position()="+i+" and @id='"+n.id+"']"):n.type==="text"?e.push("text()["+i+"]"):e.push("*["+i+"]")}),e.join("/")}stepsToQuerySelector(t){const e=["html"];return t.forEach(n=>{const i=n.index+1;n.id?e.push("#"+n.id):n.type==="text"||e.push("*:nth-child("+i+")")}),e.join(">")}textNodes(t,e){return Array.prototype.slice.call(t.childNodes).filter(n=>n.nodeType===Node.TEXT_NODE?!0:!!n.classList.contains(e))}toRange(t,e){const n=t||document;let i,r,s,o,a,c,m,l,b;const v=e&&n.querySelector("."+e)!==null?e:void 0;if(typeof n.createRange<"u"?l=n.createRange():l=new ps,this.range?(i=this.start,a=this.path.steps.concat(i.steps),s=this.findNode(a,n,v),r=this.end,c=this.path.steps.concat(r.steps),o=this.findNode(c,n,v)):(i=this.path,a=this.path.steps,s=this.findNode(a,n,v)),s)try{m=i.terminal.offset!==null,l.setStart(s,m?i.terminal.offset:0)}catch(d){b=this.fixMiss(a,i.terminal.offset,n,v),l.setStart(b.container,b.offset),console.warn(d)}else throw new Error("No startContainer found for",this.toString());if(o)try{m=r.terminal.offset!==null,l.setEnd(o,m?r.terminal.offset:0)}catch(d){b=this.fixMiss(c,this.end.terminal.offset,n,v),l.setEnd(b.container,b.offset),console.warn(d)}return l}toString(){let t="epubcfi(";return t+=this.segmentString(this.base),t+="!",t+=this.segmentString(this.path),this.range&&this.start&&(t+=",",t+=this.segmentString(this.start)),this.range&&this.end&&(t+=",",t+=this.segmentString(this.end)),t+=")",t}walkToNode(t,e,n){const i=e||document;let r=i.documentElement;for(let s=0,o=t.length;s<o;s++){const a=t[s];if(a.type==="element"?a.id?r=i.getElementById(a.id):r=(r.children||mn(r))[a.index]:a.type==="text"&&(r=this.textNodes(r,n)[a.index]),!r)break}return r}destroy(){Object.keys(this).forEach(t=>this[t]=void 0)}}class Xe{constructor(){this.cfi=null,this.index=0,this.percentage=0}set(t){return Ut(this,t||{}),this}destroy(){Object.keys(this).forEach(t=>this[t]=void 0)}}class Sn extends Array{constructor(t){super(),this.context=t,this.running=!1,this.paused=!1}enqueue(t,...e){let n;if(typeof t=="function"){const i=new Et,r=i.promise;n={task:t,args:e,deferred:i,promise:r}}else n={promise:t};return this.push(n),this.paused===!1&&!this.running&&this.run(),n.promise}dequeue(){let t;if(this.length&&!this.paused){t=this.shift();const e=t.task;if(e){const n=e.apply(this.context,t.args);return n&&typeof n.then=="function"?n.then(i=>{t.deferred.resolve(i)},i=>{t.deferred.reject(i)}):(t.deferred.resolve(n),t.promise)}else if(t.promise)return t.promise}else return t=new Et,t.deferred.resolve(),t.promise}dump(){for(;this.length;)this.dequeue()}run(){return this.running===!1&&(this.running=!0,this.deferred=new Et),requestAnimationFrame(()=>{this.length?this.dequeue().then(()=>{this.run()}):(this.deferred.resolve(),this.running=!1)}),this.paused&&(this.paused=!1),this.deferred.promise}clear(){this.splice(0)}pause(){this.paused=!0}stop(){this.splice(0),this.running=!1,this.paused=!0}destroy(){this.splice(0),this.running=void 0,this.paused=void 0}}const Ee="0.3.96",vn=["keydown","keyup","keypressed","mouseup","mousedown","mousemove","click","touchend","touchstart","touchmove"],ot={BOOK:{OPEN_FAILED:"openFailed"},CONTENTS:{EXPAND:"expand",RESIZED:"resized",SELECTED:"selected",SELECTED_RANGE:"selectedRange",LINK_CLICKED:"linkClicked"},LOCATIONS:{CHANGED:"changed"},MANAGERS:{RESIZED:"resized",ADDED:"added",SCROLL:"scroll",SCROLLED:"scrolled",REMOVED:"removed",RELOCATED:"relocated"},VIEWS:{WRITING_MODE:"writingMode",LOAD_ERROR:"loaderror",RENDERED:"rendered",RESIZED:"resized",DISPLAYED:"displayed",SHOWN:"shown",HIDDEN:"hidden",MARK_CLICKED:"markClicked"},RENDITION:{STARTED:"started",ATTACHED:"attached",DISPLAYED:"displayed",DISPLAY_ERROR:"displayerror",RENDERED:"rendered",REMOVED:"removed",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",RELOCATED:"relocated",MARK_CLICKED:"markClicked",SELECTED:"selected",LAYOUT:"layout"},LAYOUT:{UPDATED:"updated"},ANNOTATION:{ATTACH:"attach",DETACH:"detach"},THEMES:{SELECTED:"selected",INJECTED:"injected",REJECTED:"rejected"},VIEWPORT:{RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange"}};class Fi extends Map{constructor(t,e,n){super(),this.sections=t,this.request=e,this.pause=n||100,this.break=150,this.processing=new Et,this.current=new Xe,this.generated=this.processing.promise,this.q=new Sn(this)}async generate(t){return Number.isInteger(t)?this.break=t:(this.break=parseInt(t),console.warn("The input value type is not an integer")),this.q.pause(),this.sections.forEach(e=>{e.linear&&this.q.enqueue(this.process.bind(this),e)}),this.q.run().then(()=>{const e=this.size===1?1:this.size-1,n=[...this.values()];return n.forEach((i,r)=>{i.index=r,i.percentage=r/e}),this.size&&this.current.set(n[0]),this.processing.resolve(this),this})}createRange(){return{startContainer:void 0,startOffset:void 0,endContainer:void 0,endOffset:void 0}}async process(t){return t.load(this.request).then(e=>this.parse(e,t.cfiBase))}async parse(t,e,n){n=n||this.break;let i,r=0,s;const o=m=>{const l=new Et;if(m.textContent.trim().length===0)return l.resolve(!1),l.promise;r==0&&(i=this.createRange(),i.startContainer=m,i.startOffset=0);const b=m.length;let f=n-r,v=0;for(f>b&&(r+=b,v=b);v<b;)if(f=n-r,r===0&&(v+=1,i=this.createRange(),i.startContainer=m,i.startOffset=v),v+f>=b)r+=b-v,v=b;else{v+=f,i.endContainer=m,i.endOffset=v;const d=new vt(i,e).toString(),y=new Xe().set({cfi:d});this.set(d,y),r=0}return s=m,l.resolve(!0),l.promise},a=t.ownerDocument,c=Tt(a,"body");return this.treeWalker(c,o).then(()=>{if(i&&i.startContainer&&s){i.endContainer=s,i.endOffset=s.length;const m=new vt(i,e).toString(),l=new Xe().set({cfi:m});this.set(m,l),r=0}return this})}treeWalker(t,e){const n=NodeFilter.SHOW_TEXT,i=document.createTreeWalker(t,n),r=[];for(;i.nextNode();)r.push(e(i.currentNode));return Promise.all(r)}locationFromCfi(t){if(this.size===0)return-1;const e=new vt(t),n=[...this.keys()],i=ie(e,n,e.compare),r=this.size-1;return i>r?-1:i}percentageFromCfi(t){if(this.size===0)return 0;const e=this.locationFromCfi(t);return this.percentageFromLocation(e)}percentageFromLocation(t){if(this.size===0||this.size>=t&&t<0)return 0;const e=this.size===1?1:this.size-1;return t/e}cfiFromLocation(t){return this.size===0||this.size>=t&&t<0?null:[...this.keys()][t]}cfiFromPercentage(t){let e,n=this.size-1;if(t>=0&&t<=1){const i=Math.round(n*t);e=this.cfiFromLocation(i)}else{const i=new vt([...this.keys()][n]);i.collapse(),e=i.toString(),console.warn("Recommended a normalize value to between 0 - 1")}return e}load(t){if(typeof t=="string"){this.clear();const e=JSON.parse(t);e.items.forEach(n=>this.set(n.cfi,n)),this.break=e.break,this.pause=e.pause,this.current.set(this.get(e.idref))}else console.error("Invalid argument type");return this}save(){return JSON.stringify({items:[...this.values()],idref:this.current.cfi,break:this.break,pause:this.pause})}set(t){if(arguments.length===2)return super.set(arguments[0],arguments[1]),this;if(this.size===0)return this;if(Object.keys(t||{}).forEach(e=>{const n=t[e];if(this.current[e]===n||typeof n>"u")delete t[e];else if(typeof n=="string"){if(e==="cfi"&&vt.prototype.isCfiString(n)){const i=this.locationFromCfi(n),r=[...this.values()][i];r?this.current.set(r):delete t[e]}}else if(typeof n=="number"){if(e==="index"){const i=this.cfiFromLocation(n),r=this.get(i);r?this.current.set(r):delete t[e]}else if(e==="percentage"){const i=this.cfiFromPercentage(n),r=this.get(i);r?this.current.set(r):delete t[e]}}else throw new Error("Invalid value type to "+e)}),Object.keys(t||{}).length){const{...e}=this.current;this.emit(ot.LOCATIONS.CHANGED,e,t)}return this}clear(){super.clear(),this.current.cfi=null,this.current.index=-1,this.current.percentage=0}destroy(){this.clear(),this.pause=void 0,this.break=void 0,this.current&&this.current.destroy(),this.current=void 0,this.q.stop(),this.q=void 0,this.generated=void 0}}Bt(Fi.prototype);class ms{constructor(){this.directory="",this.fullPath="",this.encoding="",this.mediaType="",this.version=""}clear(){this.directory="",this.fullPath="",this.encoding="",this.mediaType="",this.version=""}parse(t){if(!t)throw new Error("Container File Not Found");const e=Tt(t,"container");if(!e)throw new Error("container node not found");const n=Tt(t,"rootfile");if(!n)throw new Error("rootfile node not found");return this.fullPath=n.getAttribute("full-path"),this.directory=Yt.prototype.dirname(this.fullPath),this.encoding=t.characterSet,this.mediaType=n.getAttribute("media-type"),this.version=e.getAttribute("version"),Promise.resolve(this)}load(t){return Object.keys(t).forEach(e=>{switch(e){case"directory":this.directory=t[e];break;case"encoding":this.encoding=t[e];break;case"full-path":this.fullPath=t[e];break;case"media-type":this.mediaType=t[e];break;case"version":this.version=t[e];break}}),Promise.resolve(this)}destroy(){this.directory=void 0,this.encoding=void 0,this.fullPath=void 0,this.mediaType=void 0,this.version=void 0}}class gs extends Map{constructor(){super(),this.cover=null}parse(t){return[...t.children].forEach(n=>{if(n.nodeName==="meta")this.parseMeta(n);else if(/dc:/.test(n.nodeName)){const i=n.nodeName.substring(3);this.set(i,n.textContent)}}),Promise.resolve(this)}parseMeta(t){const e=t.getAttribute("name"),n=t.getAttribute("property");if(typeof n>"u"||typeof n!="string")e==="cover"&&(this.cover=t);else if(/rendition:/.test(n)){const i=n.substring(10);this.set(i,t.textContent)}else if(/dcterms:/.test(n)){const i=n.substring(8);this.set(i,t.textContent)}else/media:/.test(n)&&this.set(n,t.textContent)}load(t){return Object.keys(t).forEach(e=>{this.set(e,t[e])}),Promise.resolve(this)}destroy(){this.clear(),this.cover=void 0}}class vs extends Map{constructor(){super(),this.navPath=null,this.coverPath=null}clear(){super.clear(),this.navPath=null,this.coverPath=null}parse(t){return[...t.children].forEach(n=>{const i=n.getAttribute("properties"),r={id:n.getAttribute("id"),href:n.getAttribute("href")||"","media-type":n.getAttribute("media-type")||"","media-overlay":n.getAttribute("media-overlay")||"",properties:i?i.split(" "):[]};this.set(r.id,r),this.navPath===null&&(i==="nav"||r["media-type"]==="application/x-dtbncx+xml")&&(this.navPath=r.href),this.coverPath===null&&i==="cover-image"&&(this.coverPath=r.href)}),this.coverPath===null&&(this.coverPath=this.findCoverPath(t)),Promise.resolve(this)}findCoverPath(t){const e=t.ownerDocument,n=Pi(e,"meta",{name:"cover"});if(n){const i=n.getAttribute("content"),r=e.getElementById(i);return r?r.getAttribute("href"):null}return null}load(t){return t.forEach(e=>{for(const n of e.properties)switch(n){case"nav":this.navPath=e.href;break;case"cover-image":this.coverPath=e.href;break}this.set(e.id,e)}),Promise.resolve(this)}destroy(){this.clear(),this.navPath=void 0,this.coverPath=void 0}}class ys extends Map{constructor(){super(),this.nodeIndex=0}clear(){super.clear(),this.nodeIndex=0}parse(t){return[...t.children].forEach((n,i)=>{const r=n.getAttribute("idref"),s=n.getAttribute("properties"),o={id:n.getAttribute("id"),idref:r,index:i,linear:n.getAttribute("linear")||"yes",properties:s?s.split(" "):[]};this.set(r,o)}),this.nodeIndex=we(t,Node.ELEMENT_NODE),Promise.resolve(this)}load(t){return t.forEach((e,n)=>{this.set(e.idref,{id:e.id||null,idref:e.idref,index:n,linear:e.linear,properties:e.properties})}),this.nodeIndex=0,Promise.resolve(this)}destroy(){this.clear(),this.nodeIndex=void 0}}class bs{constructor(){this.metadata=new gs,this.manifest=new vs,this.spine=new ys,this.direction=null,this.version=null,this.uniqueIdentifier=null}clear(){this.metadata.clear(),this.manifest.clear(),this.spine.clear(),this.direction=null,this.version=null,this.uniqueIdentifier=null}async parse(t){if(!t)throw new Error("Package File Not Found");const e=Tt(t,"metadata");if(!e)throw new Error("No Metadata Found");const n=Tt(t,"manifest");if(!n)throw new Error("No Manifest Found");const i=Tt(t,"spine");if(!i)throw new Error("No Spine Found");const r=[];return r.push(this.metadata.parse(e)),r.push(this.manifest.parse(n)),r.push(this.spine.parse(i)),this.direction=this.parseDirection(t,i),this.version=this.parseVersion(t),this.uniqueIdentifier=this.metadata.get("identifier"),typeof this.uniqueIdentifier>"u"&&(this.uniqueIdentifier=this.findUniqueIdentifier(t)),Promise.all(r).then(()=>this)}parseDirection(t,e){let i=t.documentElement.getAttribute("dir");return i===null&&(i=e.getAttribute("page-progression-direction")),i||""}parseVersion(t){return t.documentElement.getAttribute("version")||""}findUniqueIdentifier(t){const n=t.documentElement.getAttribute("unique-identifier");if(!n)return"";const i=t.getElementById(n);return i&&i.localName==="identifier"&&i.namespaceURI==="http://purl.org/dc/elements/1.1/"&&i.childNodes.length>0?i.childNodes[0].nodeValue.trim():""}async load(t){const e=[];return e.push(this.metadata.load(t.metadata)),e.push(this.manifest.load(t.manifest)),e.push(this.spine.load(t.spine)),this.direction=t.direction,this.version=t.version,this.uniqueIdentifier=this.metadata.get("identifier"),Promise.all(e).then(()=>this)}destroy(){this.metadata.destroy(),this.manifest.destroy(),this.spine.destroy(),this.metadata=void 0,this.manifest=void 0,this.spine=void 0,this.direction=void 0,this.version=void 0,this.uniqueIdentifier=void 0}}class ws extends Map{constructor(){super()}parse(t){return Array.isArray(t)?this.load(t):t.nodeName==="nav"&&this.parseNav(t),new Promise((e,n)=>{e(this)})}parseNav(t){(t?re(t,"li"):[]).forEach(n=>{const i=this.navItem(n);i&&this.set(i.type,i)})}navItem(t){const e=kn(t,"a",!0);if(!e)return null;const n=e.getAttribute("epub:type"),i=e.getAttribute("href")||"";return n?{type:n,href:i,label:e.textContent||""}:null}load(t){t.forEach(e=>{this.set(e.type,e)})}destroy(){this.clear()}}class _s extends Array{constructor(){super(),this.epubcfi=new vt,this.pages=[],this.locations=[],this.firstPage=0,this.lastPage=0,this.totalPages=0}parse(t){return Array.isArray(t)?this.load(t):t.nodeName==="nav"?this.parseNav(t):t.nodeName==="pageList"&&this.parseNcx(t),this.length&&this.process(),new Promise((e,n)=>{e(this)})}parseNav(t){(t?re(t,"li"):[]).forEach(n=>{this.push(this.navItem(n))})}navItem(t){const e=Tt(t,"a"),n=e.getAttribute("href")||"",i=e.textContent||"",r=parseInt(i);if(n.indexOf("epubcfi")!==-1){const s=n.split("#");return{cfi:s.length>1?s[1]:null,packageUrl:s[0],href:n,page:r}}else return{href:n,page:r}}parseNcx(t){(re(t,"pageTarget")||[]).forEach(n=>{this.push(this.ncxItem(n))})}ncxItem(t){const e=Tt(t,"navLabel"),i=Tt(e,"text").textContent;return{href:Tt(t,"content").getAttribute("src"),page:parseInt(i,10)}}process(){this.forEach(t=>{this.pages.push(t.page),t.cfi&&this.locations.push(t.cfi)},this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}pageFromCfi(t){if(this.locations.length===0)return-1;let e,n=ge(t,this.locations,this.epubcfi.compare);return n!=-1?e=this.pages[n]:(n=ie(t,this.locations,this.epubcfi.compare),e=n-1>=0?this.pages[n-1]:this.pages[0],e!==void 0||(e=-1)),e}cfiFromPage(t){typeof t!="number"&&(t=parseInt(t));const e=this.pages.indexOf(t);let n=null;return e!==-1&&(n=this.locations[e]),n}pageFromPercentage(t){return Math.round(this.totalPages*t)}percentageFromPage(t){const e=(t-this.firstPage)/this.totalPages;return Math.round(e*1e3)/1e3}percentageFromCfi(t){const e=this.pageFromCfi(t);return this.percentageFromPage(e)}load(t){t.forEach(e=>{this.push(e)})}clear(){this.length&&(this.splice(0),this.pages.splice(0),this.locations.splice(0),this.firstPage=0,this.lastPage=0,this.totalPages=0)}destroy(){this.clear(),this.pages=void 0,this.locations=void 0,this.firstPage=void 0,this.lastPage=void 0,this.totalPages=void 0,this.epubcfi=void 0}}class Es extends Array{constructor(){super(),this.links=new Map}get(t){const e=t.split("/"),n=e.length?e[e.length-1]:t;return this.links.get(t)||this.links.get(n)}parse(t){return Array.isArray(t)?this.load(t):t.nodeName==="nav"?this.parseNav(t):t.nodeName==="navMap"&&this.parseNcx(t),new Promise(e=>{e(this)})}parseNav(t,e=null,n=null){const i=kn(t,"ol",!0);if(!i||!i.children)return;const r=i.children.length,s=e||this;for(let o=0;o<r;o++){const a=i.children[o];if(a.nodeName!=="li")continue;const c=this.navItem(a,i);c&&(c.parentId=n,s.push(c),this.parseNav(a,c.subitems,c.id))}}navItem(t){const e=Tt(t,"a")||Tt(t,"span");if(!e)return null;const n=e.getAttribute("href"),i=n.split("#"),r=i.length===2?i[1]:"",s=t.getAttribute("id")||r||n,o=e.textContent||"",a={id:s,href:n,bind:i[0],label:o,parentId:null,subitems:[]};return this.links.set(n,a),a}parseNcx(t,e=null,n=null){if(!t.children)return;const i=t.children.length,r=e||this;for(let s=0;s<i;++s){const o=t.children[s];if(o.nodeName!=="navPoint")continue;const a=this.ncxItem(o);a.parentId=n,r.push(a),this.parseNcx(o,a.subitems,a.id)}}ncxItem(t){const e=Tt(t,"content"),n=Tt(t,"navLabel"),i=e.getAttribute("src"),r=i.split("#"),s=r.length===2?r[1]:"",o=t.getAttribute("id")||s||i,a=n.textContent||"",c={id:o,href:i,bind:r[0],label:a,parentId:null,subitems:[]};return this.links.set(i,c),c}load(t,e=0,n=null){e+=1,t.forEach(i=>{const r=i.href,s=r.split("#"),o=s.length===2?s[1]:"";i.id=i.id||o||r,i.bind=s[0],i.parentId=n,e===1&&this.push(i),this.links.set(r,i),this.load(i.subitems,e,i.id)})}clear(){this.length&&(this.links.clear(),this.splice(0))}destroy(){this.clear(),this.links=void 0}}class xs{constructor(){this.landmarks=new ws,this.pageList=new _s,this.toc=new Es}clear(){this.landmarks.clear(),this.pageList.clear(),this.toc.clear()}async parse(t){const e=[],n=t.documentElement;return n.tagName==="html"?re(t,"nav").forEach(r=>{switch(r.getAttribute("epub:type")){case"landmarks":e.push(this.landmarks.parse(r));break;case"page-list":e.push(this.pageList.parse(r));break;case"toc":e.push(this.toc.parse(r));break}}):n.tagName==="ncx"&&[...n.children].forEach(r=>{switch(r.tagName){case"navMap":e.push(this.toc.parse(r));break;case"pageList":e.push(this.pageList.parse(r));break}}),Promise.all(e).then(()=>this)}async load(t){const e=[];return e.push(this.landmarks.parse(t.landmarks||[])),e.push(this.pageList.parse(t["page-list"]||[])),e.push(this.toc.parse(t.toc||[])),Promise.all(e).then(()=>this)}forEach(...t){this.toc.forEach(...t)}destroy(){this.clear(),this.landmarks.destroy(),this.landmarks=void 0,this.pageList.destroy(),this.pageList=void 0,this.toc.destroy(),this.toc=void 0}}const ti=(p,t)=>{if(!p)return;let e=Tt(p,"head"),n=Tt(e,"base");n||(n=p.createElement("base"),e.insertBefore(n,e.firstChild));let i=t.url;i.indexOf("://")>-1||(i=new URL(i,p.baseURI).href),n.setAttribute("href",i)},ei=(p,t)=>{if(!p)return;let e=t.canonical,n=Tt(p,"head"),i=Tt(n,"link[rel='canonical']");i?i.setAttribute("href",e):(i=p.createElement("link"),i.setAttribute("rel","canonical"),i.setAttribute("href",e),n.appendChild(i))},ni=(p,t)=>{if(!p)return;let e=Tt(p,"head"),n=Tt(e,"link[property='dc.identifier']");n?n.setAttribute("content",t.idref):(n=p.createElement("meta"),n.setAttribute("name","dc.identifier"),n.setAttribute("content",t.idref),e.appendChild(n))},ks=(p,t)=>{const e=p.querySelectorAll("a[href]");if(!e.length)return;const n=i=>{const r=i.getAttribute("href");r.indexOf("mailto:")!==0&&(r.indexOf("://")>-1?i.setAttribute("target","_blank"):i.onclick=s=>(t(r),!1))};for(let i=0;i<e.length;i++)n(e[i])},Ss=(p,t)=>{const e=p.split("/");let n="";for(let i=1;i<e.length;++i)n+="../";return n+t},Ts=(p,t,e,n)=>(e.forEach((i,r)=>{i&&n[r]&&(i=Ss(t.href,i),i=i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),p=p.replace(new RegExp(i,"g"),n[r]))}),p),he={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd","opf","ncx"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},text:{"cache-manifest":["manifest","appcache"],css:"css",csv:"csv",html:["html","htm","shtml","stm"],mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},Cs=(()=>{const p={};for(const t in he)if(he.hasOwnProperty(t)){for(const e in he[t])if(he[t].hasOwnProperty(e)){const n=he[t][e];if(typeof n=="string")p[n]=t+"/"+e;else for(let i=0;i<n.length;i++)p[n[i]]=t+"/"+e}}return p})(),Is="text/plain",As=p=>{let t;if(p){const e=p.split(".").pop().toLowerCase();t=Cs[e]}return t||Is},ne={lookup:As};class Ns extends Map{constructor(t,e,n){super(),this.archive=void 0,this.storage=void 0,this.request=t,this.resolve=e,this.replacements=n||null}clear(){this.replacements==="blobUrl"&&this.forEach((t,e)=>{URL.revokeObjectURL(t)}),super.clear()}async createUrl(t,e){const n=this.resolve(t),i=new Qt(n),r=this.replacements==="base64";if(this.archive){const s=r?"base64":"blob";return this.archive.request(n,s).then(o=>r?o:URL.createObjectURL(o))}else return r?this.request(n,"blob").then(s=>Mi(s)):this.request(n,"blob").then(s=>{const o=e||ne.lookup(i.filename);return En(s,o)})}revokeUrl(t){if(this.replacements==="blobUrl"){const e=this.get(t);e&&URL.revokeObjectURL(e)}}substitute(t,e){e.output=Ts(t,e,[...this.keys()],[...this.values()])}async unpack(t,e,n){this.archive=e,this.storage=n,this.replacements===null&&(this.replacements=e||n.name?"blobUrl":null);const i=[];return t.forEach((r,s)=>{if(r["media-type"]==="application/xhtml+xml"||r["media-type"]==="text/html")n.name&&!e&&i.push(n.put(this.resolve(r.href)));else if(this.replacements){const o=this.createUrl(r.href,r["media-type"]).then(a=>(this.set(r.href,a),a));i.push(o)}else this.set(r.href,null)}),Promise.all(i).then(()=>this)}destroy(){this.clear(),this.archive=void 0,this.storage=void 0,this.request=void 0,this.resolve=void 0,this.replacements=void 0}}class Ui{constructor(t,e,{data:n,cb:i,className:r,styles:s}){this.type=t,this.cfiRange=e,this.sectionIndex=new vt(e).spinePos,this.data=n,this.cb=i,this.className=r,this.styles=s,this.mark=void 0}update(t){this.data=t}attach(t){let e;if(t)this.type==="highlight"?e=t.highlight(this.cfiRange,this.data,this.cb,this.className,this.styles):this.type==="underline"&&(e=t.underline(this.cfiRange,this.data,this.cb,this.className,this.styles));else return null;return this.mark=e,this.emit(ot.ANNOTATION.ATTACH,e),e}detach(t){let e=!1;if(t)this.type==="highlight"?e=t.unhighlight(this.cfiRange):this.type==="underline"&&(e=t.ununderline(this.cfiRange));else return e;return this.mark=void 0,this.emit(ot.ANNOTATION.DETACH,e),e}text(){}}Bt(Ui.prototype);class Rs extends Map{constructor(t){super(),this.rendition=t,this.rendition.hooks.render.register(this.inject.bind(this)),this.rendition.hooks.unloaded.register(this.reject.bind(this))}append(t,e,n){const i=encodeURI(t+":"+e),r=new Ui(t,e,n);return this.rendition.views().forEach(s=>{const o=s.section.index;r.sectionIndex===o&&r.attach(s)}),this.set(i,r),r}remove(t,e){const n=encodeURI(t+":"+e),i=this.get(n);i&&(this.rendition.views().forEach(r=>{const s=r.section.index;i.sectionIndex===s&&i.detach(r)}),this.delete(n))}inject(t){const e=t.section.index;this.forEach((n,i)=>{n.sectionIndex===e&&n.attach(t)})}reject(t){const e=t.section.index;this.forEach((n,i)=>{n.sectionIndex===e&&n.detach(t)})}show(){}hide(){}}class Wi{constructor(t){this.axis="horizontal",this.name="reflowable",this.flow="paginated",this.style="paginated",this.spread="auto",this.direction="ltr",this.orientation="auto",this.viewport="",this.minSpreadWidth=800,this.width=0,this.height=0,this.pageWidth=0,this.pageHeight=0,this.spreadWidth=0,this.delta=0,this.columnWidth=0,this.gap=0,this.divisor=1,this.set(t||{})}set(t){const e=n=>console.error(`Invalid '${n}' property type`);Object.keys(t).forEach(n=>{const i=t[n];if(this[n]===i||typeof i>"u")delete t[n];else if(n==="direction"||n==="orientation")typeof i=="string"?this[n]=t[n]:e(n);else if(n==="flow")if(typeof i=="string")switch(i){case"scrolled":case"scrolled-continuous":this.flow="scrolled",this.axis="vertical",this.style="scrolling",this.spread="none";break;case"scrolled-doc":this.flow=i,this.axis="vertical",this.style="scrolling",this.spread="none";break;default:this.flow="paginated",this.axis="horizontal",this.style="paginated";break}else e(n);else if(n==="spread")if(typeof i=="string")switch(i){case"auto":case"both":this.spread="auto";break;default:this.spread="none";break}else e(n);else(n==="width"||n==="height"||n==="pageWidth"||n==="pageHeight"||n==="gap"||n==="minSpreadWidth")&&(typeof i=="number"?i>=0&&(this[n]=t[n]):e(n))}),this.calculate(),Object.keys(t).length&&this.emit(ot.LAYOUT.UPDATED,this,t)}calculate(t,e,n){const i=t||this.width,r=e||this.height;if(n>=0)this.gap=n;else{let s;this.axis==="horizontal"?s=Math.floor(i/12):s=Math.floor(r/17),this.gap=s%2===0?s:s-1}this.flow==="paginated"?(this.divisor=this.spread==="auto"&&i>=this.minSpreadWidth?2:1,this.columnWidth=i/this.divisor-this.gap,this.spreadWidth=this.columnWidth*this.divisor+this.gap,this.pageWidth=this.columnWidth+this.gap,this.pageHeight=r):this.divisor=1,this.delta=i,this.width=i,this.height=r}count(t,e){let n,i;return this.flow==="paginated"?(e=e||this.delta,n=Math.ceil(t/e),i=n*this.divisor):(e=e||this.height,n=Math.ceil(t/e),i=n),{spreads:n,pages:i}}destroy(){Object.keys(this).forEach(t=>this[t]=void 0)}}Bt(Wi.prototype);class qi extends Map{constructor(t){super(),this.rendition=t,this.current=null,this.rules={},this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.content.register(this.update.bind(this))}register(){if(arguments.length!==0){if(arguments.length===1&&typeof arguments[0]=="object")return this.registerThemes(arguments[0]);if(arguments.length===2&&typeof arguments[1]=="string")return this.registerUrl(arguments[0],arguments[1]);if(arguments.length===2&&typeof arguments[1]=="object")return this.registerRules(arguments[0],arguments[1])}}registerThemes(t){for(const e in t)t.hasOwnProperty(e)&&(typeof t[e]=="string"?this.registerUrl(e,t[e]):this.registerRules(e,t[e]))}registerUrl(t,e){const n=new Qt(e);this.set(t,{injected:!1,url:n.toString()})}registerRules(t,e){this.set(t,{injected:!1,rules:e})}select(t){const e=this.current;let n;if(t?n=this.get(t):e&&t===null&&(n=this.get(e)),this.current===t||!n)return;this.current=t,this.rendition.getContents().forEach(r=>{r&&(t?(r.removeClass(e),r.appendClass(t),this.append(t,n,r)):e&&(r.removeClass(e),this.remove(e,n,r)))}),this.emit(ot.THEMES.SELECTED,t,n)}append(t,e,n){e.url&&(n.appendStylesheet(t,e.url),e.injected=!0),e.rules&&(n.appendStylesheet(t,e.rules),e.injected=!0),e.injected&&this.emit(ot.THEMES.INJECTED,t,e,n)}remove(t,e,n){n.removeStylesheet(t)&&(e.injected=!1,this.emit(ot.THEMES.REJECTED,t,e,n))}clear(){this.select(null),super.clear()}inject(t){this.current&&(this.forEach((e,n)=>{this.current===n&&this.append(n,e,t)}),t.appendClass(this.current))}update(t){const e=this.rules;for(const n in e)e.hasOwnProperty(n)&&t.css(n,e[n].value,e[n].priority)}appendRule(t,e,n=!1){const i={value:e,priority:n};this.rendition.getContents().forEach(s=>{s&&s.css(t,i.value,i.priority)}),this.rules[t]=i}removeRule(t){delete this.rules[t],this.rendition.getContents().forEach(n=>{n&&n.css(t)})}removeRules(){Object.keys(this.rules).forEach(t=>{this.removeRule(t)})}fontSize(t){this.appendRule("font-size",t)}font(t){this.appendRule("font-family",t,!0)}destroy(){this.clear(),this.removeRules(),this.current=void 0,this.rules=void 0}}Bt(qi.prototype);class Zt{constructor(t){this.context=t||this,this.tasks=[]}register(){for(let t=0;t<arguments.length;++t)if(typeof arguments[t]=="function")this.tasks.push(arguments[t]);else if(arguments[t]instanceof Array)this.register(arguments[t]);else throw new TypeError("Invalid argument type")}deregister(t){for(let e=0;e<this.tasks.length;e++)if(this.tasks[e]===t){this.tasks.splice(e,1);break}}trigger(){const t=arguments,e=this.context,n=[];let i;return this.tasks.forEach(r=>{try{i=r.apply(e,t)}catch(s){console.error(s)}i&&typeof i.then=="function"&&n.push(i)}),Promise.all(n)}list(){return this.tasks}clear(){this.tasks=[]}}class Hi{constructor(t){this.layout=t,this.layout.on(ot.LAYOUT.UPDATED,(e,n)=>{n.axis?this.updateAxis(e.axis):n.flow?this.updateFlow(e.flow):n.direction&&this.direction(e.direction)}),this.container=null,this.target=null,this.rect={bottom:0,height:0,left:0,right:0,top:0,width:0,x:0,y:0}}attachTo(t,e){const n=this.getElement(t);return n?(this.views=e.views,this.container=this.create(e),this.container.appendChild(this.views.container),n.appendChild(this.container),this.target=n,this.appendListeners(),n):null}create(t){let e=t.width,n=t.height;e&&Ft(e)&&(e=e+"px"),n&&Ft(n)&&(n=n+"px");const i=document.createElement("div");return i.classList.add("viewport-container"),i.style.wordSpacing="0",i.style.lineHeight="0",i.style.verticalAlign="top",i.style.position="relative",i.style.display="flex",i.style.flexWrap="nowrap",i.style.width=e||"100%",i.style.height=n||"100%",i.style.overflow="hidden",i}appendListeners(){screen.orientation.addEventListener("change",this.orientation.bind(this)),this.resizeFunc=new ResizeObserver(t=>{requestAnimationFrame(()=>this.resized(t))}),this.resizeFunc.observe(this.container)}removeListeners(){screen.orientation.removeEventListener("change",this.orientation.bind(this)),this.resizeFunc&&this.resizeFunc.disconnect()}getElement(t){let e;if(typeof t=="string")e=document.getElementById(t);else if(t instanceof Element)e=t;else throw new TypeError("Invalid argument type");return e}orientation(t){this.emit(ot.VIEWPORT.ORIENTATION_CHANGE,t.target)}resized(t){let e=!1;const n=i=>Object.keys(this.rect).forEach(r=>{i&&this.rect[r]!==i[r]&&i[r]!==void 0&&(this.rect[r]=i[r],e=!0)});t.forEach(i=>n(i.contentRect)),e&&this.emit(ot.VIEWPORT.RESIZED,this.rect)}size(t,e){return this.rect.width=this.target.clientWidth,this.rect.height=this.target.clientHeight,t?Ft(t)?(this.container.style.width=t+"px",this.rect.width=t):(this.container.style.width=t,this.rect.width=this.container.clientWidth):(t=this.rect.width,this.container.style.width=t+"px"),e?Ft(e)?(this.container.style.height=e+"px",this.rect.height=e):(this.container.style.height=e,this.rect.height=this.container.clientHeight):(e=this.rect.height,this.container.style.height=e+"px"),{width:this.rect.width,height:this.rect.height}}direction(t){const e=t||this.layout.direction;this.target.dir=e,this.target.classList.add(e)}updateAxis(t){(t||this.layout.axis)==="horizontal"?this.views.container.style.display="flex":this.views.container.style.display="grid"}updateFlow(t){const e=t||this.layout.flow;e==="paginated"?(this.views.container.style.display="flex",this.views.container.style["overflow-y"]="hidden",this.views.container.style["overflow-x"]="hidden"):this.layout.axis==="horizontal"?(this.views.container.style.display="flex",this.views.container.style["overflow-y"]="hidden",this.views.container.style["overflow-x"]="auto"):this.layout.axis==="vertical"&&(this.views.container.style.display="grid",this.views.container.style["overflow-y"]="auto",this.views.container.style["overflow-x"]="hidden"),this.target.className=e}update(){this.updateAxis(),this.updateFlow(),this.direction()}destroy(){this.target&&(this.removeListeners(),this.target.removeChild(this.container),this.container.removeChild(this.views.container),this.container=void 0,this.target=void 0,this.rect=void 0)}}Bt(Hi.prototype);class yn{constructor(t,e=!1){this.layout=t,this.devMode=e}section(t){const e=this.findRanges(t);return this.rangeListToCfiList(t.section.cfiBase,e)}page(t,e,n,i){const r=t&&t.document?t.document.body:!1;if(!r)return null;const s=this.rangePairToCfiPair(e,{start:this.findStart(r,n,i),end:this.findEnd(r,n,i)});if(this.devMode===!0){const o=t.document,a=new vt(s.start).toRange(o),c=new vt(s.end).toRange(o),m=o.defaultView.getSelection(),l=o.createRange();m.removeAllRanges(),l.setStart(a.startContainer,a.startOffset),l.setEnd(c.endContainer,c.endOffset),m.addRange(l)}return s}walk(t,e){if(t&&t.nodeType===Node.TEXT_NODE)return;const n={acceptNode:a=>a.data.trim().length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},i=n.acceptNode;i.acceptNode=n.acceptNode;const r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,i,!1);let s,o;for(;(s=r.nextNode())&&(o=e(s),!o););return o}findRanges(t){const e=[],n=t.contents.scrollWidth(),r=Math.ceil(n/this.layout.spreadWidth)*this.layout.divisor,s=this.layout.columnWidth,o=this.layout.gap,a=t.document.body;for(let c=0;c<r;c++){const m=(s+o)*c,l=s*(c+1)+o*c;e.push({start:this.findStart(a,m,l),end:this.findEnd(a,m,l)})}return e}findStart(t,e,n){const i=[t],r=this.layout.axis==="horizontal",s=this.layout.direction==="ltr",o=this.layout.direction==="rtl";let a=t;for(;i.length;){const c=i.shift(),m=this.walk(c,l=>{let b,f,v,d;const y=pn(l);if(r&&s){if(b=r?y.left:y.top,f=r?y.right:y.bottom,b>=e&&b<=n)return l;if(f>e)return l;a=l,i.push(l)}else if(r&&o){if(b=y.left,f=y.right,f<=n&&f>=e)return l;if(b<n)return l;a=l,i.push(l)}else{if(v=y.top,d=y.bottom,v>=e&&v<=n)return l;if(d>e)return l;a=l,i.push(l)}});if(m)return this.findTextStartRange(m,e,n)}return this.findTextStartRange(a,e,n)}findEnd(t,e,n){const i=[t],r=this.layout.axis==="horizontal",s=this.layout.direction==="ltr",o=this.layout.direction==="rtl";let a=t;for(;i.length;){const c=i.shift(),m=this.walk(c,l=>{let b,f,v,d;const y=pn(l);if(r&&s){if(b=Math.round(y.left),f=Math.round(y.right),b>n&&a)return a;if(f>n)return l;a=l,i.push(l)}else if(r&&o){if(b=Math.round(r?y.left:y.top),f=Math.round(r?y.right:y.bottom),f<e&&a)return a;if(b<e)return l;a=l,i.push(l)}else{if(v=Math.round(y.top),d=Math.round(y.bottom),v>n&&a)return a;if(d>n)return l;a=l,i.push(l)}});if(m)return this.findTextEndRange(m,e,n)}return this.findTextEndRange(a,e,n)}findTextStartRange(t,e,n){const i=this.splitTextNodeIntoRanges(t),r=this.layout.axis==="horizontal",s=this.layout.direction==="ltr",o=this.layout.direction==="rtl";for(let a=0;a<i.length;a++){const c=i[a],m=c.getBoundingClientRect();if(r&&s){if(m.left>=e)return c}else if(r&&o){if(m.right<=n)return c}else if(m.top>=e)return c}return i[0]}findTextEndRange(t,e,n){const i=this.splitTextNodeIntoRanges(t),r=this.layout.axis==="horizontal",s=this.layout.direction==="ltr",o=this.layout.direction==="rtl";let a;for(let c=0;c<i.length;c++){const m=i[c],l=m.getBoundingClientRect();if(r&&s){if(l.left>n&&a)return a;if(l.right>n)return m}else if(r&&o){if(l.right<e&&a)return a;if(l.left<e)return m}else{if(l.top>n&&a)return a;if(l.bottom>n)return m}a=m}return i[i.length-1]}splitTextNodeIntoRanges(t,e=" "){const n=[],r=(t.textContent||"").trim(),s=t.ownerDocument;let o,a=r.indexOf(e);if(a===-1||t.nodeType!=Node.TEXT_NODE)return o=s.createRange(),o.selectNodeContents(t),[o];for(o=s.createRange(),o.setStart(t,0),o.setEnd(t,a),n.push(o),o=!1;a!==-1;)a=r.indexOf(e,a+1),a>0&&(o&&(o.setEnd(t,a),n.push(o)),o=s.createRange(),o.setStart(t,a+1));return o&&(o.setEnd(t,r.length),n.push(o)),n}rangePairToCfiPair(t,e){const n=e.start,i=e.end;return n.collapse(!0),i.collapse(!1),{start:new vt(n,t).toString(),end:new vt(i,t).toString()}}rangeListToCfiList(t,e){const n=[];for(let i=0;i<e.length;i++){const r=this.rangePairToCfiPair(t,e[i]);n.push(r)}return n}destroy(){this.devMode=void 0}}class Os extends Array{constructor(){super(),this.container=null,this.init()}init(){this.container=document.createElement("div"),this.container.classList.add("views-container"),this.container.style.display="flex",this.container.style.width="100%",this.container.style.height="100%"}first(){return this[0]}last(){return this[this.length-1]}get(t){return this[t]}append(t){return this.container.appendChild(t.container),this.push(t),t}prepend(t){return this.container.insertBefore(t.container,this.container.firstChild),this.unshift(t),t}insert(t,e){const n=this.container.children;return e<n.length?this.container.insertBefore(t.container,n[e]):this.container.appendChild(t.container),this.splice(e,0,t),t}remove(t,e){const n=e||this.indexOf(t);n>-1&&(this.container.removeChild(t.container),this.splice(n,1),t.destroy())}clear(){const t=this.length;for(let e=0;e<t;++e){const n=this[e];n&&this.remove(n,e)}}find(t){for(let e=0;e<this.length;e++){const n=this[e];if(n.displayed&&n.section.index==t.index)return n}}displayed(){const t=[];for(let e=0;e<this.length;e++){const n=this[e];n.displayed&&t.push(n)}return t}show(){for(let t=0;t<this.length;t++){const e=this[t];e.displayed&&e.show()}}hide(){for(let t=0;t<this.length;t++){const e=this[t];e.displayed&&e.hide()}}update(){for(let t=0;t<this.length;++t){const e=this[t];e.displayed&&e.update()}}destroy(){this.clear(),this.container=void 0}}const Vi=typeof navigator<"u",Ds=Vi&&/Chrome/.test(navigator.userAgent),ii=Vi&&!Ds&&/AppleWebKit/.test(navigator.userAgent);class xe{constructor(t,e,n){this.document=t,this.content=e||this.document.body,this.contentRect={bottom:0,height:0,left:0,right:0,top:0,width:0,x:0,y:0},this.section=n,this.scripts=new Map,this.styles=new Map,this.active=!0,this.window=this.document.defaultView,this.mode=this.writingMode(),this.appendListeners()}width(t){const e=this.content;return t&&Ft(t)&&(t=t+"px"),t&&(e.style.width=t),parseInt(this.window.getComputedStyle(e).width)}height(t){const e=this.content;return t&&Ft(t)&&(t=t+"px"),t&&(e.style.height=t),parseInt(this.window.getComputedStyle(e).height)}textSize(){const t=this.document.createRange();t.selectNodeContents(this.content);const e=t.getBoundingClientRect(),n=Di(this.content),i=e.width+n.width,r=this.content.clientHeight;return{width:Math.round(i),height:Math.round(r)}}scrollWidth(){return this.document.documentElement.scrollWidth}scrollHeight(){return this.document.documentElement.scrollHeight}overflow(t){const e=this.document.documentElement;return t&&(e.style.overflow=t),this.window.getComputedStyle(e).overflow}overflowX(t){const e=this.document.documentElement;return t&&(e.style.overflowX=t),this.window.getComputedStyle(e).overflowX}overflowY(t){const e=this.document.documentElement;return t&&(e.style.overflowY=t),this.window.getComputedStyle(e).overflowY}css(t,e,n){const i=this.content;return e?i.style.setProperty(t,e,n?"important":""):i.style.removeProperty(t),this.window.getComputedStyle(i)[t]}viewport(t){const e={width:void 0,height:void 0,scale:void 0,minimum:void 0,maximum:void 0,scalable:void 0};let n=this.document.querySelector("meta[name='viewport']");if(n&&n.hasAttribute("content")){const s=n.getAttribute("content"),o=s.match(/width\s*=\s*([^,]*)/),a=s.match(/height\s*=\s*([^,]*)/),c=s.match(/initial-scale\s*=\s*([^,]*)/),m=s.match(/minimum-scale\s*=\s*([^,]*)/),l=s.match(/maximum-scale\s*=\s*([^,]*)/),b=s.match(/user-scalable\s*=\s*([^,]*)/);o&&o.length&&typeof o[1]<"u"&&(e.width=o[1]),a&&a.length&&typeof a[1]<"u"&&(e.height=a[1]),c&&c.length&&typeof c[1]<"u"&&(e.scale=c[1]),m&&m.length&&typeof m[1]<"u"&&(e.minimum=m[1]),l&&l.length&&typeof l[1]<"u"&&(e.maximum=l[1]),b&&b.length&&typeof b[1]<"u"&&(e.scalable=b[1])}const i=Oi(t||{},e),r=[];return t&&(i.width&&r.push("width="+i.width),i.height&&r.push("height="+i.height),i.scale&&r.push("initial-scale="+i.scale),i.scalable==="no"?(r.push("minimum-scale="+i.scale),r.push("maximum-scale="+i.scale),r.push("user-scalable="+i.scalable)):(i.scalable&&r.push("user-scalable="+i.scalable),i.minimum&&r.push("minimum-scale="+i.minimum),i.maximum&&r.push("minimum-scale="+i.maximum)),n===null&&(n=this.document.createElement("meta"),n.setAttribute("name","viewport"),this.document.head.appendChild(n)),n.setAttribute("content",r.join(", ")),this.window.scrollTo(0,0)),i}expand(){this.emit(ot.CONTENTS.EXPAND)}resize(t){let e=!1;const n=i=>Object.keys(this.contentRect).forEach(r=>{i&&this.contentRect[r]!==i[r]&&i[r]!==void 0&&(this.contentRect[r]=i[r],e=!0)});t.forEach(i=>n(i.contentRect)),e&&this.emit(ot.CONTENTS.RESIZED,this.contentRect)}root(){return this.document?this.document.documentElement:null}locationOf(t,e){const n={left:0,top:0};if(!this.document)return n;let i;if(vt.prototype.isCfiString(t)){const r=new vt(t).toRange(this.document,e);if(r){try{if(!r.endContainer||r.startContainer==r.endContainer&&r.startOffset==r.endOffset){let s=r.startContainer.textContent.indexOf(" ",r.startOffset);s==-1&&(s=r.startContainer.textContent.length),r.setEnd(r.startContainer,s)}}catch(s){console.error("setting end offset to start container length failed",s)}if(r.startContainer.nodeType===Node.ELEMENT_NODE)i=r.startContainer.getBoundingClientRect(),n.left=i.left,n.top=i.top;else if(ii){const s=r.startContainer,o=new Range;try{s.nodeType===Node.ELEMENT_NODE?i=s.getBoundingClientRect():r.startOffset+2<s.length?(o.setStart(s,r.startOffset),o.setEnd(s,r.startOffset+2),i=o.getBoundingClientRect()):r.startOffset-2>0?(o.setStart(s,r.startOffset-2),o.setEnd(s,r.startOffset),i=o.getBoundingClientRect()):i=s.parentNode.getBoundingClientRect()}catch(a){console.error(a,a.stack)}}else i=r.getBoundingClientRect()}}else if(typeof t=="string"&&t.indexOf("#")>-1){const r=t.substring(t.indexOf("#")+1),s=this.document.getElementById(r);if(s)if(ii){const o=new Range;o.selectNode(s),i=o.getBoundingClientRect()}else i=s.getBoundingClientRect()}return i&&(n.left=i.left,n.top=i.top),n}createLink(t,e){return new Promise((n,i)=>{const r=`epubjs-injected-css-${t}`;let s=this.styles.get(r);s&&this.document.head.removeChild(s),s=this.document.createElement("link"),s.rel="stylesheet",s.type="text/css",s.href=e,s.onload=()=>{n(s)},s.onerror=()=>{i(new Error(`Failed to load source: ${e}`))},this.document.head.appendChild(s),this.styles.set(r,s)})}createStyle(t,e){return new Promise(n=>{const i=`epubjs-injected-css-${t}`;let r=this.styles.get(i);r&&this.document.head.removeChild(r),r=this.document.createElement("style"),r.id=i,this.document.head.appendChild(r),Object.keys(e).forEach(s=>{const o=e[s],a=r.sheet.cssRules.length,c=Object.keys(o).map(m=>`${m}:${o[m]}`).join(";");r.sheet.insertRule(`${s}{${c}}`,a)}),this.styles.set(i,r),n(r)})}appendStylesheet(t,e){const n=new Et;return this.document?(typeof e=="string"?this.createLink(t,e).then(i=>{n.resolve(i)}):this.createStyle(t,e).then(i=>{n.resolve(i)}),n.promise):(n.reject(new Error("Document cannot be null")),n.promise)}removeStylesheet(t){if(!this.document)return!1;const e=`epubjs-injected-css-${t}`,n=this.styles.get(e);return typeof n>"u"?!1:(this.document.head.removeChild(n),this.styles.delete(e))}clearStylesheets(){this.styles.forEach(t=>{this.document.head.removeChild(t)}),this.styles.clear()}appendScript(t,e){return new Promise((n,i)=>{if(!this.document){i(new Error("Document cannot be null"));return}const r=`epubjs-injected-src-${t}`;let s=this.styles.get(r);typeof s>"u"&&(s=this.document.createElement("script"),s.type="text/javascript",s.src=e,s.onload=()=>{n(s)},s.onerror=()=>{i(new Error(`Failed to load source: ${e}`))},this.document.head.appendChild(s)),this.scripts.set(r,s)})}removeScript(t){if(!this.document)return!1;const e=`epubjs-injected-src-${t}`,n=this.scripts.get(e);return typeof n>"u"?!1:(this.document.head.removeChild(n),this.scripts.remove(e))}clearScripts(){this.scripts.forEach(t=>{this.document.head.removeChild(t)}),this.scripts.clear()}appendClass(t){if(!this.document)return;const e=this.content;e&&e.classList.add(t)}removeClass(t){if(!this.document)return;const e=this.content;e&&e.classList.remove(t)}range(t,e){return new vt(t).toRange(this.document,e)}cfiFromRange(t,e){return new vt(t,this.section.cfiBase,e).toString()}cfiFromNode(t,e){return new vt(t,this.section.cfiBase,e).toString()}map(t){return new yn(t).section()}format(t){t.flow==="paginated"?this.columns(t):this.size(t)}size(t){const n=t.flow==="scrolled-doc"?t.pageWidth:t.width,i=t.direction;this.width(n),this.viewport({width:n,scale:1,scalable:"no"}),this.direction(i),this.css("height","auto"),this.css("padding","20px "+n/12+"px"),this.css("overflow","hidden"),this.css("margin","0"),this.css("box-sizing","border-box")}columns(t){const e=t.pageWidth,n=t.pageHeight,i=t.columnWidth,r=t.direction,s=t.gap;this.width(e),this.height(n),this.viewport({width:e,height:n,scale:1,scalable:"no"}),this.direction(r),this.css("overflow","hidden"),this.css("margin","0",!0),this.css("box-sizing","border-box"),this.css("max-height","inherit"),this.css("display","block"),this.css("padding-top","20px"),this.css("padding-bottom","20px"),this.css("padding-left",s/2+"px",!0),this.css("padding-right",s/2+"px",!0),this.css("column-gap",s+"px"),this.css("column-fill","auto"),this.css("column-width",i+"px"),this.css("-webkit-line-box-contain","block glyphs replaced")}scale(t,e,n){const i="scale("+t+")";let r="";(e>=0||n>=0)&&(r=" translate("+(e||0)+"px, "+(n||0)+"px )"),this.css("transform",i+r),this.css("transform-origin","top left")}direction(t="ltr"){this.document.documentElement.dir=t}mapPage(t,e,n,i,r){return new yn(e,r).page(this,t,n,i)}writingMode(t="horizontal-tb"){if(this.mode===t)return this.mode;const e=Ri("writing-mode"),n=this.document.documentElement;return n.style[e]=t,this.mode=this.window.getComputedStyle(n)[e]||"",this.mode}appendListeners(){this.document&&(vn.forEach(t=>{this.document.addEventListener(t,this.triggerEvent.bind(this),{passive:!0})},this),this.document.addEventListener("selectionchange",this.selectionHandler.bind(this),{passive:!0}),this.resizeObserver=new ResizeObserver(t=>{requestAnimationFrame(()=>this.resize(t))}),this.resizeObserver.observe(this.document.documentElement),ks(this.content,t=>{this.emit(ot.CONTENTS.LINK_CLICKED,t)}))}removeListeners(){this.document&&(vn.forEach(t=>{this.document.removeEventListener(t,this.triggerEvent.bind(this),{passive:!0})},this),this.document.removeEventListener("selectionchange",this.selectionHandler.bind(this),{passive:!0}),this.resizeObserver&&this.resizeObserver.disconnect(),this.mutationObserver&&this.mutationObserver.disconnect())}triggerEvent(t){this.emit(t.type,t)}selectionHandler(t){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(()=>{const e=this.window.getSelection();if(!(e&&e.rangeCount>0))return;const n=e.getRangeAt(0);if(!n.collapsed){const i=new vt(n,this.section.cfiBase).toString();this.emit(ot.CONTENTS.SELECTED,i),this.emit(ot.CONTENTS.SELECTED_RANGE,n)}},250)}imageLoadListeners(){const t=this.document.querySelectorAll("img");for(let e=0;e<t.length;e++){const n=t[e];typeof n.naturalWidth<"u"&&n.naturalWidth===0&&(n.onload=this.expand.bind(this))}}mediaQueryListeners(){const t=this.document.styleSheets,e=n=>{n.matches&&setTimeout(this.expand.bind(this),1)};for(let n=0;n<t.length;n+=1){let i;try{i=t[n].cssRules}catch(r){console.error(r);return}if(!i)return;for(let r=0;r<i.length;r+=1)if(i[r].media){const s=this.window.matchMedia(i[r].media.mediaText);s.onchange=e}}}fontLoadListeners(){!this.document||!this.document.fonts||this.document.fonts.ready.then(()=>this.resize())}transitionListeners(){const t=this.content;t.style.transitionProperty="font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height",t.style.transitionDuration="0.001ms",t.style.transitionTimingFunction="linear",t.style.transitionDelay="0"}mutationListener(){const t=(e,n)=>{e.forEach(i=>{})};this.mutationObserver=new MutationObserver(t),this.mutationObserver.observe(this.document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}destroy(){this.removeListeners(),this.clearStylesheets(),this.styles=void 0,this.clearScripts(),this.scripts=void 0,this.section=void 0}}Bt(xe.prototype);const ri=(p,t,e,n)=>{const i=p.top-n.top,r=p.left-n.left,s=i+p.height,o=r+p.width;return i<=e&&r<=t&&s>e&&o>t},Ls=(p,t,e,n)=>{const i=p.getBoundingClientRect(),r=t.getBoundingClientRect();if(!ri(i,e,n,r))return!1;const s=p.getClientRects();for(let o=0,a=s.length;o<a;o++)if(ri(s[o],e,n,r))return!0;return!1},zs=p=>{const t=Object.assign({},p,{bubbles:!1});return new MouseEvent(p.type,t)},Ps=(p,t,e)=>{let n=p.clientX,i=p.clientY;p.touches&&p.touches.length&&(n=p.touches[0].clientX,i=p.touches[0].clientY),e.forEach((r,s)=>{Ls(r,t,n,i)&&r.dispatchEvent(zs(p))})},Bs=(p,t)=>{let e;p.nodeName==="iframe"||p.nodeName==="IFRAME"?e=p.contentDocument:e=p;const n=["mouseup","mousedown","click","touchstart"];for(const i of n)e.addEventListener(i,r=>Ps(r,p,t),!1)},si="http://www.w3.org/2000/svg";class oi extends Map{constructor(t,e=document.body){super(),this.target=t,this.element=document.createElementNS(si,"svg"),this.element.style.position="absolute",this.element.setAttribute("pointer-events","none"),Bs(this.target,this),this.container=e,this.container.appendChild(this.element),this.render()}appendMark(t,e){const n=document.createElementNS(si,"g");return this.element.appendChild(n),e.bind(n,this.container),e.render(),this.set(t,e),e}removeMark(t){const e=this.get(t);if(e){const n=e.unbind();this.element.removeChild(n),this.delete(t)}}render(){this.updateStyle(this.element),this.forEach((t,e)=>t.render())}updateStyle(t){const e=this.target.getBoundingClientRect(),n=this.container.getBoundingClientRect(),i=e.top-n.top,r=e.left-n.left,s=this.target.scrollWidth,o=this.target.scrollHeight;t.style.setProperty("top",`${i}px`,"important"),t.style.setProperty("left",`${r}px`,"important"),t.style.setProperty("width",`${s}px`,"important"),t.style.setProperty("height",`${o}px`,"important")}}class js{constructor(){this.element=null,this.range=null}bind(t,e){this.element=t,this.container=e}unbind(){const t=this.element;return this.element=null,t}clear(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild)}render(){}dispatchEvent(t){this.element&&this.element.dispatchEvent(t)}getBoundingClientRect(){return this.element.getBoundingClientRect()}getClientRects(){const t=[];let e=this.element.firstChild;for(;e;)t.push(e.getBoundingClientRect()),e=e.nextSibling;return t}}const Ms="http://www.w3.org/2000/svg";class bn extends js{constructor(t,{className:e,data:n,attributes:i,listeners:r}){super(),this.range=t,this.className=e,this.data=n||{},this.attributes=i||{},this.listeners=r||[]}bind(t,e){super.bind(t,e);for(const n in this.data)this.data.hasOwnProperty(n)&&(this.element.dataset[n]=this.data[n]);for(const n in this.attributes)this.attributes.hasOwnProperty(n)&&this.element.setAttribute(n,this.attributes[n]);this.className&&this.element.classList.add(this.className)}render(){this.clear();const t=this.range.getClientRects(),e=this.element.getBoundingClientRect(),n=this.container.getBoundingClientRect();for(let i=0,r=t.length;i<r;i++){const s=t[i],o=document.createElementNS(Ms,"rect");o.setAttribute("x",s.left-e.left+n.left),o.setAttribute("y",s.top-e.top+n.top),o.setAttribute("height",s.height),o.setAttribute("width",s.width),this.element.appendChild(o)}}}const ai="http://www.w3.org/2000/svg";class Fs extends bn{constructor(t,e){super(t,e)}render(){this.clear();const t=this.range.getClientRects(),e=this.element.getBoundingClientRect(),n=this.container.getBoundingClientRect();for(let i=0,r=t.length;i<r;i++){const s=t[i],o=document.createElementNS(ai,"rect"),a=document.createElementNS(ai,"line");o.setAttribute("x",s.left-e.left+n.left),o.setAttribute("y",s.top-e.top+n.top),o.setAttribute("height",s.height),o.setAttribute("width",s.width),o.setAttribute("fill","none"),a.setAttribute("x1",s.left-e.left+n.left),a.setAttribute("x2",s.left-e.left+n.left+s.width),a.setAttribute("y1",s.top-e.top+n.top+s.height-1),a.setAttribute("y2",s.top-e.top+n.top+s.height-1),a.setAttribute("stroke-width",1),a.setAttribute("stroke","black"),a.setAttribute("stroke-linecap","square"),this.element.appendChild(o),this.element.appendChild(a)}}}class Tn{constructor(t,e){this.id="vi-"+_n(),this.contents=null,this.container=null,this.displayed=!1,this.document=null,this.expanding=!1,this.frame=null,this.marks=null,this.width=0,this.height=0,this.layout=t,this.section=e,this.settings=null,this.init()}init(){this.container=document.createElement("div"),this.container.classList.add("view-container"),this.container.style.height="0",this.container.style.width="0",this.container.style.overflow="hidden",this.container.style.position="relative",this.container.setAttribute("ref",this.section.index)}clear(){let t=0;return this.marks&&this.marks.forEach((e,n)=>{e instanceof bn?t=this.unhighlight(e.data.epubcfi)?t+=1:t:t=this.ununderline(e.data.epubcfi)?t+=1:t}),t}create(){}render(t){const e=new Et;return this.create(),this.section.render(t).then(n=>this.load(n)).then(n=>{this.update(),e.resolve(n)},n=>{this.emit(ot.VIEWS.LOAD_ERROR,n),e.reject(n)}).then(()=>{this.emit(ot.VIEWS.RENDERED,this)}),e.promise}reset(){this.frame&&(this.frame.style.width="0",this.frame.style.height="0",this.width=0,this.height=0)}update(){this.contents.format(this.layout),this.axis(),this.mode(),this.expand()}axis(){this.layout.axis==="horizontal"?this.container.style.flex="none":this.container.style.flex="initial"}mode(t){}expand(){if(!this.frame||this.expanding)return;this.expanding=!0;const t=this.contents.textSize(),e=this.layout.pageWidth;if(this.layout.flow==="paginated"&&(t.width%e>0&&(t.width=Math.ceil(t.width/e)*e),this.settings.forceEvenPages)){const n=t.width/e;this.layout.divisor>1&&this.layout.name==="reflowable"&&n%2>0&&(t.width+=e)}(this.width!==t.width||this.height!==t.height)&&this.reframe(t.width,t.height),this.expanding=!1}reframe(t,e){this.frame&&(this.container.style.width=t+"px",this.container.style.height=e+"px",this.frame.style.width=t+"px",this.frame.style.height=e+"px",this.width=t,this.height=e,this.marks&&this.marks.render())}load(t){return Promise.resolve()}display(t){const e=new Et;return this.displayed?e.resolve(this):this.render(t).then(()=>{this.emit(ot.VIEWS.DISPLAYED),this.displayed=!0,e.resolve(this)},n=>{e.reject(n)}),e.promise}show(){this.container.style.visibility="visible",this.frame&&(this.frame.style.visibility="visible"),this.emit(ot.VIEWS.SHOWN,this)}hide(){this.container.style.visibility="hidden",this.frame&&(this.frame.style.visibility="hidden"),this.emit(ot.VIEWS.HIDDEN,this)}offset(){return{top:this.container.offsetTop,left:this.container.offsetLeft}}position(){return this.container.getBoundingClientRect()}locationOf(t){const e=this.contents.locationOf(t,this.settings.ignoreClass);return{left:e.left,top:e.top}}highlight(t,e={},n=null,i="epubjs-hl",r={}){if(!this.contents)return;e.epubcfi=t,this.marks===null&&(this.marks=new oi(this.frame,this.container));const s=Object.assign({fill:"yellow","fill-opacity":"0.3","mix-blend-mode":"multiply"},r),o=b=>{this.emit(ot.VIEWS.MARK_CLICKED,t,e)},a=encodeURI("epubjs-hl:"+t),c=this.contents.range(t),m=new bn(c,{className:i,data:e,attributes:s,listeners:[o,n]}),l=this.marks.appendMark(a,m);return l.element.setAttribute("ref",i),l.element.addEventListener("click",o),l.element.addEventListener("touchstart",o),n&&(l.element.addEventListener("click",n),l.element.addEventListener("touchstart",n)),l}unhighlight(t){const e=encodeURI("epubjs-hl:"+t),n=this.marks.get(e);let i=!1;return n&&(n.listeners.forEach(r=>{r&&(n.element.removeEventListener("click",r),n.element.removeEventListener("touchstart",r))}),this.marks.removeMark(e),i=!0),i}underline(t,e={},n=null,i="epubjs-ul",r={}){if(!this.contents)return;e.epubcfi=t,this.marks===null&&(this.marks=new oi(this.frame,this.container));const s=Object.assign({stroke:"black","stroke-opacity":"0.3","mix-blend-mode":"multiply"},r),o=b=>{this.emit(ot.VIEWS.MARK_CLICKED,t,e)},a=encodeURI("epubjs-ul:"+t),c=this.contents.range(t),m=new Fs(c,{className:i,data:e,attributes:s,listeners:[o,n]}),l=this.marks.appendMark(a,m);return l.element.setAttribute("ref",i),l.element.addEventListener("click",o),l.element.addEventListener("touchstart",o),n&&(l.element.addEventListener("click",n),l.element.addEventListener("touchstart",n)),l}ununderline(t){const e=encodeURI("epubjs-ul:"+t),n=this.marks.get(e);let i=!1;return n&&(n.listeners.forEach(r=>{r&&(n.element.removeEventListener("click",r),n.element.removeEventListener("touchstart",r))}),this.marks.removeMark(e),i=!0),i}destroy(){this.marks&&this.displayed&&(this.marks.element.remove(),this.marks.clear(),this.marks=void 0),this.displayed&&(this.displayed=void 0,this.container.removeChild(this.frame),this.container=void 0,this.contents.destroy(),this.contents=void 0),this.expanding=void 0,this.document=void 0,this.frame=void 0,this.size=void 0,this.id=void 0,this.width=void 0,this.height=void 0,this.settings=void 0}}Bt(Tn.prototype);class Zi extends Tn{constructor(t,e,n){super(t,e),this.settings=Ut({method:null,sandbox:[],forceEvenPages:!1,ignoreClass:""},n||{}),this.blobUrl=null,this.method=this.settings.method||"write",this.writingMode=""}create(){return this.frame=document.createElement("iframe"),this.frame.id=this.id,this.frame.seamless="seamless",this.frame.style.overflow="hidden",this.frame.style.border="none",this.frame.style.width="0",this.frame.style.height="0",this.settings.sandbox.forEach(t=>t&&this.frame.sandbox.add(t)),this.frame.setAttribute("enable-annotation","true"),this.width=0,this.height=0,this.frame}mode(t){const e=t||this.contents.mode;this.writingMode!==e&&(this.writingMode=e,this.emit(ot.VIEWS.WRITING_MODE,e))}load(t){const e=new Et;if(!this.frame)return e.reject(new Error("No Iframe Available")),e.promise;if(this.container.appendChild(this.frame),this.document=this.frame.contentDocument,this.frame.onload=n=>this.onLoad(n,e),this.document)this.method==="blobUrl"?(this.blobUrl=En(t,"application/xhtml+xml"),this.frame.src=this.blobUrl):this.method==="srcdoc"?this.frame.srcdoc=t:(this.document.open(),this.document.write("<!DOCTYPE html>"),this.document.write(t),this.document.close());else return e.reject(new Error("No Document Available")),e.promise;return e.promise}onLoad(t,e){this.document=t.target.contentDocument,this.contents=new xe(this.document,this.document.body,this.section);let n=this.document.querySelector("link[rel='canonical']");n?n.setAttribute("href",this.section.canonical):(n=this.document.createElement("link"),n.setAttribute("rel","canonical"),n.setAttribute("href",this.section.canonical),this.document.head.appendChild(n)),this.contents.on(ot.CONTENTS.RESIZED,i=>{this.emit(ot.VIEWS.RESIZED,i)}),e.resolve(this.contents)}show(){this.frame&&(this.frame.style.transform="translateZ(0)",this.frame.style.transform=null),super.show()}destroy(){this.blobUrl&&(zi(this.blobUrl),this.blobUrl=void 0),this.displayed&&(super.destroy(),this.method=void 0,this.writingMode=void 0)}}class Yi extends Tn{constructor(t,e,n){super(t,e),this.settings=Ut({width:0,height:0,ignoreClass:""},n||{})}create(){return this.frame=document.createElement("div"),this.frame.id=this.id,this.frame.style.overflow="hidden",this.frame.style.border="none",this.frame.style.wordSpacing="initial",this.frame.style.lineHeight="initial",this.width=0,this.height=0,this.frame}load(t){const e=new Et;if(!this.frame)return e.reject(new Error("No Iframe Available")),e.promise;const n=Gt(t,"text/html"),i=Tt(n,"body");return this.container.appendChild(this.frame),this.document=this.frame.ownerDocument,this.document?(this.contents=new xe(this.document,this.frame),this.frame.innerHTML=i.innerHTML,e.resolve(this.contents),e.promise):(e.reject(new Error("No Document Available")),e.promise)}}const Us=()=>{const p=document.createElement("div");p.dir="rtl",p.style.position="fixed",p.style.width="1px",p.style.height="1px",p.style.top="0px",p.style.left="0px",p.style.overflow="hidden";const t=document.createElement("div");t.style.width="2px";const e=document.createElement("span");e.style.width="1px",e.style.display="inline-block";const n=document.createElement("span");return n.style.width="1px",n.style.display="inline-block",t.appendChild(e),t.appendChild(n),p.appendChild(t),p},Ws=()=>{let p="reverse";const t=Us();return document.body.appendChild(t),t.scrollLeft>0?p="default":typeof Element<"u"&&Element.prototype.scrollIntoView?(t.children[0].children[1].scrollIntoView(),t.scrollLeft<0&&(p="negative")):(t.scrollLeft=1,t.scrollLeft===0&&(p="negative")),document.body.removeChild(t),p};var Ke,hi;function $i(){if(hi)return Ke;hi=1;function p(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}return Ke=p,Ke}var Je,li;function qs(){if(li)return Je;li=1;var p=typeof Pt=="object"&&Pt&&Pt.Object===Object&&Pt;return Je=p,Je}var Qe,ci;function Gi(){if(ci)return Qe;ci=1;var p=qs(),t=typeof self=="object"&&self&&self.Object===Object&&self,e=p||t||Function("return this")();return Qe=e,Qe}var tn,ui;function Hs(){if(ui)return tn;ui=1;var p=Gi(),t=function(){return p.Date.now()};return tn=t,tn}var en,fi;function Vs(){if(fi)return en;fi=1;var p=/\s/;function t(e){for(var n=e.length;n--&&p.test(e.charAt(n)););return n}return en=t,en}var nn,di;function Zs(){if(di)return nn;di=1;var p=Vs(),t=/^\s+/;function e(n){return n&&n.slice(0,p(n)+1).replace(t,"")}return nn=e,nn}var rn,pi;function Xi(){if(pi)return rn;pi=1;var p=Gi(),t=p.Symbol;return rn=t,rn}var sn,mi;function Ys(){if(mi)return sn;mi=1;var p=Xi(),t=Object.prototype,e=t.hasOwnProperty,n=t.toString,i=p?p.toStringTag:void 0;function r(s){var o=e.call(s,i),a=s[i];try{s[i]=void 0;var c=!0}catch{}var m=n.call(s);return c&&(o?s[i]=a:delete s[i]),m}return sn=r,sn}var on,gi;function $s(){if(gi)return on;gi=1;var p=Object.prototype,t=p.toString;function e(n){return t.call(n)}return on=e,on}var an,vi;function Gs(){if(vi)return an;vi=1;var p=Xi(),t=Ys(),e=$s(),n="[object Null]",i="[object Undefined]",r=p?p.toStringTag:void 0;function s(o){return o==null?o===void 0?i:n:r&&r in Object(o)?t(o):e(o)}return an=s,an}var hn,yi;function Xs(){if(yi)return hn;yi=1;function p(t){return t!=null&&typeof t=="object"}return hn=p,hn}var ln,bi;function Ks(){if(bi)return ln;bi=1;var p=Gs(),t=Xs(),e="[object Symbol]";function n(i){return typeof i=="symbol"||t(i)&&p(i)==e}return ln=n,ln}var cn,wi;function Js(){if(wi)return cn;wi=1;var p=Zs(),t=$i(),e=Ks(),n=NaN,i=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt;function a(c){if(typeof c=="number")return c;if(e(c))return n;if(t(c)){var m=typeof c.valueOf=="function"?c.valueOf():c;c=t(m)?m+"":m}if(typeof c!="string")return c===0?c:+c;c=p(c);var l=r.test(c);return l||s.test(c)?o(c.slice(2),l?2:8):i.test(c)?n:+c}return cn=a,cn}var un,_i;function Qs(){if(_i)return un;_i=1;var p=$i(),t=Hs(),e=Js(),n="Expected a function",i=Math.max,r=Math.min;function s(o,a,c){var m,l,b,f,v,d,y=0,w=!1,E=!1,T=!0;if(typeof o!="function")throw new TypeError(n);a=e(a)||0,p(c)&&(w=!!c.leading,E="maxWait"in c,b=E?i(e(c.maxWait)||0,a):b,T="trailing"in c?!!c.trailing:T);function A(j){var u=m,H=l;return m=l=void 0,y=j,f=o.apply(H,u),f}function k(j){return y=j,v=setTimeout(W,a),w?A(j):f}function z(j){var u=j-d,H=j-y,ut=a-u;return E?r(ut,b-H):ut}function D(j){var u=j-d,H=j-y;return d===void 0||u>=a||u<0||E&&H>=b}function W(){var j=t();if(D(j))return B(j);v=setTimeout(W,z(j))}function B(j){return v=void 0,T&&m?A(j):(m=l=void 0,f)}function Y(){v!==void 0&&clearTimeout(v),y=0,m=d=l=v=void 0}function at(){return v===void 0?f:B(t())}function C(){var j=t(),u=D(j);if(m=arguments,l=this,d=j,u){if(v===void 0)return k(d);if(E)return clearTimeout(v),v=setTimeout(W,a),A(d)}return v===void 0&&(v=setTimeout(W,a)),f}return C.cancel=Y,C.flush=at,C}return un=s,un}var to=Qs();const eo=be(to),pe="horizontal",le="vertical";class ke{constructor(t,e){this.name="default",this.load=t.load.bind(t),this.layout=t.rendition.layout,this.layout.on(ot.LAYOUT.UPDATED,(n,i)=>{i.flow&&(this.paginated=n.flow==="paginated"),this.views.update(),this.calculate()}),this.settings=Ut({view:"iframe",method:null,sandbox:[],ignoreClass:"",forceEvenPages:!0},e||{}),this.paginated=this.layout.flow==="paginated",this.location=[],this.mapping=new yn(this.layout),this.rendered=!1,this.scrollType=null,this.views=new Os,this.viewport=t.rendition.viewport,this.writingMode=null,this.q=new Sn(this)}render(t,e){this.scrollType=Ws(),this.viewport.attachTo(t,{views:this.views,width:e.width,height:e.height}),this.rendered=!0,this.appendEventListeners(),window.onpagehide=this.destroy.bind(this)}display(t,e){const n=new Et;(e===t.href||Ft(e))&&(e=void 0);const i=this.views.find(t);if(i){const r=i.offset();let s,o=r.top;return this.layout.direction==="ltr"?(s=r.left,this.scrollTo(s,o,!0)):(s=r.left+i.width,this.scrollTo(s,o,!0)),e&&this.moveTo(i.locationOf(e),i.width),n.resolve(),n.promise}return this.clear(),this.append(t).then(r=>{if(e){const s=r.locationOf(e);this.moveTo(s,r.width)}return r},r=>{n.reject(r)}).then(r=>{this.views.show(),n.resolve(r)}),n.promise}appendEventListeners(){const t=this.views.container;t.addEventListener("scroll",this.onscroll.bind(this)),"onscrollend"in window&&t.addEventListener("scrollend",this.onscrollend.bind(this));const e=this.name==="default"?0:30;this.scrollend=eo(this.scrolled.bind(this),e)}removeEventListeners(){const t=this.views.container;t.removeEventListener("scroll",this.onscroll.bind(this)),"onscrollend"in window&&t.removeEventListener("scrollend",this.onscrollend.bind(this)),this.scrollend=void 0}requireView(t){let e;return typeof t=="string"&&t==="iframe"?e=Zi:t==="inline"?e=Yi:e=t,e}createView(t){const e=this.requireView(this.settings.view);return new e(this.layout,t,{snap:this.settings.snap,method:this.settings.method,sandbox:this.settings.sandbox,ignoreClass:this.settings.ignoreClass,forceEvenPages:this.settings.forceEvenPages})}displayed(t){this.emit(ot.MANAGERS.ADDED,t)}resized(t){this.relocated(),this.emit(ot.MANAGERS.RESIZED,t)}moveTo(t,e){let n=0,i;const r=this.views.container;this.paginated?(n=Math.floor(t.left/this.layout.delta)*this.layout.delta,n+this.layout.delta>r.scrollWidth&&(n=r.scrollWidth-this.layout.delta),i=Math.floor(t.top/this.layout.delta)*this.layout.delta,i+this.layout.delta>r.scrollHeight&&(i=r.scrollHeight-this.layout.delta)):i=t.top,this.layout.direction==="rtl"&&(n=n+this.layout.delta,n=n-e),this.scrollTo(n,i,!0)}append(t){const e=this.createView(t);return e.on(ot.VIEWS.DISPLAYED,()=>{this.displayed(e)}),e.on(ot.VIEWS.RESIZED,n=>{this.resized(e)}),e.on(ot.VIEWS.WRITING_MODE,n=>{this.updateWritingMode(n)}),this.views.append(e),e.display(this.load)}prepend(t){const e=this.createView(t);return e.on(ot.VIEWS.DISPLAYED,()=>{this.displayed(e)}),e.on(ot.VIEWS.RESIZED,n=>{this.counter(e),this.resized(e)}),e.on(ot.VIEWS.WRITING_MODE,n=>{this.updateWritingMode(n)}),this.views.prepend(e),e.display(this.load)}counter(t){const e=t.contents.content;if(this.layout.axis===le){const n=e.scrollHeight;this.scrollBy(0,n,!0)}else{const n=e.scrollWidth;this.scrollBy(n,0,!0)}}next(){let t,e;const n=new Et,i=this.layout.direction,r=this.layout.axis===pe&&this.paginated,s=this.layout.axis===le&&this.paginated,o=this.views.container;return this.views.length===0?(n.resolve(null),n.promise):(r&&i==="ltr"?(this.scrollLeft=o.scrollLeft,t=o.scrollLeft+o.offsetWidth+this.layout.delta,t<=o.scrollWidth?this.scrollBy(this.layout.delta,0,!0):e=this.views.last().section.next()):r&&i==="rtl"?(this.scrollLeft=o.scrollLeft,this.scrollType==="default"?(t=o.scrollLeft,t>0?this.scrollBy(this.layout.delta,0,!0):e=this.views.last().section.next()):(t=o.scrollLeft+this.layout.delta*-1,t>o.scrollWidth*-1?this.scrollBy(this.layout.delta,0,!0):e=this.views.last().section.next())):s?o.scrollTop+o.offsetHeight<o.scrollHeight?this.scrollBy(0,this.layout.height,!0):e=this.views.last().section.next():e=this.views.last().section.next(),e?(this.clear(),this.calculate(),this.append(e).then(a=>{!r&&i==="rtl"&&this.scrollType==="default"&&this.scrollTo(o.scrollWidth,0,!0),this.views.show(),n.resolve(a)},a=>{n.reject(a)})):(this.relocated(),n.resolve(null)),n.promise)}prev(){let t,e;const n=new Et,i=this.layout.direction,r=this.layout.axis===pe&&this.paginated,s=this.layout.axis===le&&this.paginated,o=this.views.container;return this.views.length===0?(n.resolve(null),n.promise):(r&&i==="ltr"?(this.scrollLeft=o.scrollLeft,t=o.scrollLeft,t>0?this.scrollBy(-this.layout.delta,0,!0):e=this.views.first().section.prev()):r&&i==="rtl"?(this.scrollLeft=o.scrollLeft,this.scrollType==="default"?(t=o.scrollLeft+o.offsetWidth,t<o.scrollWidth?this.scrollBy(-this.layout.delta,0,!0):e=this.views.first().section.prev()):(t=o.scrollLeft,t<0?this.scrollBy(-this.layout.delta,0,!0):e=this.views.first().section.prev())):s?o.scrollTop>0?this.scrollBy(0,-this.layout.height,!0):e=this.views.first().section.prev():e=this.views.first().section.prev(),e?(this.clear(),this.calculate(),this.prepend(e).then(a=>{r&&(i==="rtl"?this.scrollType==="default"?this.scrollTo(0,0,!0):this.scrollTo(o.scrollWidth*-1+this.layout.delta,0,!0):this.scrollTo(o.scrollWidth-this.layout.delta,0,!0)),this.views.show(),n.resolve(a)},a=>{n.reject(a)})):(this.relocated(),n.resolve(null)),n.promise)}current(){const t=this.visible();return t.length?t[t.length-1]:null}clear(){this.views.hide(),this.scrollTo(0,0,!0),this.views.clear()}relocated(){this.currentLocation(),this.emit(ot.MANAGERS.RELOCATED,this.location)}currentLocation(){return this.layout.axis===pe&&this.paginated?this.location=this.paginatedLocation():this.location=this.scrolledLocation(),this.location}scrolledLocation(){const t=this.views.container;return this.visible().map(i=>{const{href:r,index:s}=i.section;let o,a,c,m,l;if(this.layout.axis===le){const v=t.scrollTop;o=Math.abs(v),a=Math.abs(v)+t.clientHeight,c=Math.ceil(o/t.clientHeight),m=Math.ceil(a/t.clientHeight),l=this.layout.count(i.height,t.clientHeight).pages}else{const v=t.scrollLeft;o=Math.abs(v),a=Math.abs(v)+t.clientWidth,c=Math.ceil(o/t.clientWidth),m=Math.ceil(a/t.clientWidth),l=this.layout.count(i.height,t.clientWidth).pages}const b=[];for(let v=c;v<m;v++)b.push({index:v});const f=this.mapping.page(i.contents,i.section.cfiBase,o,a);return{axis:this.layout.axis,href:r,index:s,pages:b,total:l,mapping:f}})}paginatedLocation(){const t=this.views.container,e=this.viewport.rect,n=t.scrollLeft;return this.visible().map(s=>{const{href:o,index:a}=s.section,c=this.layout.count(s.width).pages,m=Math.abs(n),l=Math.abs(n)+e.width,b=Math.floor(m/this.layout.pageWidth),f=Math.floor(l/this.layout.pageWidth),v=[];for(let y=b;y<f;y++)v.push({index:y});const d=this.mapping.page(s.contents,s.section.cfiBase,m,l);return{axis:this.layout.axis,href:o,index:a,pages:v,total:c,mapping:d}})}isVisible(t,e,n){const i=t.position(),r=this.viewport.rect;return this.layout.axis===pe&&i.right>r.left-e&&i.left<r.right+n||this.layout.axis===le&&i.bottom>r.top-e&&i.top<r.bottom+n}visible(){const t=this.views.displayed(),e=[];for(let n=0,i=t.length;n<i;n++){const r=t[n];this.isVisible(r,0,0)&&e.push(r)}return e}scrollBy(t,e,n){const i=this.layout.direction==="rtl"?-1:1,r=this.views.container;n&&(this.ignore=!0),t&&(r.scrollLeft+=t*i),e&&(r.scrollTop+=e)}scrollTo(t,e,n){n&&(this.ignore=!0),this.views.container.scrollLeft=t,this.views.container.scrollTop=e}scrolled(t){this.paginated&&this.name==="default"||(this.relocated(),this.emit(ot.MANAGERS.SCROLLED,{top:t.target.scrollTop,left:t.target.scrollLeft}))}onscroll(t){this.paginated&&this.name==="default"||(this.ignore?this.ignore=!1:(this.emit(ot.MANAGERS.SCROLL,{top:t.target.scrollTop,left:t.target.scrollLeft}),"onscrollend"in window||this.scrollend(t)))}onscrollend(t){this.scrollend(t)}calculate(){this.paginated?(this.layout.calculate(this.viewport.rect.width,this.viewport.rect.height,this.settings.gap),this.settings.offset=this.layout.delta/this.layout.divisor):this.layout.calculate(this.viewport.rect.width,this.viewport.rect.height)}updateWritingMode(t){this.writingMode=t}getContents(){const t=[];return this.views&&this.views.forEach(e=>{e&&t.push(e.contents)}),t}isRendered(){return this.rendered}destroy(){this.views&&(this.removeEventListeners(),this.views.destroy(),this.views=void 0,this.ignore=void 0,this.mapping.destroy(),this.mapping=void 0,this.location=void 0,this.rendered=void 0,this.paginated=void 0,this.scrollType=void 0,this.writingMode=void 0)}}Bt(ke.prototype);const no={easeInCubic:p=>Math.pow(p,3)};class Ki{constructor(t,e){this.settings=Ut({duration:300,minVelocity:.2,minDistance:10,easing:no.easeInCubic},e||{}),this.supportsTouch()&&this.setup(t)}setup(t){this.manager=t,this.layout=this.manager.layout,this.element=this.manager.views.container,this.scroller=this.element,this.manager.settings.offset=this.layout.width,this.manager.settings.afterScrolledTimeout=this.settings.duration*2,this.isVertical=this.manager.layout.axis==="vertical",!(!this.manager.paginated||this.isVertical)&&(this.touchCanceler=!1,this.resizeCanceler=!1,this.snapping=!1,this.scrollLeft,this.scrollTop,this.startTouchX=void 0,this.startTouchY=void 0,this.startTime=void 0,this.endTouchX=void 0,this.endTouchY=void 0,this.endTime=void 0,this.addListeners())}supportsTouch(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch}disableScroll(){}enableScroll(){}addListeners(){window.addEventListener("resize",this.onResize.bind(this)),this.scroller.addEventListener("scroll",this.onScroll.bind(this)),this.scroller.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!0}),this.scroller.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!0}),this.scroller.addEventListener("touchend",this.onTouchEnd.bind(this),{passive:!0}),this.on("touchstart",this.onTouchStart.bind(this)),this.on("touchmove",this.onTouchMove.bind(this)),this.on("touchend",this.onTouchEnd.bind(this)),this.manager.on(ot.MANAGERS.ADDED,this.afterDisplayed.bind(this))}removeListeners(){window.removeEventListener("resize",this.onResize.bind(this)),this.scroller.removeEventListener("scroll",this.onScroll.bind(this)),this.scroller.removeEventListener("touchstart",this.onTouchStart.bind(this),{passive:!0}),this.scroller.removeEventListener("touchmove",this.onTouchMove.bind(this),{passive:!0}),this.scroller.removeEventListener("touchend",this.onTouchEnd.bind(this),{passive:!0}),this.off("touchstart",this.onTouchStart.bind(this)),this.off("touchmove",this.onTouchMove.bind(this)),this.off("touchend",this.onTouchEnd.bind(this)),this.manager.off(ot.MANAGERS.ADDED,this.afterDisplayed.bind(this))}afterDisplayed(t){const e=t.contents;["touchstart","touchmove","touchend"].forEach(n=>{e.on(n,i=>this.triggerViewEvent(i,e))})}triggerViewEvent(t,e){this.emit(t.type,t,e)}onScroll(t){this.scrollLeft=this.scroller.scrollLeft,this.scrollTop=this.scroller.scrollTop}onResize(t){this.resizeCanceler=!0}onTouchStart(t){const{screenX:e,screenY:n}=t.touches[0];this.touchCanceler=!0,this.startTouchX||(this.startTouchX=e,this.startTouchY=n,this.startTime=new Date().getTime()),this.endTouchX=e,this.endTouchY=n,this.endTime=new Date().getTime()}onTouchMove(t){const{screenX:e,screenY:n}=t.touches[0],i=Math.abs(n-this.endTouchY);this.touchCanceler=!0,i<10&&(this.element.scrollLeft-=e-this.endTouchX),this.endTouchX=e,this.endTouchY=n,this.endTime=new Date().getTime()}onTouchEnd(t){this.touchCanceler=!1;let e=this.wasSwiped();e!==0?this.snap(e):this.snap(),this.startTouchX=void 0,this.startTouchY=void 0,this.startTime=void 0,this.endTouchX=void 0,this.endTouchY=void 0,this.endTime=void 0}wasSwiped(){const t=this.layout.pageWidth*this.layout.divisor,e=this.endTouchX-this.startTouchX,n=Math.abs(e),i=this.endTime-this.startTime,r=e/i,s=this.settings.minVelocity;if(n<=this.settings.minDistance||n>=t)return 0;if(r>s)return-1;if(r<-s)return 1}needsSnap(){const t=this.scrollLeft,e=this.layout.pageWidth*this.layout.divisor;return t%e!==0}snap(t=0){const e=this.scrollLeft,n=this.layout.pageWidth*this.layout.divisor;let i=Math.round(e/n)*n;return t&&(i+=t*n),this.smoothScrollTo(i)}smoothScrollTo(t){const e=new Et,n=this.scrollLeft,i=new Date().getTime(),r=this.settings.duration;this.snapping=!0;const s=()=>{const o=new Date().getTime(),a=Math.min(1,(o-i)/r);if(this.touchCanceler||this.resizeCanceler){this.resizeCanceler=!1,this.snapping=!1,e.resolve();return}a<1?(requestAnimationFrame(s),this.scrollTo(n+(t-n)*a,0)):(this.scrollTo(t,0),this.snapping=!1,e.resolve())};return s.call(this),e.promise}scrollTo(t=0,e=0){this.scroller.scrollLeft=t,this.scroller.scrollTop=e}destroy(){typeof this.scroller>"u"||(this.removeListeners(),this.scroller=void 0)}}Bt(Ki.prototype);const me="horizontal";class Ji extends ke{constructor(t,e){super(t,e),this.name="continuous",this.settings=Ut({axis:null,snap:null,view:"iframe",method:null,offset:500,offsetDelta:250,ignoreClass:"",forceEvenPages:!1},e||{})}render(t,e){super.render(t,e),this.paginated&&this.settings.snap&&(this.snapper=new Ki(this,this.settings.snap))}async display(t,e){return super.display(t,e).then(()=>this.fill())}fill(t){const e=t||new Et;return this.q.enqueue(()=>this.check()).then(n=>{n?this.fill(e):e.resolve()}),e.promise}moveTo(t){let e=0,n=0;this.paginated?e=Math.floor(t.left/this.layout.delta)*this.layout.delta:n=t.top,(e>0||n>0)&&this.scrollBy(e,n,!0)}removeShownListeners(t){t.off(ot.VIEWS.DISPLAYED)}async update(t){const e=this.views,n=t||this.settings.offset||0,i=[];for(let r=0;r<e.length;r++){const s=e[r];if(this.isVisible(s,n,n))if(s.displayed)s.show();else{const o=s.display(this.load).then(a=>{a.show()});i.push(o)}}return i.length?Promise.all(i):Promise.resolve(null)}async check(t,e){const n=[],i=this.layout.axis===me,r=this.views.container,s=this.layout.direction==="rtl";let o=this.settings.offset||0;t&&i&&(o=t),e&&!i&&(o=e);const a=this.viewport.rect,c=i?Math.floor(a.width):a.height,m=i?r.scrollWidth:r.scrollHeight;let l=i?r.scrollLeft:r.scrollTop;this.writingMode.indexOf(me)===0&&(s&&this.scrollType==="default"&&(l=m-c-l),s&&this.scrollType==="negative"&&(l=l*-1));const b=()=>{const y=this.views.last(),w=y&&y.section.next();w&&n.push(this.append(w))},f=()=>{const y=this.views.first(),w=y&&y.section.prev();w&&n.push(this.prepend(w))},v=l+c+o,d=l-o;return v>=m&&b(),d<0&&f(),n.length?Promise.all(n).then(()=>this.update(o)):Promise.resolve(null)}scrolled(t){this.q.enqueue(()=>this.check()).then(()=>{this.relocated(),this.emit(ot.MANAGERS.SCROLLED,{top:t.target.scrollTop,left:t.target.scrollLeft})})}next(){return this.views.length===0?Promise.resolve(null):(this.paginated&&this.layout.axis===me?this.scrollBy(this.layout.delta,0,!0):this.scrollBy(0,this.layout.height,!0),this.q.enqueue(()=>this.check()))}prev(){return this.views.length===0?Promise.resolve(null):(this.paginated&&this.layout.axis===me?this.scrollBy(-this.layout.delta,0,!0):this.scrollBy(0,-this.layout.height,!0),this.q.enqueue(()=>this.check()))}destroy(){super.destroy(),this.snapper&&this.snapper.destroy()}}class Cn{constructor(t,e){this.settings=Ut({width:null,height:null,manager:"default",view:"iframe",flow:null,method:"write",layout:null,spread:null,minSpreadWidth:800,script:null,snap:null,direction:null,ignoreClass:"",sandbox:[],stylesheet:null},e||{}),this.book=t,this.hooks={content:new Zt(this),display:new Zt(this),layout:new Zt(this),render:new Zt(this),show:new Zt(this),unloaded:new Zt(this)},this.hooks.content.register(this.handleLinks.bind(this)),this.hooks.content.register(this.passEvents.bind(this)),this.hooks.content.register(this.adjustImages.bind(this)),this.book.sections.hooks.content.register(this.injectIdentifier.bind(this)),this.settings.stylesheet&&this.book.sections.hooks.content.register(this.injectStylesheet.bind(this)),this.settings.script&&this.book.sections.hooks.content.register(this.injectScript.bind(this)),this.annotations=new Rs(this),this.themes=new qi(this),this.epubcfi=new vt,this.location=null,this.starting=new Et,this.started=this.starting.promise,this.q=new Sn(this),this.q.enqueue(this.book.opened),this.q.enqueue(this.start.bind(this))}requireManager(t){let e;if(typeof t=="string")switch(t){case"continuous":e=Ji;break;default:e=ke;break}else typeof t=="function"&&(e=t);return e}start(){const t=this.determineLayoutProperties();if(this.layout=new Wi(t),this.layout.on(ot.LAYOUT.UPDATED,(e,n)=>{this.emit(ot.RENDITION.LAYOUT,e,n)}),this.viewport=new Hi(this.layout),this.viewport.on(ot.VIEWPORT.RESIZED,e=>{this.layout.flow==="paginated"?this.layout.set({width:e.width,height:e.height}):this.layout.axis==="horizontal"?this.layout.set({height:e.height}):this.layout.axis==="vertical"&&this.layout.set({width:e.width}),this.location&&this.emit(ot.RENDITION.RESIZED,e)}),this.viewport.on(ot.VIEWPORT.ORIENTATION_CHANGE,e=>{this.emit(ot.RENDITION.ORIENTATION_CHANGE,e)}),!this.manager){const e=this.requireManager(this.settings.manager),n={snap:this.settings.snap,view:this.settings.view,method:this.settings.method,sandbox:this.settings.sandbox,ignoreClass:this.settings.ignoreClass};this.manager=new e(this.book,n)}this.manager.on(ot.MANAGERS.ADDED,this.afterDisplayed.bind(this)),this.manager.on(ot.MANAGERS.REMOVED,this.afterRemoved.bind(this)),this.manager.on(ot.MANAGERS.RESIZED,this.onResized.bind(this)),this.manager.on(ot.MANAGERS.RELOCATED,this.relocated.bind(this)),this.emit(ot.RENDITION.STARTED),navigator.epubReadingSystem={name:"epub-js",version:Ee,layoutStyle:this.layout.style,hasFeature:e=>{switch(e){case"dom-manipulation":return!0;case"layout-changes":return!0;case"touch-events":return!0;case"mouse-events":return!0;case"keyboard-events":return!0;case"spine-scripting":return!1;default:return!1}}},this.starting.resolve()}attachTo(t){return this.q.enqueue(()=>{this.manager.render(t,{width:this.settings.width,height:this.settings.height}),this.emit(ot.RENDITION.ATTACHED)})}display(t){return this.q.enqueue(this._display.bind(this),t)}_display(t){const e=new Et;this.book.locations.size&&Ni(t)&&(t=this.book.locations.cfiFromPercentage(parseFloat(t)));const n=this.book.sections.get(t);return n?(this.manager.display(n,t).then(()=>{e.resolve(n),this.emit(ot.RENDITION.DISPLAYED,n)},i=>{this.emit(ot.RENDITION.DISPLAY_ERROR,i)}).then(()=>{this.viewport.update()}),e.promise):(e.reject(new Error("No Section Found")),e.promise)}afterDisplayed(t){t.on(ot.VIEWS.MARK_CLICKED,(e,n)=>{this.triggerMarkEvent(e,n,t.contents)}),this.hooks.render.trigger(t,this).then(()=>{t.contents?this.hooks.content.trigger(t.contents,this).then(()=>{this.emit(ot.RENDITION.RENDERED,t)}):this.emit(ot.RENDITION.RENDERED,t)})}afterRemoved(t){this.hooks.unloaded.trigger(t,this).then(()=>{this.emit(ot.RENDITION.REMOVED,t)})}onResized(t){return this.adjustImages(t.contents)}moveTo(t){this.manager.moveTo(t)}resize(t,e){return this.viewport.size(t,e)}clear(){this.manager.clear()}next(){return this.q.enqueue(this.manager.next.bind(this.manager))}prev(){return this.q.enqueue(this.manager.prev.bind(this.manager))}determineLayoutProperties(){const{metadata:t,direction:e}=this.book.packaging;return{name:this.settings.layout||t.get("layout"),flow:this.settings.flow||t.get("flow"),spread:this.settings.spread||t.get("spread"),viewport:t.get("viewport"),direction:this.settings.direction||e||"ltr",orientation:this.settings.orientation||t.get("orientation"),minSpreadWidth:this.settings.minSpreadWidth,pageWidth:this.settings.pageWidth,pageHeight:this.settings.pageHeight}}updateLayout(t){this.layout.set(t)}currentLocation(){const t=this.manager.currentLocation();if(t&&t.then&&typeof t.then=="function")t.then(e=>this.located(e));else if(t)return this.located(t)}located(t){if(t.length===0)return{};const e=t[0],n=t[t.length-1],i={atStart:!1,atEnd:!1,start:{cfi:e.mapping.start,href:e.href,index:e.index,displayed:{page:e.pages[0],total:e.total}},end:{cfi:n.mapping.end,href:n.href,index:n.index,displayed:{page:n.pages[n.pages.length-1],total:n.total}}},r=this.book.locations;if(r.size){const c=r.locationFromCfi(e.mapping.start),m=r.locationFromCfi(n.mapping.end);c!==-1&&(i.start.location=c,i.start.percentage=r.percentageFromLocation(c)),m!==-1&&(i.end.location=m,i.end.percentage=r.percentageFromLocation(m))}const s=this.book.navigation.pageList;if(s.length){const c=s.pageFromCfi(e.mapping.start),m=s.pageFromCfi(n.mapping.end);c!==-1&&(i.start.page=c),m!==-1&&(i.end.page=m)}const o=i.start.displayed.page;this.book.sections.first().index===e.index&&o.index===0&&(i.atStart=!0);const a=i.end.displayed.page;return this.book.sections.last().index===n.index&&a.index===i.end.displayed.total-1&&(i.atEnd=!0),i}relocated(t){const e=this.located(t);!e&&(!e.start||!e.end)||(this.location=e,this.emit(ot.RENDITION.RELOCATED,this.location))}passEvents(t){vn.forEach(e=>{t.on(e,n=>this.triggerViewEvent(n,t))}),t.on(ot.CONTENTS.SELECTED,e=>this.triggerSelectedEvent(e,t))}triggerViewEvent(t,e){this.emit(t.type,t,e)}triggerSelectedEvent(t,e){this.emit(ot.RENDITION.SELECTED,t,e)}triggerMarkEvent(t,e,n){this.emit(ot.RENDITION.MARK_CLICKED,t,e,n)}getRange(t,e){const n=new vt(t),i=this.manager.visible().filter(r=>{if(n.spinePos===r.section.index)return!0});if(i.length)return i[0].contents.range(n,e)}adjustImages(t){const e=t?t.content:null;if(!e)return Promise.resolve(null);const n={top:parseFloat(e.style["padding-top"]),bottom:parseFloat(e.style["padding-bottom"]),left:parseFloat(e.style["padding-left"]),right:parseFloat(e.style["padding-right"])},i=n.left+n.right,r=n.top+n.bottom,s=(this.layout.columnWidth?this.layout.columnWidth-i+"px":"100%")+" !important",o=e.offsetHeight-r+"px !important";return t.appendStylesheet("images",{img:{"max-width":s,"max-height":o,"object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"},svg:{"max-width":s,"max-height":o,"page-break-inside":"avoid","break-inside":"avoid"}})}getContents(){return this.manager?this.manager.getContents():[]}views(){return(this.manager?this.manager.views:void 0)||[]}handleLinks(t){t&&t.on(ot.CONTENTS.LINK_CLICKED,e=>{this.display(e)})}injectStylesheet(t,e){const n=t.createElement("link");n.setAttribute("type","text/css"),n.setAttribute("rel","stylesheet"),n.setAttribute("href",this.settings.stylesheet),t.getElementsByTagName("head")[0].appendChild(n)}injectScript(t,e){const n=t.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",this.settings.script),n.textContent=" ",t.getElementsByTagName("head")[0].appendChild(n)}injectIdentifier(t,e){const n=this.book.packaging.metadata.get("identifier"),i=t.createElement("meta");i.setAttribute("name","dc.relation.ispartof"),n&&i.setAttribute("content",n),t.getElementsByTagName("head")[0].appendChild(i)}destroy(){this.q.destroy(),this.layout.destroy(),this.themes.destroy(),this.viewport.destroy(),this.manager.destroy(),this.hooks.display.clear(),this.hooks.content.clear(),this.hooks.layout.clear(),this.hooks.render.clear(),this.hooks.show.clear(),this.hooks.unloaded.clear(),this.hooks=void 0,this.layout=void 0,this.themes=void 0,this.manager=void 0,this.epubcfi=void 0,this.started=void 0,this.starting=void 0,this.viewport=void 0,this.q=void 0}}Bt(Cn.prototype);const Qi=!!(window&&window.URL),io=Qi?"blob":"arraybuffer",tr=(p,t,e="Error")=>{const n=p.target;t.dump.error=n.status,t.reject({message:e,target:n,stack:new Error().stack,trace:{dump:t.dump,uuid:t.id}})},ro=(p,t)=>{const e=p.target;e.status===403?tr(p,t,"Forbidden"):t.dump.read?t.dump.read.push(e.status):t.dump.read=[e.status]},so=(p,t,e)=>{const n=p.target;let i;n.responseType==="document"?n.response===null&&n.responseXML===null?e.reject({message:"Empty Response",target:n,stack:new Error().stack,trace:{dump:e.dump,uuid:e.id}}):n.responseXML?i=n.responseXML:_e(t)?i=Gt(n.response,"text/xml"):t==="xhtml"?i=Gt(n.response,"application/xhtml+xml"):(t==="html"||t==="htm")&&(i=Gt(n.response,"text/html")):n.responseType==="json"?i=n.response:n.responseType==="blob"?Qi?i=n.response:i=new Blob([n.response]):i=n.response,e.dump.load=[n.status,n.responseType],e.resolve(i)},oo=(p,t)=>{const e=p.target;t.dump.progress=e.status},ao=(p,t)=>{const e=p.target;t.dump.start=e.status},ho=(p,t)=>{const e=p.target;t.dump.end=e.status},ve=(p,t,e=!1,n=[])=>{const i=new Et,r=new XMLHttpRequest;t=t||new Yt(p).extension,r.withCredentials=e,_e(t)?(r.responseType="document",r.overrideMimeType("text/xml")):t==="xhtml"||t==="html"||t==="htm"?r.responseType="document":t==="binary"?r.responseType="arraybuffer":t==="blob"?r.responseType=io:t==="json"&&(r.responseType="json"),r.onreadystatechange=s=>ro(s,i),r.onload=s=>so(s,t,i),r.onprogress=s=>oo(s,i),r.onloadstart=s=>ao(s,i),r.onloadend=s=>ho(s,i),r.onerror=s=>tr(s,i),r.open("GET",p,!0);for(const s in n)r.setRequestHeader(s,n[s]);return r.send(),i.promise};class er{constructor(){this.instance=null}async request(t,e){e=e||new Yt(t).extension;let n;return e==="blob"||e==="binary"?n=this.getBlob(t):e==="base64"?n=this.getBase64(t):n=this.getText(t),n.then(i=>{const r=new Et;if(i){const s=this.handleResponse(i,e);r.resolve(s)}else r.reject({message:"File not found in: "+t,stack:new Error().stack});return r.promise})}handleResponse(t,e){let n;return _e(e)?n=Gt(t,"text/xml"):e==="xhtml"?n=Gt(t,"application/xhtml+xml"):e=="html"||e=="htm"?n=Gt(t,"text/html"):e==="json"?n=JSON.parse(t):n=t,n}async getBlob(t,e){}async getText(t,e){}async getBase64(t,e){}destroy(){this.instance=void 0}}function $t(p){throw new Error('Could not dynamically require "'+p+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var fn={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Ei;function lo(){return Ei||(Ei=1,function(p,t){(function(e){p.exports=e()})(function(){return function e(n,i,r){function s(c,m){if(!i[c]){if(!n[c]){var l=typeof $t=="function"&&$t;if(!m&&l)return l(c,!0);if(o)return o(c,!0);var b=new Error("Cannot find module '"+c+"'");throw b.code="MODULE_NOT_FOUND",b}var f=i[c]={exports:{}};n[c][0].call(f.exports,function(v){var d=n[c][1][v];return s(d||v)},f,f.exports,e,n,i,r)}return i[c].exports}for(var o=typeof $t=="function"&&$t,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(e,n,i){var r=e("./utils"),s=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(a){for(var c,m,l,b,f,v,d,y=[],w=0,E=a.length,T=E,A=r.getTypeOf(a)!=="string";w<a.length;)T=E-w,l=A?(c=a[w++],m=w<E?a[w++]:0,w<E?a[w++]:0):(c=a.charCodeAt(w++),m=w<E?a.charCodeAt(w++):0,w<E?a.charCodeAt(w++):0),b=c>>2,f=(3&c)<<4|m>>4,v=1<T?(15&m)<<2|l>>6:64,d=2<T?63&l:64,y.push(o.charAt(b)+o.charAt(f)+o.charAt(v)+o.charAt(d));return y.join("")},i.decode=function(a){var c,m,l,b,f,v,d=0,y=0,w="data:";if(a.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var E,T=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===o.charAt(64)&&T--,a.charAt(a.length-2)===o.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(E=s.uint8array?new Uint8Array(0|T):new Array(0|T);d<a.length;)c=o.indexOf(a.charAt(d++))<<2|(b=o.indexOf(a.charAt(d++)))>>4,m=(15&b)<<4|(f=o.indexOf(a.charAt(d++)))>>2,l=(3&f)<<6|(v=o.indexOf(a.charAt(d++))),E[y++]=c,f!==64&&(E[y++]=m),v!==64&&(E[y++]=l);return E}},{"./support":30,"./utils":32}],2:[function(e,n,i){var r=e("./external"),s=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),a=e("./stream/DataLengthProbe");function c(m,l,b,f,v){this.compressedSize=m,this.uncompressedSize=l,this.crc32=b,this.compression=f,this.compressedContent=v}c.prototype={getContentWorker:function(){var m=new s(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),l=this;return m.on("end",function(){if(this.streamInfo.data_length!==l.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),m},getCompressedWorker:function(){return new s(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(m,l,b){return m.pipe(new o).pipe(new a("uncompressedSize")).pipe(l.compressWorker(b)).pipe(new a("compressedSize")).withStreamInfo("compression",l)},n.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,n,i){var r=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,n,i){var r=e("./utils"),s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var m=0;m<8;m++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();n.exports=function(o,a){return o!==void 0&&o.length?r.getTypeOf(o)!=="string"?function(c,m,l,b){var f=s,v=b+l;c^=-1;for(var d=b;d<v;d++)c=c>>>8^f[255&(c^m[d])];return-1^c}(0|a,o,o.length,0):function(c,m,l,b){var f=s,v=b+l;c^=-1;for(var d=b;d<v;d++)c=c>>>8^f[255&(c^m.charCodeAt(d))];return-1^c}(0|a,o,o.length,0):0}},{"./utils":32}],5:[function(e,n,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,n,i){var r=null;r=typeof Promise<"u"?Promise:e("lie"),n.exports={Promise:r}},{lie:37}],7:[function(e,n,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=e("pako"),o=e("./utils"),a=e("./stream/GenericWorker"),c=r?"uint8array":"array";function m(l,b){a.call(this,"FlateWorker/"+l),this._pako=null,this._pakoAction=l,this._pakoOptions=b,this.meta={}}i.magic="\b\0",o.inherits(m,a),m.prototype.processChunk=function(l){this.meta=l.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,l.data),!1)},m.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},m.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},m.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var l=this;this._pako.onData=function(b){l.push({data:b,meta:l.meta})}},i.compressWorker=function(l){return new m("Deflate",l)},i.uncompressWorker=function(){return new m("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,n,i){function r(f,v){var d,y="";for(d=0;d<v;d++)y+=String.fromCharCode(255&f),f>>>=8;return y}function s(f,v,d,y,w,E){var T,A,k=f.file,z=f.compression,D=E!==c.utf8encode,W=o.transformTo("string",E(k.name)),B=o.transformTo("string",c.utf8encode(k.name)),Y=k.comment,at=o.transformTo("string",E(Y)),C=o.transformTo("string",c.utf8encode(Y)),j=B.length!==k.name.length,u=C.length!==Y.length,H="",ut="",G="",dt=k.dir,K=k.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};v&&!d||(ft.crc32=f.crc32,ft.compressedSize=f.compressedSize,ft.uncompressedSize=f.uncompressedSize);var F=0;v&&(F|=8),D||!j&&!u||(F|=2048);var M=0,ct=0;dt&&(M|=16),w==="UNIX"?(ct=798,M|=function(it,kt){var Nt=it;return it||(Nt=kt?16893:33204),(65535&Nt)<<16}(k.unixPermissions,dt)):(ct=20,M|=function(it){return 63&(it||0)}(k.dosPermissions)),T=K.getUTCHours(),T<<=6,T|=K.getUTCMinutes(),T<<=5,T|=K.getUTCSeconds()/2,A=K.getUTCFullYear()-1980,A<<=4,A|=K.getUTCMonth()+1,A<<=5,A|=K.getUTCDate(),j&&(ut=r(1,1)+r(m(W),4)+B,H+="up"+r(ut.length,2)+ut),u&&(G=r(1,1)+r(m(at),4)+C,H+="uc"+r(G.length,2)+G);var st="";return st+=`
\0`,st+=r(F,2),st+=z.magic,st+=r(T,2),st+=r(A,2),st+=r(ft.crc32,4),st+=r(ft.compressedSize,4),st+=r(ft.uncompressedSize,4),st+=r(W.length,2),st+=r(H.length,2),{fileRecord:l.LOCAL_FILE_HEADER+st+W+H,dirRecord:l.CENTRAL_FILE_HEADER+r(ct,2)+st+r(at.length,2)+"\0\0\0\0"+r(M,4)+r(y,4)+W+H+at}}var o=e("../utils"),a=e("../stream/GenericWorker"),c=e("../utf8"),m=e("../crc32"),l=e("../signature");function b(f,v,d,y){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=v,this.zipPlatform=d,this.encodeFileName=y,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(b,a),b.prototype.push=function(f){var v=f.meta.percent||0,d=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,a.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:d?(v+100*(d-y-1))/d:100}}))},b.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var v=this.streamFiles&&!f.file.dir;if(v){var d=s(f,v,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:d.fileRecord,meta:{percent:0}})}else this.accumulate=!0},b.prototype.closedSource=function(f){this.accumulate=!1;var v=this.streamFiles&&!f.file.dir,d=s(f,v,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(d.dirRecord),v)this.push({data:function(y){return l.DATA_DESCRIPTOR+r(y.crc32,4)+r(y.compressedSize,4)+r(y.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:d.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},b.prototype.flush=function(){for(var f=this.bytesWritten,v=0;v<this.dirRecords.length;v++)this.push({data:this.dirRecords[v],meta:{percent:100}});var d=this.bytesWritten-f,y=function(w,E,T,A,k){var z=o.transformTo("string",k(A));return l.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(w,2)+r(w,2)+r(E,4)+r(T,4)+r(z.length,2)+z}(this.dirRecords.length,d,f,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},b.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},b.prototype.registerPrevious=function(f){this._sources.push(f);var v=this;return f.on("data",function(d){v.processChunk(d)}),f.on("end",function(){v.closedSource(v.previous.streamInfo),v._sources.length?v.prepareNextSource():v.end()}),f.on("error",function(d){v.error(d)}),this},b.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},b.prototype.error=function(f){var v=this._sources;if(!a.prototype.error.call(this,f))return!1;for(var d=0;d<v.length;d++)try{v[d].error(f)}catch{}return!0},b.prototype.lock=function(){a.prototype.lock.call(this);for(var f=this._sources,v=0;v<f.length;v++)f[v].lock()},n.exports=b},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,n,i){var r=e("../compressions"),s=e("./ZipFileWorker");i.generateWorker=function(o,a,c){var m=new s(a.streamFiles,c,a.platform,a.encodeFileName),l=0;try{o.forEach(function(b,f){l++;var v=function(E,T){var A=E||T,k=r[A];if(!k)throw new Error(A+" is not a valid compression method !");return k}(f.options.compression,a.compression),d=f.options.compressionOptions||a.compressionOptions||{},y=f.dir,w=f.date;f._compressWorker(v,d).withStreamInfo("file",{name:b,dir:y,date:w,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(m)}),m.entriesCount=l}catch(b){m.error(b)}return m}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,n,i){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new r;for(var o in this)typeof this[o]!="function"&&(s[o]=this[o]);return s}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.10.1",r.loadAsync=function(s,o){return new r().loadAsync(s,o)},r.external=e("./external"),n.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,n,i){var r=e("./utils"),s=e("./external"),o=e("./utf8"),a=e("./zipEntries"),c=e("./stream/Crc32Probe"),m=e("./nodejsUtils");function l(b){return new s.Promise(function(f,v){var d=b.decompressed.getContentWorker().pipe(new c);d.on("error",function(y){v(y)}).on("end",function(){d.streamInfo.crc32!==b.decompressed.crc32?v(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}n.exports=function(b,f){var v=this;return f=r.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),m.isNode&&m.isStream(b)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",b,!0,f.optimizedBinaryString,f.base64).then(function(d){var y=new a(f);return y.load(d),y}).then(function(d){var y=[s.Promise.resolve(d)],w=d.files;if(f.checkCRC32)for(var E=0;E<w.length;E++)y.push(l(w[E]));return s.Promise.all(y)}).then(function(d){for(var y=d.shift(),w=y.files,E=0;E<w.length;E++){var T=w[E],A=T.fileNameStr,k=r.resolve(T.fileNameStr);v.file(k,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:f.createFolders}),T.dir||(v.file(k).unsafeOriginalName=A)}return y.zipComment.length&&(v.comment=y.zipComment),v})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,n,i){var r=e("../utils"),s=e("../stream/GenericWorker");function o(a,c){s.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(c)}r.inherits(o,s),o.prototype._bindStream=function(a){var c=this;(this._stream=a).pause(),a.on("data",function(m){c.push({data:m,meta:{percent:0}})}).on("error",function(m){c.isPaused?this.generatedError=m:c.error(m)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,n,i){var r=e("readable-stream").Readable;function s(o,a,c){r.call(this,a),this._helper=o;var m=this;o.on("data",function(l,b){m.push(l)||m._helper.pause(),c&&c(b)}).on("error",function(l){m.emit("error",l)}).on("end",function(){m.push(null)})}e("../utils").inherits(s,r),s.prototype._read=function(){this._helper.resume()},n.exports=s},{"../utils":32,"readable-stream":16}],14:[function(e,n,i){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,s);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,s)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var s=new Buffer(r);return s.fill(0),s},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(e,n,i){function r(k,z,D){var W,B=o.getTypeOf(z),Y=o.extend(D||{},m);Y.date=Y.date||new Date,Y.compression!==null&&(Y.compression=Y.compression.toUpperCase()),typeof Y.unixPermissions=="string"&&(Y.unixPermissions=parseInt(Y.unixPermissions,8)),Y.unixPermissions&&16384&Y.unixPermissions&&(Y.dir=!0),Y.dosPermissions&&16&Y.dosPermissions&&(Y.dir=!0),Y.dir&&(k=w(k)),Y.createFolders&&(W=y(k))&&E.call(this,W,!0);var at=B==="string"&&Y.binary===!1&&Y.base64===!1;D&&D.binary!==void 0||(Y.binary=!at),(z instanceof l&&z.uncompressedSize===0||Y.dir||!z||z.length===0)&&(Y.base64=!1,Y.binary=!0,z="",Y.compression="STORE",B="string");var C=null;C=z instanceof l||z instanceof a?z:v.isNode&&v.isStream(z)?new d(k,z):o.prepareContent(k,z,Y.binary,Y.optimizedBinaryString,Y.base64);var j=new b(k,C,Y);this.files[k]=j}var s=e("./utf8"),o=e("./utils"),a=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),m=e("./defaults"),l=e("./compressedObject"),b=e("./zipObject"),f=e("./generate"),v=e("./nodejsUtils"),d=e("./nodejs/NodejsStreamInputAdapter"),y=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var z=k.lastIndexOf("/");return 0<z?k.substring(0,z):""},w=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},E=function(k,z){return z=z!==void 0?z:m.createFolders,k=w(k),this.files[k]||r.call(this,k,null,{dir:!0,createFolders:z}),this.files[k]};function T(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var z,D,W;for(z in this.files)W=this.files[z],(D=z.slice(this.root.length,z.length))&&z.slice(0,this.root.length)===this.root&&k(D,W)},filter:function(k){var z=[];return this.forEach(function(D,W){k(D,W)&&z.push(W)}),z},file:function(k,z,D){if(arguments.length!==1)return k=this.root+k,r.call(this,k,z,D),this;if(T(k)){var W=k;return this.filter(function(Y,at){return!at.dir&&W.test(Y)})}var B=this.files[this.root+k];return B&&!B.dir?B:null},folder:function(k){if(!k)return this;if(T(k))return this.filter(function(B,Y){return Y.dir&&k.test(B)});var z=this.root+k,D=E.call(this,z),W=this.clone();return W.root=D.name,W},remove:function(k){k=this.root+k;var z=this.files[k];if(z||(k.slice(-1)!=="/"&&(k+="/"),z=this.files[k]),z&&!z.dir)delete this.files[k];else for(var D=this.filter(function(B,Y){return Y.name.slice(0,k.length)===k}),W=0;W<D.length;W++)delete this.files[D[W].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var z,D={};try{if((D=o.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=D.type.toLowerCase(),D.compression=D.compression.toUpperCase(),D.type==="binarystring"&&(D.type="string"),!D.type)throw new Error("No output type specified.");o.checkSupport(D.type),D.platform!=="darwin"&&D.platform!=="freebsd"&&D.platform!=="linux"&&D.platform!=="sunos"||(D.platform="UNIX"),D.platform==="win32"&&(D.platform="DOS");var W=D.comment||this.comment||"";z=f.generateWorker(this,D,W)}catch(B){(z=new a("error")).error(B)}return new c(z,D.type||"string",D.mimeType)},generateAsync:function(k,z){return this.generateInternalStream(k).accumulate(z)},generateNodeStream:function(k,z){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(z)}};n.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,n,i){n.exports=e("stream")},{stream:void 0}],17:[function(e,n,i){var r=e("./DataReader");function s(o){r.call(this,o);for(var a=0;a<this.data.length;a++)o[a]=255&o[a]}e("../utils").inherits(s,r),s.prototype.byteAt=function(o){return this.data[this.zero+o]},s.prototype.lastIndexOfSignature=function(o){for(var a=o.charCodeAt(0),c=o.charCodeAt(1),m=o.charCodeAt(2),l=o.charCodeAt(3),b=this.length-4;0<=b;--b)if(this.data[b]===a&&this.data[b+1]===c&&this.data[b+2]===m&&this.data[b+3]===l)return b-this.zero;return-1},s.prototype.readAndCheckSignature=function(o){var a=o.charCodeAt(0),c=o.charCodeAt(1),m=o.charCodeAt(2),l=o.charCodeAt(3),b=this.readData(4);return a===b[0]&&c===b[1]&&m===b[2]&&l===b[3]},s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},n.exports=s},{"../utils":32,"./DataReader":18}],18:[function(e,n,i){var r=e("../utils");function s(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var a,c=0;for(this.checkOffset(o),a=this.index+o-1;a>=this.index;a--)c=(c<<8)+this.byteAt(a);return this.index+=o,c},readString:function(o){return r.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},n.exports=s},{"../utils":32}],19:[function(e,n,i){var r=e("./Uint8ArrayReader");function s(o){r.call(this,o)}e("../utils").inherits(s,r),s.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},n.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,n,i){var r=e("./DataReader");function s(o){r.call(this,o)}e("../utils").inherits(s,r),s.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},s.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},s.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},s.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},n.exports=s},{"../utils":32,"./DataReader":18}],21:[function(e,n,i){var r=e("./ArrayReader");function s(o){r.call(this,o)}e("../utils").inherits(s,r),s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},n.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(e,n,i){var r=e("../utils"),s=e("../support"),o=e("./ArrayReader"),a=e("./StringReader"),c=e("./NodeBufferReader"),m=e("./Uint8ArrayReader");n.exports=function(l){var b=r.getTypeOf(l);return r.checkSupport(b),b!=="string"||s.uint8array?b==="nodebuffer"?new c(l):s.uint8array?new m(r.transformTo("uint8array",l)):new o(r.transformTo("array",l)):new a(l)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,n,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,n,i){var r=e("./GenericWorker"),s=e("../utils");function o(a){r.call(this,"ConvertWorker to "+a),this.destType=a}s.inherits(o,r),o.prototype.processChunk=function(a){this.push({data:s.transformTo(this.destType,a.data),meta:a.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,n,i){var r=e("./GenericWorker"),s=e("../crc32");function o(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,r),o.prototype.processChunk=function(a){this.streamInfo.crc32=s(a.data,this.streamInfo.crc32||0),this.push(a)},n.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,n,i){var r=e("../utils"),s=e("./GenericWorker");function o(a){s.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}r.inherits(o,s),o.prototype.processChunk=function(a){if(a){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+a.data.length}s.prototype.processChunk.call(this,a)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,n,i){var r=e("../utils"),s=e("./GenericWorker");function o(a){s.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(m){c.dataIsReady=!0,c.data=m,c.max=m&&m.length||0,c.type=r.getTypeOf(m),c.isPaused||c._tickAndRepeat()},function(m){c.error(m)})}r.inherits(o,s),o.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,c);break;case"uint8array":a=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":a=this.data.slice(this.index,c)}return this.index=c,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,n,i){function r(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,o){return this._listeners[s].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,o){if(this._listeners[s])for(var a=0;a<this._listeners[s].length;a++)this._listeners[s][a].call(this,o)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var o=this;return s.on("data",function(a){o.processChunk(a)}),s.on("end",function(){o.end()}),s.on("error",function(a){o.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,o){return this.extraStreamInfo[s]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},n.exports=r},{}],29:[function(e,n,i){var r=e("../utils"),s=e("./ConvertWorker"),o=e("./GenericWorker"),a=e("../base64"),c=e("../support"),m=e("../external"),l=null;if(c.nodestream)try{l=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function b(v,d){return new m.Promise(function(y,w){var E=[],T=v._internalType,A=v._outputType,k=v._mimeType;v.on("data",function(z,D){E.push(z),d&&d(D)}).on("error",function(z){E=[],w(z)}).on("end",function(){try{var z=function(D,W,B){switch(D){case"blob":return r.newBlob(r.transformTo("arraybuffer",W),B);case"base64":return a.encode(W);default:return r.transformTo(D,W)}}(A,function(D,W){var B,Y=0,at=null,C=0;for(B=0;B<W.length;B++)C+=W[B].length;switch(D){case"string":return W.join("");case"array":return Array.prototype.concat.apply([],W);case"uint8array":for(at=new Uint8Array(C),B=0;B<W.length;B++)at.set(W[B],Y),Y+=W[B].length;return at;case"nodebuffer":return Buffer.concat(W);default:throw new Error("concat : unsupported type '"+D+"'")}}(T,E),k);y(z)}catch(D){w(D)}E=[]}).resume()})}function f(v,d,y){var w=d;switch(d){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=d,this._mimeType=y,r.checkSupport(w),this._worker=v.pipe(new s(w)),v.lock()}catch(E){this._worker=new o("error"),this._worker.error(E)}}f.prototype={accumulate:function(v){return b(this,v)},on:function(v,d){var y=this;return v==="data"?this._worker.on(v,function(w){d.call(y,w.data,w.meta)}):this._worker.on(v,function(){r.delay(d,arguments,y)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(v){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:this._outputType!=="nodebuffer"},v)}},n.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(r),i.blob=s.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(e,n,i){for(var r=e("./utils"),s=e("./support"),o=e("./nodejsUtils"),a=e("./stream/GenericWorker"),c=new Array(256),m=0;m<256;m++)c[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;c[254]=c[254]=1;function l(){a.call(this,"utf-8 decode"),this.leftOver=null}function b(){a.call(this,"utf-8 encode")}i.utf8encode=function(f){return s.nodebuffer?o.newBufferFrom(f,"utf-8"):function(v){var d,y,w,E,T,A=v.length,k=0;for(E=0;E<A;E++)(64512&(y=v.charCodeAt(E)))==55296&&E+1<A&&(64512&(w=v.charCodeAt(E+1)))==56320&&(y=65536+(y-55296<<10)+(w-56320),E++),k+=y<128?1:y<2048?2:y<65536?3:4;for(d=s.uint8array?new Uint8Array(k):new Array(k),E=T=0;T<k;E++)(64512&(y=v.charCodeAt(E)))==55296&&E+1<A&&(64512&(w=v.charCodeAt(E+1)))==56320&&(y=65536+(y-55296<<10)+(w-56320),E++),y<128?d[T++]=y:(y<2048?d[T++]=192|y>>>6:(y<65536?d[T++]=224|y>>>12:(d[T++]=240|y>>>18,d[T++]=128|y>>>12&63),d[T++]=128|y>>>6&63),d[T++]=128|63&y);return d}(f)},i.utf8decode=function(f){return s.nodebuffer?r.transformTo("nodebuffer",f).toString("utf-8"):function(v){var d,y,w,E,T=v.length,A=new Array(2*T);for(d=y=0;d<T;)if((w=v[d++])<128)A[y++]=w;else if(4<(E=c[w]))A[y++]=65533,d+=E-1;else{for(w&=E===2?31:E===3?15:7;1<E&&d<T;)w=w<<6|63&v[d++],E--;1<E?A[y++]=65533:w<65536?A[y++]=w:(w-=65536,A[y++]=55296|w>>10&1023,A[y++]=56320|1023&w)}return A.length!==y&&(A.subarray?A=A.subarray(0,y):A.length=y),r.applyFromCharCode(A)}(f=r.transformTo(s.uint8array?"uint8array":"array",f))},r.inherits(l,a),l.prototype.processChunk=function(f){var v=r.transformTo(s.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var d=v;(v=new Uint8Array(d.length+this.leftOver.length)).set(this.leftOver,0),v.set(d,this.leftOver.length)}else v=this.leftOver.concat(v);this.leftOver=null}var y=function(E,T){var A;for((T=T||E.length)>E.length&&(T=E.length),A=T-1;0<=A&&(192&E[A])==128;)A--;return A<0||A===0?T:A+c[E[A]]>T?A:T}(v),w=v;y!==v.length&&(s.uint8array?(w=v.subarray(0,y),this.leftOver=v.subarray(y,v.length)):(w=v.slice(0,y),this.leftOver=v.slice(y,v.length))),this.push({data:i.utf8decode(w),meta:f.meta})},l.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=l,r.inherits(b,a),b.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=b},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,n,i){var r=e("./support"),s=e("./base64"),o=e("./nodejsUtils"),a=e("./external");function c(d){return d}function m(d,y){for(var w=0;w<d.length;++w)y[w]=255&d.charCodeAt(w);return y}e("setimmediate"),i.newBlob=function(d,y){i.checkSupport("blob");try{return new Blob([d],{type:y})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(d),w.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var l={stringifyByChunk:function(d,y,w){var E=[],T=0,A=d.length;if(A<=w)return String.fromCharCode.apply(null,d);for(;T<A;)y==="array"||y==="nodebuffer"?E.push(String.fromCharCode.apply(null,d.slice(T,Math.min(T+w,A)))):E.push(String.fromCharCode.apply(null,d.subarray(T,Math.min(T+w,A)))),T+=w;return E.join("")},stringifyByChar:function(d){for(var y="",w=0;w<d.length;w++)y+=String.fromCharCode(d[w]);return y},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function b(d){var y=65536,w=i.getTypeOf(d),E=!0;if(w==="uint8array"?E=l.applyCanBeUsed.uint8array:w==="nodebuffer"&&(E=l.applyCanBeUsed.nodebuffer),E)for(;1<y;)try{return l.stringifyByChunk(d,w,y)}catch{y=Math.floor(y/2)}return l.stringifyByChar(d)}function f(d,y){for(var w=0;w<d.length;w++)y[w]=d[w];return y}i.applyFromCharCode=b;var v={};v.string={string:c,array:function(d){return m(d,new Array(d.length))},arraybuffer:function(d){return v.string.uint8array(d).buffer},uint8array:function(d){return m(d,new Uint8Array(d.length))},nodebuffer:function(d){return m(d,o.allocBuffer(d.length))}},v.array={string:b,array:c,arraybuffer:function(d){return new Uint8Array(d).buffer},uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return o.newBufferFrom(d)}},v.arraybuffer={string:function(d){return b(new Uint8Array(d))},array:function(d){return f(new Uint8Array(d),new Array(d.byteLength))},arraybuffer:c,uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return o.newBufferFrom(new Uint8Array(d))}},v.uint8array={string:b,array:function(d){return f(d,new Array(d.length))},arraybuffer:function(d){return d.buffer},uint8array:c,nodebuffer:function(d){return o.newBufferFrom(d)}},v.nodebuffer={string:b,array:function(d){return f(d,new Array(d.length))},arraybuffer:function(d){return v.nodebuffer.uint8array(d).buffer},uint8array:function(d){return f(d,new Uint8Array(d.length))},nodebuffer:c},i.transformTo=function(d,y){if(y=y||"",!d)return y;i.checkSupport(d);var w=i.getTypeOf(y);return v[w][d](y)},i.resolve=function(d){for(var y=d.split("/"),w=[],E=0;E<y.length;E++){var T=y[E];T==="."||T===""&&E!==0&&E!==y.length-1||(T===".."?w.pop():w.push(T))}return w.join("/")},i.getTypeOf=function(d){return typeof d=="string"?"string":Object.prototype.toString.call(d)==="[object Array]"?"array":r.nodebuffer&&o.isBuffer(d)?"nodebuffer":r.uint8array&&d instanceof Uint8Array?"uint8array":r.arraybuffer&&d instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(d){if(!r[d.toLowerCase()])throw new Error(d+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(d){var y,w,E="";for(w=0;w<(d||"").length;w++)E+="\\x"+((y=d.charCodeAt(w))<16?"0":"")+y.toString(16).toUpperCase();return E},i.delay=function(d,y,w){setImmediate(function(){d.apply(w||null,y||[])})},i.inherits=function(d,y){function w(){}w.prototype=y.prototype,d.prototype=new w},i.extend=function(){var d,y,w={};for(d=0;d<arguments.length;d++)for(y in arguments[d])Object.prototype.hasOwnProperty.call(arguments[d],y)&&w[y]===void 0&&(w[y]=arguments[d][y]);return w},i.prepareContent=function(d,y,w,E,T){return a.Promise.resolve(y).then(function(A){return r.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new a.Promise(function(k,z){var D=new FileReader;D.onload=function(W){k(W.target.result)},D.onerror=function(W){z(W.target.error)},D.readAsArrayBuffer(A)}):A}).then(function(A){var k=i.getTypeOf(A);return k?(k==="arraybuffer"?A=i.transformTo("uint8array",A):k==="string"&&(T?A=s.decode(A):w&&E!==!0&&(A=function(z){return m(z,r.uint8array?new Uint8Array(z.length):new Array(z.length))}(A))),A):a.Promise.reject(new Error("Can't read the data of '"+d+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,n,i){var r=e("./reader/readerFor"),s=e("./utils"),o=e("./signature"),a=e("./zipEntry"),c=e("./support");function m(l){this.files=[],this.loadOptions=l}m.prototype={checkSignature:function(l){if(!this.reader.readAndCheckSignature(l)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(b)+", expected "+s.pretty(l)+")")}},isSignature:function(l,b){var f=this.reader.index;this.reader.setIndex(l);var v=this.reader.readString(4)===b;return this.reader.setIndex(f),v},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var l=this.reader.readData(this.zipCommentLength),b=c.uint8array?"uint8array":"array",f=s.transformTo(b,l);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var l,b,f,v=this.zip64EndOfCentralSize-44;0<v;)l=this.reader.readInt(2),b=this.reader.readInt(4),f=this.reader.readData(b),this.zip64ExtensibleData[l]={id:l,length:b,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var l,b;for(l=0;l<this.files.length;l++)b=this.files[l],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var l;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(l=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(l);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var l=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(l<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(l);var b=l;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(l=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(l),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var v=b-f;if(0<v)this.isSignature(b,o.CENTRAL_FILE_HEADER)||(this.reader.zero=v);else if(v<0)throw new Error("Corrupted zip: missing "+Math.abs(v)+" bytes.")},prepareReader:function(l){this.reader=r(l)},load:function(l){this.prepareReader(l),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=m},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,n,i){var r=e("./reader/readerFor"),s=e("./utils"),o=e("./compressedObject"),a=e("./crc32"),c=e("./utf8"),m=e("./compressions"),l=e("./support");function b(f,v){this.options=f,this.loadOptions=v}b.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var v,d;if(f.skip(22),this.fileNameLength=f.readInt(2),d=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(d),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((v=function(y){for(var w in m)if(Object.prototype.hasOwnProperty.call(m,w)&&m[w].magic===y)return m[w];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,v,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var v=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(v),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=r(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var v,d,y,w=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<w;)v=f.readInt(2),d=f.readInt(2),y=f.readData(d),this.extraFields[v]={id:v,length:d,value:y};f.setIndex(w)},handleUTF8:function(){var f=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var v=this.findExtraFieldUnicodePath();if(v!==null)this.fileNameStr=v;else{var d=s.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(d)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var w=s.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var v=r(f.value);return v.readInt(1)!==1||a(this.fileName)!==v.readInt(4)?null:c.utf8decode(v.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var v=r(f.value);return v.readInt(1)!==1||a(this.fileComment)!==v.readInt(4)?null:c.utf8decode(v.readData(f.length-5))}return null}},n.exports=b},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,n,i){function r(v,d,y){this.name=v,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=d,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var s=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),a=e("./utf8"),c=e("./compressedObject"),m=e("./stream/GenericWorker");r.prototype={internalStream:function(v){var d=null,y="string";try{if(!v)throw new Error("No output type specified.");var w=(y=v.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),d=this._decompressWorker();var E=!this._dataBinary;E&&!w&&(d=d.pipe(new a.Utf8EncodeWorker)),!E&&w&&(d=d.pipe(new a.Utf8DecodeWorker))}catch(T){(d=new m("error")).error(T)}return new s(d,y,"")},async:function(v,d){return this.internalStream(v).accumulate(d)},nodeStream:function(v,d){return this.internalStream(v||"nodebuffer").toNodejsStream(d)},_compressWorker:function(v,d){if(this._data instanceof c&&this._data.compression.magic===v.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new a.Utf8EncodeWorker)),c.createWorkerFrom(y,v,d)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof m?this._data:new o(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],b=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<l.length;f++)r.prototype[l[f]]=b;n.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,n,i){(function(r){var s,o,a=r.MutationObserver||r.WebKitMutationObserver;if(a){var c=0,m=new a(v),l=r.document.createTextNode("");m.observe(l,{characterData:!0}),s=function(){l.data=c=++c%2}}else if(r.setImmediate||r.MessageChannel===void 0)s="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var d=r.document.createElement("script");d.onreadystatechange=function(){v(),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},r.document.documentElement.appendChild(d)}:function(){setTimeout(v,0)};else{var b=new r.MessageChannel;b.port1.onmessage=v,s=function(){b.port2.postMessage(0)}}var f=[];function v(){var d,y;o=!0;for(var w=f.length;w;){for(y=f,f=[],d=-1;++d<w;)y[d]();w=f.length}o=!1}n.exports=function(d){f.push(d)!==1||o||s()}}).call(this,typeof Pt<"u"?Pt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,n,i){var r=e("immediate");function s(){}var o={},a=["REJECTED"],c=["FULFILLED"],m=["PENDING"];function l(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,w!==s&&d(this,w)}function b(w,E,T){this.promise=w,typeof E=="function"&&(this.onFulfilled=E,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function f(w,E,T){r(function(){var A;try{A=E(T)}catch(k){return o.reject(w,k)}A===w?o.reject(w,new TypeError("Cannot resolve promise with itself")):o.resolve(w,A)})}function v(w){var E=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof E=="function")return function(){E.apply(w,arguments)}}function d(w,E){var T=!1;function A(D){T||(T=!0,o.reject(w,D))}function k(D){T||(T=!0,o.resolve(w,D))}var z=y(function(){E(k,A)});z.status==="error"&&A(z.value)}function y(w,E){var T={};try{T.value=w(E),T.status="success"}catch(A){T.status="error",T.value=A}return T}(n.exports=l).prototype.finally=function(w){if(typeof w!="function")return this;var E=this.constructor;return this.then(function(T){return E.resolve(w()).then(function(){return T})},function(T){return E.resolve(w()).then(function(){throw T})})},l.prototype.catch=function(w){return this.then(null,w)},l.prototype.then=function(w,E){if(typeof w!="function"&&this.state===c||typeof E!="function"&&this.state===a)return this;var T=new this.constructor(s);return this.state!==m?f(T,this.state===c?w:E,this.outcome):this.queue.push(new b(T,w,E)),T},b.prototype.callFulfilled=function(w){o.resolve(this.promise,w)},b.prototype.otherCallFulfilled=function(w){f(this.promise,this.onFulfilled,w)},b.prototype.callRejected=function(w){o.reject(this.promise,w)},b.prototype.otherCallRejected=function(w){f(this.promise,this.onRejected,w)},o.resolve=function(w,E){var T=y(v,E);if(T.status==="error")return o.reject(w,T.value);var A=T.value;if(A)d(w,A);else{w.state=c,w.outcome=E;for(var k=-1,z=w.queue.length;++k<z;)w.queue[k].callFulfilled(E)}return w},o.reject=function(w,E){w.state=a,w.outcome=E;for(var T=-1,A=w.queue.length;++T<A;)w.queue[T].callRejected(E);return w},l.resolve=function(w){return w instanceof this?w:o.resolve(new this(s),w)},l.reject=function(w){var E=new this(s);return o.reject(E,w)},l.all=function(w){var E=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=w.length,A=!1;if(!T)return this.resolve([]);for(var k=new Array(T),z=0,D=-1,W=new this(s);++D<T;)B(w[D],D);return W;function B(Y,at){E.resolve(Y).then(function(C){k[at]=C,++z!==T||A||(A=!0,o.resolve(W,k))},function(C){A||(A=!0,o.reject(W,C))})}},l.race=function(w){var E=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=w.length,A=!1;if(!T)return this.resolve([]);for(var k=-1,z=new this(s);++k<T;)D=w[k],E.resolve(D).then(function(W){A||(A=!0,o.resolve(z,W))},function(W){A||(A=!0,o.reject(z,W))});var D;return z}},{immediate:36}],38:[function(e,n,i){var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),n.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,n,i){var r=e("./zlib/deflate"),s=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/messages"),c=e("./zlib/zstream"),m=Object.prototype.toString,l=0,b=-1,f=0,v=8;function d(w){if(!(this instanceof d))return new d(w);this.options=s.assign({level:b,method:v,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},w||{});var E=this.options;E.raw&&0<E.windowBits?E.windowBits=-E.windowBits:E.gzip&&0<E.windowBits&&E.windowBits<16&&(E.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var T=r.deflateInit2(this.strm,E.level,E.method,E.windowBits,E.memLevel,E.strategy);if(T!==l)throw new Error(a[T]);if(E.header&&r.deflateSetHeader(this.strm,E.header),E.dictionary){var A;if(A=typeof E.dictionary=="string"?o.string2buf(E.dictionary):m.call(E.dictionary)==="[object ArrayBuffer]"?new Uint8Array(E.dictionary):E.dictionary,(T=r.deflateSetDictionary(this.strm,A))!==l)throw new Error(a[T]);this._dict_set=!0}}function y(w,E){var T=new d(E);if(T.push(w,!0),T.err)throw T.msg||a[T.err];return T.result}d.prototype.push=function(w,E){var T,A,k=this.strm,z=this.options.chunkSize;if(this.ended)return!1;A=E===~~E?E:E===!0?4:0,typeof w=="string"?k.input=o.string2buf(w):m.call(w)==="[object ArrayBuffer]"?k.input=new Uint8Array(w):k.input=w,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new s.Buf8(z),k.next_out=0,k.avail_out=z),(T=r.deflate(k,A))!==1&&T!==l)return this.onEnd(T),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(s.shrinkBuf(k.output,k.next_out))):this.onData(s.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&T!==1);return A===4?(T=r.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===l):A!==2||(this.onEnd(l),!(k.avail_out=0))},d.prototype.onData=function(w){this.chunks.push(w)},d.prototype.onEnd=function(w){w===l&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},i.Deflate=d,i.deflate=y,i.deflateRaw=function(w,E){return(E=E||{}).raw=!0,y(w,E)},i.gzip=function(w,E){return(E=E||{}).gzip=!0,y(w,E)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,n,i){var r=e("./zlib/inflate"),s=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/constants"),c=e("./zlib/messages"),m=e("./zlib/zstream"),l=e("./zlib/gzheader"),b=Object.prototype.toString;function f(d){if(!(this instanceof f))return new f(d);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},d||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||d&&d.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&(15&y.windowBits)==0&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var w=r.inflateInit2(this.strm,y.windowBits);if(w!==a.Z_OK)throw new Error(c[w]);this.header=new l,r.inflateGetHeader(this.strm,this.header)}function v(d,y){var w=new f(y);if(w.push(d,!0),w.err)throw w.msg||c[w.err];return w.result}f.prototype.push=function(d,y){var w,E,T,A,k,z,D=this.strm,W=this.options.chunkSize,B=this.options.dictionary,Y=!1;if(this.ended)return!1;E=y===~~y?y:y===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof d=="string"?D.input=o.binstring2buf(d):b.call(d)==="[object ArrayBuffer]"?D.input=new Uint8Array(d):D.input=d,D.next_in=0,D.avail_in=D.input.length;do{if(D.avail_out===0&&(D.output=new s.Buf8(W),D.next_out=0,D.avail_out=W),(w=r.inflate(D,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&B&&(z=typeof B=="string"?o.string2buf(B):b.call(B)==="[object ArrayBuffer]"?new Uint8Array(B):B,w=r.inflateSetDictionary(this.strm,z)),w===a.Z_BUF_ERROR&&Y===!0&&(w=a.Z_OK,Y=!1),w!==a.Z_STREAM_END&&w!==a.Z_OK)return this.onEnd(w),!(this.ended=!0);D.next_out&&(D.avail_out!==0&&w!==a.Z_STREAM_END&&(D.avail_in!==0||E!==a.Z_FINISH&&E!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=o.utf8border(D.output,D.next_out),A=D.next_out-T,k=o.buf2string(D.output,T),D.next_out=A,D.avail_out=W-A,A&&s.arraySet(D.output,D.output,T,A,0),this.onData(k)):this.onData(s.shrinkBuf(D.output,D.next_out)))),D.avail_in===0&&D.avail_out===0&&(Y=!0)}while((0<D.avail_in||D.avail_out===0)&&w!==a.Z_STREAM_END);return w===a.Z_STREAM_END&&(E=a.Z_FINISH),E===a.Z_FINISH?(w=r.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===a.Z_OK):E!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(D.avail_out=0))},f.prototype.onData=function(d){this.chunks.push(d)},f.prototype.onEnd=function(d){d===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},i.Inflate=f,i.inflate=v,i.inflateRaw=function(d,y){return(y=y||{}).raw=!0,v(d,y)},i.ungzip=v},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,n,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(a){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var m=c.shift();if(m){if(typeof m!="object")throw new TypeError(m+"must be non-object");for(var l in m)m.hasOwnProperty(l)&&(a[l]=m[l])}}return a},i.shrinkBuf=function(a,c){return a.length===c?a:a.subarray?a.subarray(0,c):(a.length=c,a)};var s={arraySet:function(a,c,m,l,b){if(c.subarray&&a.subarray)a.set(c.subarray(m,m+l),b);else for(var f=0;f<l;f++)a[b+f]=c[m+f]},flattenChunks:function(a){var c,m,l,b,f,v;for(c=l=0,m=a.length;c<m;c++)l+=a[c].length;for(v=new Uint8Array(l),c=b=0,m=a.length;c<m;c++)f=a[c],v.set(f,b),b+=f.length;return v}},o={arraySet:function(a,c,m,l,b){for(var f=0;f<l;f++)a[b+f]=c[m+f]},flattenChunks:function(a){return[].concat.apply([],a)}};i.setTyped=function(a){a?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,s)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(r)},{}],42:[function(e,n,i){var r=e("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var a=new r.Buf8(256),c=0;c<256;c++)a[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function m(l,b){if(b<65537&&(l.subarray&&o||!l.subarray&&s))return String.fromCharCode.apply(null,r.shrinkBuf(l,b));for(var f="",v=0;v<b;v++)f+=String.fromCharCode(l[v]);return f}a[254]=a[254]=1,i.string2buf=function(l){var b,f,v,d,y,w=l.length,E=0;for(d=0;d<w;d++)(64512&(f=l.charCodeAt(d)))==55296&&d+1<w&&(64512&(v=l.charCodeAt(d+1)))==56320&&(f=65536+(f-55296<<10)+(v-56320),d++),E+=f<128?1:f<2048?2:f<65536?3:4;for(b=new r.Buf8(E),d=y=0;y<E;d++)(64512&(f=l.charCodeAt(d)))==55296&&d+1<w&&(64512&(v=l.charCodeAt(d+1)))==56320&&(f=65536+(f-55296<<10)+(v-56320),d++),f<128?b[y++]=f:(f<2048?b[y++]=192|f>>>6:(f<65536?b[y++]=224|f>>>12:(b[y++]=240|f>>>18,b[y++]=128|f>>>12&63),b[y++]=128|f>>>6&63),b[y++]=128|63&f);return b},i.buf2binstring=function(l){return m(l,l.length)},i.binstring2buf=function(l){for(var b=new r.Buf8(l.length),f=0,v=b.length;f<v;f++)b[f]=l.charCodeAt(f);return b},i.buf2string=function(l,b){var f,v,d,y,w=b||l.length,E=new Array(2*w);for(f=v=0;f<w;)if((d=l[f++])<128)E[v++]=d;else if(4<(y=a[d]))E[v++]=65533,f+=y-1;else{for(d&=y===2?31:y===3?15:7;1<y&&f<w;)d=d<<6|63&l[f++],y--;1<y?E[v++]=65533:d<65536?E[v++]=d:(d-=65536,E[v++]=55296|d>>10&1023,E[v++]=56320|1023&d)}return m(E,v)},i.utf8border=function(l,b){var f;for((b=b||l.length)>l.length&&(b=l.length),f=b-1;0<=f&&(192&l[f])==128;)f--;return f<0||f===0?b:f+a[l[f]]>b?f:b}},{"./common":41}],43:[function(e,n,i){n.exports=function(r,s,o,a){for(var c=65535&r|0,m=r>>>16&65535|0,l=0;o!==0;){for(o-=l=2e3<o?2e3:o;m=m+(c=c+s[a++]|0)|0,--l;);c%=65521,m%=65521}return c|m<<16|0}},{}],44:[function(e,n,i){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,n,i){var r=function(){for(var s,o=[],a=0;a<256;a++){s=a;for(var c=0;c<8;c++)s=1&s?3988292384^s>>>1:s>>>1;o[a]=s}return o}();n.exports=function(s,o,a,c){var m=r,l=c+a;s^=-1;for(var b=c;b<l;b++)s=s>>>8^m[255&(s^o[b])];return-1^s}},{}],46:[function(e,n,i){var r,s=e("../utils/common"),o=e("./trees"),a=e("./adler32"),c=e("./crc32"),m=e("./messages"),l=0,b=4,f=0,v=-2,d=-1,y=4,w=2,E=8,T=9,A=286,k=30,z=19,D=2*A+1,W=15,B=3,Y=258,at=Y+B+1,C=42,j=113,u=1,H=2,ut=3,G=4;function dt(h,q){return h.msg=m[q],q}function K(h){return(h<<1)-(4<h?9:0)}function ft(h){for(var q=h.length;0<=--q;)h[q]=0}function F(h){var q=h.state,U=q.pending;U>h.avail_out&&(U=h.avail_out),U!==0&&(s.arraySet(h.output,q.pending_buf,q.pending_out,U,h.next_out),h.next_out+=U,q.pending_out+=U,h.total_out+=U,h.avail_out-=U,q.pending-=U,q.pending===0&&(q.pending_out=0))}function M(h,q){o._tr_flush_block(h,0<=h.block_start?h.block_start:-1,h.strstart-h.block_start,q),h.block_start=h.strstart,F(h.strm)}function ct(h,q){h.pending_buf[h.pending++]=q}function st(h,q){h.pending_buf[h.pending++]=q>>>8&255,h.pending_buf[h.pending++]=255&q}function it(h,q){var U,S,x=h.max_chain_length,O=h.strstart,Z=h.prev_length,$=h.nice_match,P=h.strstart>h.w_size-at?h.strstart-(h.w_size-at):0,Q=h.window,rt=h.w_mask,et=h.prev,lt=h.strstart+Y,wt=Q[O+Z-1],mt=Q[O+Z];h.prev_length>=h.good_match&&(x>>=2),$>h.lookahead&&($=h.lookahead);do if(Q[(U=q)+Z]===mt&&Q[U+Z-1]===wt&&Q[U]===Q[O]&&Q[++U]===Q[O+1]){O+=2,U++;do;while(Q[++O]===Q[++U]&&Q[++O]===Q[++U]&&Q[++O]===Q[++U]&&Q[++O]===Q[++U]&&Q[++O]===Q[++U]&&Q[++O]===Q[++U]&&Q[++O]===Q[++U]&&Q[++O]===Q[++U]&&O<lt);if(S=Y-(lt-O),O=lt-Y,Z<S){if(h.match_start=q,$<=(Z=S))break;wt=Q[O+Z-1],mt=Q[O+Z]}}while((q=et[q&rt])>P&&--x!=0);return Z<=h.lookahead?Z:h.lookahead}function kt(h){var q,U,S,x,O,Z,$,P,Q,rt,et=h.w_size;do{if(x=h.window_size-h.lookahead-h.strstart,h.strstart>=et+(et-at)){for(s.arraySet(h.window,h.window,et,et,0),h.match_start-=et,h.strstart-=et,h.block_start-=et,q=U=h.hash_size;S=h.head[--q],h.head[q]=et<=S?S-et:0,--U;);for(q=U=et;S=h.prev[--q],h.prev[q]=et<=S?S-et:0,--U;);x+=et}if(h.strm.avail_in===0)break;if(Z=h.strm,$=h.window,P=h.strstart+h.lookahead,Q=x,rt=void 0,rt=Z.avail_in,Q<rt&&(rt=Q),U=rt===0?0:(Z.avail_in-=rt,s.arraySet($,Z.input,Z.next_in,rt,P),Z.state.wrap===1?Z.adler=a(Z.adler,$,rt,P):Z.state.wrap===2&&(Z.adler=c(Z.adler,$,rt,P)),Z.next_in+=rt,Z.total_in+=rt,rt),h.lookahead+=U,h.lookahead+h.insert>=B)for(O=h.strstart-h.insert,h.ins_h=h.window[O],h.ins_h=(h.ins_h<<h.hash_shift^h.window[O+1])&h.hash_mask;h.insert&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[O+B-1])&h.hash_mask,h.prev[O&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=O,O++,h.insert--,!(h.lookahead+h.insert<B)););}while(h.lookahead<at&&h.strm.avail_in!==0)}function Nt(h,q){for(var U,S;;){if(h.lookahead<at){if(kt(h),h.lookahead<at&&q===l)return u;if(h.lookahead===0)break}if(U=0,h.lookahead>=B&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+B-1])&h.hash_mask,U=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),U!==0&&h.strstart-U<=h.w_size-at&&(h.match_length=it(h,U)),h.match_length>=B)if(S=o._tr_tally(h,h.strstart-h.match_start,h.match_length-B),h.lookahead-=h.match_length,h.match_length<=h.max_lazy_match&&h.lookahead>=B){for(h.match_length--;h.strstart++,h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+B-1])&h.hash_mask,U=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart,--h.match_length!=0;);h.strstart++}else h.strstart+=h.match_length,h.match_length=0,h.ins_h=h.window[h.strstart],h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+1])&h.hash_mask;else S=o._tr_tally(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++;if(S&&(M(h,!1),h.strm.avail_out===0))return u}return h.insert=h.strstart<B-1?h.strstart:B-1,q===b?(M(h,!0),h.strm.avail_out===0?ut:G):h.last_lit&&(M(h,!1),h.strm.avail_out===0)?u:H}function gt(h,q){for(var U,S,x;;){if(h.lookahead<at){if(kt(h),h.lookahead<at&&q===l)return u;if(h.lookahead===0)break}if(U=0,h.lookahead>=B&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+B-1])&h.hash_mask,U=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),h.prev_length=h.match_length,h.prev_match=h.match_start,h.match_length=B-1,U!==0&&h.prev_length<h.max_lazy_match&&h.strstart-U<=h.w_size-at&&(h.match_length=it(h,U),h.match_length<=5&&(h.strategy===1||h.match_length===B&&4096<h.strstart-h.match_start)&&(h.match_length=B-1)),h.prev_length>=B&&h.match_length<=h.prev_length){for(x=h.strstart+h.lookahead-B,S=o._tr_tally(h,h.strstart-1-h.prev_match,h.prev_length-B),h.lookahead-=h.prev_length-1,h.prev_length-=2;++h.strstart<=x&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+B-1])&h.hash_mask,U=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),--h.prev_length!=0;);if(h.match_available=0,h.match_length=B-1,h.strstart++,S&&(M(h,!1),h.strm.avail_out===0))return u}else if(h.match_available){if((S=o._tr_tally(h,0,h.window[h.strstart-1]))&&M(h,!1),h.strstart++,h.lookahead--,h.strm.avail_out===0)return u}else h.match_available=1,h.strstart++,h.lookahead--}return h.match_available&&(S=o._tr_tally(h,0,h.window[h.strstart-1]),h.match_available=0),h.insert=h.strstart<B-1?h.strstart:B-1,q===b?(M(h,!0),h.strm.avail_out===0?ut:G):h.last_lit&&(M(h,!1),h.strm.avail_out===0)?u:H}function yt(h,q,U,S,x){this.good_length=h,this.max_lazy=q,this.nice_length=U,this.max_chain=S,this.func=x}function It(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*D),this.dyn_dtree=new s.Buf16(2*(2*k+1)),this.bl_tree=new s.Buf16(2*(2*z+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(W+1),this.heap=new s.Buf16(2*A+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*A+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function St(h){var q;return h&&h.state?(h.total_in=h.total_out=0,h.data_type=w,(q=h.state).pending=0,q.pending_out=0,q.wrap<0&&(q.wrap=-q.wrap),q.status=q.wrap?C:j,h.adler=q.wrap===2?0:1,q.last_flush=l,o._tr_init(q),f):dt(h,v)}function Lt(h){var q=St(h);return q===f&&function(U){U.window_size=2*U.w_size,ft(U.head),U.max_lazy_match=r[U.level].max_lazy,U.good_match=r[U.level].good_length,U.nice_match=r[U.level].nice_length,U.max_chain_length=r[U.level].max_chain,U.strstart=0,U.block_start=0,U.lookahead=0,U.insert=0,U.match_length=U.prev_length=B-1,U.match_available=0,U.ins_h=0}(h.state),q}function Ot(h,q,U,S,x,O){if(!h)return v;var Z=1;if(q===d&&(q=6),S<0?(Z=0,S=-S):15<S&&(Z=2,S-=16),x<1||T<x||U!==E||S<8||15<S||q<0||9<q||O<0||y<O)return dt(h,v);S===8&&(S=9);var $=new It;return(h.state=$).strm=h,$.wrap=Z,$.gzhead=null,$.w_bits=S,$.w_size=1<<$.w_bits,$.w_mask=$.w_size-1,$.hash_bits=x+7,$.hash_size=1<<$.hash_bits,$.hash_mask=$.hash_size-1,$.hash_shift=~~(($.hash_bits+B-1)/B),$.window=new s.Buf8(2*$.w_size),$.head=new s.Buf16($.hash_size),$.prev=new s.Buf16($.w_size),$.lit_bufsize=1<<x+6,$.pending_buf_size=4*$.lit_bufsize,$.pending_buf=new s.Buf8($.pending_buf_size),$.d_buf=1*$.lit_bufsize,$.l_buf=3*$.lit_bufsize,$.level=q,$.strategy=O,$.method=U,Lt(h)}r=[new yt(0,0,0,0,function(h,q){var U=65535;for(U>h.pending_buf_size-5&&(U=h.pending_buf_size-5);;){if(h.lookahead<=1){if(kt(h),h.lookahead===0&&q===l)return u;if(h.lookahead===0)break}h.strstart+=h.lookahead,h.lookahead=0;var S=h.block_start+U;if((h.strstart===0||h.strstart>=S)&&(h.lookahead=h.strstart-S,h.strstart=S,M(h,!1),h.strm.avail_out===0)||h.strstart-h.block_start>=h.w_size-at&&(M(h,!1),h.strm.avail_out===0))return u}return h.insert=0,q===b?(M(h,!0),h.strm.avail_out===0?ut:G):(h.strstart>h.block_start&&(M(h,!1),h.strm.avail_out),u)}),new yt(4,4,8,4,Nt),new yt(4,5,16,8,Nt),new yt(4,6,32,32,Nt),new yt(4,4,16,16,gt),new yt(8,16,32,32,gt),new yt(8,16,128,128,gt),new yt(8,32,128,256,gt),new yt(32,128,258,1024,gt),new yt(32,258,258,4096,gt)],i.deflateInit=function(h,q){return Ot(h,q,E,15,8,0)},i.deflateInit2=Ot,i.deflateReset=Lt,i.deflateResetKeep=St,i.deflateSetHeader=function(h,q){return h&&h.state?h.state.wrap!==2?v:(h.state.gzhead=q,f):v},i.deflate=function(h,q){var U,S,x,O;if(!h||!h.state||5<q||q<0)return h?dt(h,v):v;if(S=h.state,!h.output||!h.input&&h.avail_in!==0||S.status===666&&q!==b)return dt(h,h.avail_out===0?-5:v);if(S.strm=h,U=S.last_flush,S.last_flush=q,S.status===C)if(S.wrap===2)h.adler=0,ct(S,31),ct(S,139),ct(S,8),S.gzhead?(ct(S,(S.gzhead.text?1:0)+(S.gzhead.hcrc?2:0)+(S.gzhead.extra?4:0)+(S.gzhead.name?8:0)+(S.gzhead.comment?16:0)),ct(S,255&S.gzhead.time),ct(S,S.gzhead.time>>8&255),ct(S,S.gzhead.time>>16&255),ct(S,S.gzhead.time>>24&255),ct(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),ct(S,255&S.gzhead.os),S.gzhead.extra&&S.gzhead.extra.length&&(ct(S,255&S.gzhead.extra.length),ct(S,S.gzhead.extra.length>>8&255)),S.gzhead.hcrc&&(h.adler=c(h.adler,S.pending_buf,S.pending,0)),S.gzindex=0,S.status=69):(ct(S,0),ct(S,0),ct(S,0),ct(S,0),ct(S,0),ct(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),ct(S,3),S.status=j);else{var Z=E+(S.w_bits-8<<4)<<8;Z|=(2<=S.strategy||S.level<2?0:S.level<6?1:S.level===6?2:3)<<6,S.strstart!==0&&(Z|=32),Z+=31-Z%31,S.status=j,st(S,Z),S.strstart!==0&&(st(S,h.adler>>>16),st(S,65535&h.adler)),h.adler=1}if(S.status===69)if(S.gzhead.extra){for(x=S.pending;S.gzindex<(65535&S.gzhead.extra.length)&&(S.pending!==S.pending_buf_size||(S.gzhead.hcrc&&S.pending>x&&(h.adler=c(h.adler,S.pending_buf,S.pending-x,x)),F(h),x=S.pending,S.pending!==S.pending_buf_size));)ct(S,255&S.gzhead.extra[S.gzindex]),S.gzindex++;S.gzhead.hcrc&&S.pending>x&&(h.adler=c(h.adler,S.pending_buf,S.pending-x,x)),S.gzindex===S.gzhead.extra.length&&(S.gzindex=0,S.status=73)}else S.status=73;if(S.status===73)if(S.gzhead.name){x=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>x&&(h.adler=c(h.adler,S.pending_buf,S.pending-x,x)),F(h),x=S.pending,S.pending===S.pending_buf_size)){O=1;break}O=S.gzindex<S.gzhead.name.length?255&S.gzhead.name.charCodeAt(S.gzindex++):0,ct(S,O)}while(O!==0);S.gzhead.hcrc&&S.pending>x&&(h.adler=c(h.adler,S.pending_buf,S.pending-x,x)),O===0&&(S.gzindex=0,S.status=91)}else S.status=91;if(S.status===91)if(S.gzhead.comment){x=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>x&&(h.adler=c(h.adler,S.pending_buf,S.pending-x,x)),F(h),x=S.pending,S.pending===S.pending_buf_size)){O=1;break}O=S.gzindex<S.gzhead.comment.length?255&S.gzhead.comment.charCodeAt(S.gzindex++):0,ct(S,O)}while(O!==0);S.gzhead.hcrc&&S.pending>x&&(h.adler=c(h.adler,S.pending_buf,S.pending-x,x)),O===0&&(S.status=103)}else S.status=103;if(S.status===103&&(S.gzhead.hcrc?(S.pending+2>S.pending_buf_size&&F(h),S.pending+2<=S.pending_buf_size&&(ct(S,255&h.adler),ct(S,h.adler>>8&255),h.adler=0,S.status=j)):S.status=j),S.pending!==0){if(F(h),h.avail_out===0)return S.last_flush=-1,f}else if(h.avail_in===0&&K(q)<=K(U)&&q!==b)return dt(h,-5);if(S.status===666&&h.avail_in!==0)return dt(h,-5);if(h.avail_in!==0||S.lookahead!==0||q!==l&&S.status!==666){var $=S.strategy===2?function(P,Q){for(var rt;;){if(P.lookahead===0&&(kt(P),P.lookahead===0)){if(Q===l)return u;break}if(P.match_length=0,rt=o._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++,rt&&(M(P,!1),P.strm.avail_out===0))return u}return P.insert=0,Q===b?(M(P,!0),P.strm.avail_out===0?ut:G):P.last_lit&&(M(P,!1),P.strm.avail_out===0)?u:H}(S,q):S.strategy===3?function(P,Q){for(var rt,et,lt,wt,mt=P.window;;){if(P.lookahead<=Y){if(kt(P),P.lookahead<=Y&&Q===l)return u;if(P.lookahead===0)break}if(P.match_length=0,P.lookahead>=B&&0<P.strstart&&(et=mt[lt=P.strstart-1])===mt[++lt]&&et===mt[++lt]&&et===mt[++lt]){wt=P.strstart+Y;do;while(et===mt[++lt]&&et===mt[++lt]&&et===mt[++lt]&&et===mt[++lt]&&et===mt[++lt]&&et===mt[++lt]&&et===mt[++lt]&&et===mt[++lt]&&lt<wt);P.match_length=Y-(wt-lt),P.match_length>P.lookahead&&(P.match_length=P.lookahead)}if(P.match_length>=B?(rt=o._tr_tally(P,1,P.match_length-B),P.lookahead-=P.match_length,P.strstart+=P.match_length,P.match_length=0):(rt=o._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++),rt&&(M(P,!1),P.strm.avail_out===0))return u}return P.insert=0,Q===b?(M(P,!0),P.strm.avail_out===0?ut:G):P.last_lit&&(M(P,!1),P.strm.avail_out===0)?u:H}(S,q):r[S.level].func(S,q);if($!==ut&&$!==G||(S.status=666),$===u||$===ut)return h.avail_out===0&&(S.last_flush=-1),f;if($===H&&(q===1?o._tr_align(S):q!==5&&(o._tr_stored_block(S,0,0,!1),q===3&&(ft(S.head),S.lookahead===0&&(S.strstart=0,S.block_start=0,S.insert=0))),F(h),h.avail_out===0))return S.last_flush=-1,f}return q!==b?f:S.wrap<=0?1:(S.wrap===2?(ct(S,255&h.adler),ct(S,h.adler>>8&255),ct(S,h.adler>>16&255),ct(S,h.adler>>24&255),ct(S,255&h.total_in),ct(S,h.total_in>>8&255),ct(S,h.total_in>>16&255),ct(S,h.total_in>>24&255)):(st(S,h.adler>>>16),st(S,65535&h.adler)),F(h),0<S.wrap&&(S.wrap=-S.wrap),S.pending!==0?f:1)},i.deflateEnd=function(h){var q;return h&&h.state?(q=h.state.status)!==C&&q!==69&&q!==73&&q!==91&&q!==103&&q!==j&&q!==666?dt(h,v):(h.state=null,q===j?dt(h,-3):f):v},i.deflateSetDictionary=function(h,q){var U,S,x,O,Z,$,P,Q,rt=q.length;if(!h||!h.state||(O=(U=h.state).wrap)===2||O===1&&U.status!==C||U.lookahead)return v;for(O===1&&(h.adler=a(h.adler,q,rt,0)),U.wrap=0,rt>=U.w_size&&(O===0&&(ft(U.head),U.strstart=0,U.block_start=0,U.insert=0),Q=new s.Buf8(U.w_size),s.arraySet(Q,q,rt-U.w_size,U.w_size,0),q=Q,rt=U.w_size),Z=h.avail_in,$=h.next_in,P=h.input,h.avail_in=rt,h.next_in=0,h.input=q,kt(U);U.lookahead>=B;){for(S=U.strstart,x=U.lookahead-(B-1);U.ins_h=(U.ins_h<<U.hash_shift^U.window[S+B-1])&U.hash_mask,U.prev[S&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=S,S++,--x;);U.strstart=S,U.lookahead=B-1,kt(U)}return U.strstart+=U.lookahead,U.block_start=U.strstart,U.insert=U.lookahead,U.lookahead=0,U.match_length=U.prev_length=B-1,U.match_available=0,h.next_in=$,h.input=P,h.avail_in=Z,U.wrap=O,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,n,i){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,n,i){n.exports=function(r,s){var o,a,c,m,l,b,f,v,d,y,w,E,T,A,k,z,D,W,B,Y,at,C,j,u,H;o=r.state,a=r.next_in,u=r.input,c=a+(r.avail_in-5),m=r.next_out,H=r.output,l=m-(s-r.avail_out),b=m+(r.avail_out-257),f=o.dmax,v=o.wsize,d=o.whave,y=o.wnext,w=o.window,E=o.hold,T=o.bits,A=o.lencode,k=o.distcode,z=(1<<o.lenbits)-1,D=(1<<o.distbits)-1;t:do{T<15&&(E+=u[a++]<<T,T+=8,E+=u[a++]<<T,T+=8),W=A[E&z];e:for(;;){if(E>>>=B=W>>>24,T-=B,(B=W>>>16&255)===0)H[m++]=65535&W;else{if(!(16&B)){if((64&B)==0){W=A[(65535&W)+(E&(1<<B)-1)];continue e}if(32&B){o.mode=12;break t}r.msg="invalid literal/length code",o.mode=30;break t}Y=65535&W,(B&=15)&&(T<B&&(E+=u[a++]<<T,T+=8),Y+=E&(1<<B)-1,E>>>=B,T-=B),T<15&&(E+=u[a++]<<T,T+=8,E+=u[a++]<<T,T+=8),W=k[E&D];n:for(;;){if(E>>>=B=W>>>24,T-=B,!(16&(B=W>>>16&255))){if((64&B)==0){W=k[(65535&W)+(E&(1<<B)-1)];continue n}r.msg="invalid distance code",o.mode=30;break t}if(at=65535&W,T<(B&=15)&&(E+=u[a++]<<T,(T+=8)<B&&(E+=u[a++]<<T,T+=8)),f<(at+=E&(1<<B)-1)){r.msg="invalid distance too far back",o.mode=30;break t}if(E>>>=B,T-=B,(B=m-l)<at){if(d<(B=at-B)&&o.sane){r.msg="invalid distance too far back",o.mode=30;break t}if(j=w,(C=0)===y){if(C+=v-B,B<Y){for(Y-=B;H[m++]=w[C++],--B;);C=m-at,j=H}}else if(y<B){if(C+=v+y-B,(B-=y)<Y){for(Y-=B;H[m++]=w[C++],--B;);if(C=0,y<Y){for(Y-=B=y;H[m++]=w[C++],--B;);C=m-at,j=H}}}else if(C+=y-B,B<Y){for(Y-=B;H[m++]=w[C++],--B;);C=m-at,j=H}for(;2<Y;)H[m++]=j[C++],H[m++]=j[C++],H[m++]=j[C++],Y-=3;Y&&(H[m++]=j[C++],1<Y&&(H[m++]=j[C++]))}else{for(C=m-at;H[m++]=H[C++],H[m++]=H[C++],H[m++]=H[C++],2<(Y-=3););Y&&(H[m++]=H[C++],1<Y&&(H[m++]=H[C++]))}break}}break}}while(a<c&&m<b);a-=Y=T>>3,E&=(1<<(T-=Y<<3))-1,r.next_in=a,r.next_out=m,r.avail_in=a<c?c-a+5:5-(a-c),r.avail_out=m<b?b-m+257:257-(m-b),o.hold=E,o.bits=T}},{}],49:[function(e,n,i){var r=e("../utils/common"),s=e("./adler32"),o=e("./crc32"),a=e("./inffast"),c=e("./inftrees"),m=1,l=2,b=0,f=-2,v=1,d=852,y=592;function w(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function E(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(C){var j;return C&&C.state?(j=C.state,C.total_in=C.total_out=j.total=0,C.msg="",j.wrap&&(C.adler=1&j.wrap),j.mode=v,j.last=0,j.havedict=0,j.dmax=32768,j.head=null,j.hold=0,j.bits=0,j.lencode=j.lendyn=new r.Buf32(d),j.distcode=j.distdyn=new r.Buf32(y),j.sane=1,j.back=-1,b):f}function A(C){var j;return C&&C.state?((j=C.state).wsize=0,j.whave=0,j.wnext=0,T(C)):f}function k(C,j){var u,H;return C&&C.state?(H=C.state,j<0?(u=0,j=-j):(u=1+(j>>4),j<48&&(j&=15)),j&&(j<8||15<j)?f:(H.window!==null&&H.wbits!==j&&(H.window=null),H.wrap=u,H.wbits=j,A(C))):f}function z(C,j){var u,H;return C?(H=new E,(C.state=H).window=null,(u=k(C,j))!==b&&(C.state=null),u):f}var D,W,B=!0;function Y(C){if(B){var j;for(D=new r.Buf32(512),W=new r.Buf32(32),j=0;j<144;)C.lens[j++]=8;for(;j<256;)C.lens[j++]=9;for(;j<280;)C.lens[j++]=7;for(;j<288;)C.lens[j++]=8;for(c(m,C.lens,0,288,D,0,C.work,{bits:9}),j=0;j<32;)C.lens[j++]=5;c(l,C.lens,0,32,W,0,C.work,{bits:5}),B=!1}C.lencode=D,C.lenbits=9,C.distcode=W,C.distbits=5}function at(C,j,u,H){var ut,G=C.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new r.Buf8(G.wsize)),H>=G.wsize?(r.arraySet(G.window,j,u-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(H<(ut=G.wsize-G.wnext)&&(ut=H),r.arraySet(G.window,j,u-H,ut,G.wnext),(H-=ut)?(r.arraySet(G.window,j,u-H,H,0),G.wnext=H,G.whave=G.wsize):(G.wnext+=ut,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=ut))),0}i.inflateReset=A,i.inflateReset2=k,i.inflateResetKeep=T,i.inflateInit=function(C){return z(C,15)},i.inflateInit2=z,i.inflate=function(C,j){var u,H,ut,G,dt,K,ft,F,M,ct,st,it,kt,Nt,gt,yt,It,St,Lt,Ot,h,q,U,S,x=0,O=new r.Buf8(4),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return f;(u=C.state).mode===12&&(u.mode=13),dt=C.next_out,ut=C.output,ft=C.avail_out,G=C.next_in,H=C.input,K=C.avail_in,F=u.hold,M=u.bits,ct=K,st=ft,q=b;t:for(;;)switch(u.mode){case v:if(u.wrap===0){u.mode=13;break}for(;M<16;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}if(2&u.wrap&&F===35615){O[u.check=0]=255&F,O[1]=F>>>8&255,u.check=o(u.check,O,2,0),M=F=0,u.mode=2;break}if(u.flags=0,u.head&&(u.head.done=!1),!(1&u.wrap)||(((255&F)<<8)+(F>>8))%31){C.msg="incorrect header check",u.mode=30;break}if((15&F)!=8){C.msg="unknown compression method",u.mode=30;break}if(M-=4,h=8+(15&(F>>>=4)),u.wbits===0)u.wbits=h;else if(h>u.wbits){C.msg="invalid window size",u.mode=30;break}u.dmax=1<<h,C.adler=u.check=1,u.mode=512&F?10:12,M=F=0;break;case 2:for(;M<16;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}if(u.flags=F,(255&u.flags)!=8){C.msg="unknown compression method",u.mode=30;break}if(57344&u.flags){C.msg="unknown header flags set",u.mode=30;break}u.head&&(u.head.text=F>>8&1),512&u.flags&&(O[0]=255&F,O[1]=F>>>8&255,u.check=o(u.check,O,2,0)),M=F=0,u.mode=3;case 3:for(;M<32;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}u.head&&(u.head.time=F),512&u.flags&&(O[0]=255&F,O[1]=F>>>8&255,O[2]=F>>>16&255,O[3]=F>>>24&255,u.check=o(u.check,O,4,0)),M=F=0,u.mode=4;case 4:for(;M<16;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}u.head&&(u.head.xflags=255&F,u.head.os=F>>8),512&u.flags&&(O[0]=255&F,O[1]=F>>>8&255,u.check=o(u.check,O,2,0)),M=F=0,u.mode=5;case 5:if(1024&u.flags){for(;M<16;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}u.length=F,u.head&&(u.head.extra_len=F),512&u.flags&&(O[0]=255&F,O[1]=F>>>8&255,u.check=o(u.check,O,2,0)),M=F=0}else u.head&&(u.head.extra=null);u.mode=6;case 6:if(1024&u.flags&&(K<(it=u.length)&&(it=K),it&&(u.head&&(h=u.head.extra_len-u.length,u.head.extra||(u.head.extra=new Array(u.head.extra_len)),r.arraySet(u.head.extra,H,G,it,h)),512&u.flags&&(u.check=o(u.check,H,it,G)),K-=it,G+=it,u.length-=it),u.length))break t;u.length=0,u.mode=7;case 7:if(2048&u.flags){if(K===0)break t;for(it=0;h=H[G+it++],u.head&&h&&u.length<65536&&(u.head.name+=String.fromCharCode(h)),h&&it<K;);if(512&u.flags&&(u.check=o(u.check,H,it,G)),K-=it,G+=it,h)break t}else u.head&&(u.head.name=null);u.length=0,u.mode=8;case 8:if(4096&u.flags){if(K===0)break t;for(it=0;h=H[G+it++],u.head&&h&&u.length<65536&&(u.head.comment+=String.fromCharCode(h)),h&&it<K;);if(512&u.flags&&(u.check=o(u.check,H,it,G)),K-=it,G+=it,h)break t}else u.head&&(u.head.comment=null);u.mode=9;case 9:if(512&u.flags){for(;M<16;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}if(F!==(65535&u.check)){C.msg="header crc mismatch",u.mode=30;break}M=F=0}u.head&&(u.head.hcrc=u.flags>>9&1,u.head.done=!0),C.adler=u.check=0,u.mode=12;break;case 10:for(;M<32;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}C.adler=u.check=w(F),M=F=0,u.mode=11;case 11:if(u.havedict===0)return C.next_out=dt,C.avail_out=ft,C.next_in=G,C.avail_in=K,u.hold=F,u.bits=M,2;C.adler=u.check=1,u.mode=12;case 12:if(j===5||j===6)break t;case 13:if(u.last){F>>>=7&M,M-=7&M,u.mode=27;break}for(;M<3;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}switch(u.last=1&F,M-=1,3&(F>>>=1)){case 0:u.mode=14;break;case 1:if(Y(u),u.mode=20,j!==6)break;F>>>=2,M-=2;break t;case 2:u.mode=17;break;case 3:C.msg="invalid block type",u.mode=30}F>>>=2,M-=2;break;case 14:for(F>>>=7&M,M-=7&M;M<32;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}if((65535&F)!=(F>>>16^65535)){C.msg="invalid stored block lengths",u.mode=30;break}if(u.length=65535&F,M=F=0,u.mode=15,j===6)break t;case 15:u.mode=16;case 16:if(it=u.length){if(K<it&&(it=K),ft<it&&(it=ft),it===0)break t;r.arraySet(ut,H,G,it,dt),K-=it,G+=it,ft-=it,dt+=it,u.length-=it;break}u.mode=12;break;case 17:for(;M<14;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}if(u.nlen=257+(31&F),F>>>=5,M-=5,u.ndist=1+(31&F),F>>>=5,M-=5,u.ncode=4+(15&F),F>>>=4,M-=4,286<u.nlen||30<u.ndist){C.msg="too many length or distance symbols",u.mode=30;break}u.have=0,u.mode=18;case 18:for(;u.have<u.ncode;){for(;M<3;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}u.lens[Z[u.have++]]=7&F,F>>>=3,M-=3}for(;u.have<19;)u.lens[Z[u.have++]]=0;if(u.lencode=u.lendyn,u.lenbits=7,U={bits:u.lenbits},q=c(0,u.lens,0,19,u.lencode,0,u.work,U),u.lenbits=U.bits,q){C.msg="invalid code lengths set",u.mode=30;break}u.have=0,u.mode=19;case 19:for(;u.have<u.nlen+u.ndist;){for(;yt=(x=u.lencode[F&(1<<u.lenbits)-1])>>>16&255,It=65535&x,!((gt=x>>>24)<=M);){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}if(It<16)F>>>=gt,M-=gt,u.lens[u.have++]=It;else{if(It===16){for(S=gt+2;M<S;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}if(F>>>=gt,M-=gt,u.have===0){C.msg="invalid bit length repeat",u.mode=30;break}h=u.lens[u.have-1],it=3+(3&F),F>>>=2,M-=2}else if(It===17){for(S=gt+3;M<S;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}M-=gt,h=0,it=3+(7&(F>>>=gt)),F>>>=3,M-=3}else{for(S=gt+7;M<S;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}M-=gt,h=0,it=11+(127&(F>>>=gt)),F>>>=7,M-=7}if(u.have+it>u.nlen+u.ndist){C.msg="invalid bit length repeat",u.mode=30;break}for(;it--;)u.lens[u.have++]=h}}if(u.mode===30)break;if(u.lens[256]===0){C.msg="invalid code -- missing end-of-block",u.mode=30;break}if(u.lenbits=9,U={bits:u.lenbits},q=c(m,u.lens,0,u.nlen,u.lencode,0,u.work,U),u.lenbits=U.bits,q){C.msg="invalid literal/lengths set",u.mode=30;break}if(u.distbits=6,u.distcode=u.distdyn,U={bits:u.distbits},q=c(l,u.lens,u.nlen,u.ndist,u.distcode,0,u.work,U),u.distbits=U.bits,q){C.msg="invalid distances set",u.mode=30;break}if(u.mode=20,j===6)break t;case 20:u.mode=21;case 21:if(6<=K&&258<=ft){C.next_out=dt,C.avail_out=ft,C.next_in=G,C.avail_in=K,u.hold=F,u.bits=M,a(C,st),dt=C.next_out,ut=C.output,ft=C.avail_out,G=C.next_in,H=C.input,K=C.avail_in,F=u.hold,M=u.bits,u.mode===12&&(u.back=-1);break}for(u.back=0;yt=(x=u.lencode[F&(1<<u.lenbits)-1])>>>16&255,It=65535&x,!((gt=x>>>24)<=M);){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}if(yt&&(240&yt)==0){for(St=gt,Lt=yt,Ot=It;yt=(x=u.lencode[Ot+((F&(1<<St+Lt)-1)>>St)])>>>16&255,It=65535&x,!(St+(gt=x>>>24)<=M);){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}F>>>=St,M-=St,u.back+=St}if(F>>>=gt,M-=gt,u.back+=gt,u.length=It,yt===0){u.mode=26;break}if(32&yt){u.back=-1,u.mode=12;break}if(64&yt){C.msg="invalid literal/length code",u.mode=30;break}u.extra=15&yt,u.mode=22;case 22:if(u.extra){for(S=u.extra;M<S;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}u.length+=F&(1<<u.extra)-1,F>>>=u.extra,M-=u.extra,u.back+=u.extra}u.was=u.length,u.mode=23;case 23:for(;yt=(x=u.distcode[F&(1<<u.distbits)-1])>>>16&255,It=65535&x,!((gt=x>>>24)<=M);){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}if((240&yt)==0){for(St=gt,Lt=yt,Ot=It;yt=(x=u.distcode[Ot+((F&(1<<St+Lt)-1)>>St)])>>>16&255,It=65535&x,!(St+(gt=x>>>24)<=M);){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}F>>>=St,M-=St,u.back+=St}if(F>>>=gt,M-=gt,u.back+=gt,64&yt){C.msg="invalid distance code",u.mode=30;break}u.offset=It,u.extra=15&yt,u.mode=24;case 24:if(u.extra){for(S=u.extra;M<S;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}u.offset+=F&(1<<u.extra)-1,F>>>=u.extra,M-=u.extra,u.back+=u.extra}if(u.offset>u.dmax){C.msg="invalid distance too far back",u.mode=30;break}u.mode=25;case 25:if(ft===0)break t;if(it=st-ft,u.offset>it){if((it=u.offset-it)>u.whave&&u.sane){C.msg="invalid distance too far back",u.mode=30;break}kt=it>u.wnext?(it-=u.wnext,u.wsize-it):u.wnext-it,it>u.length&&(it=u.length),Nt=u.window}else Nt=ut,kt=dt-u.offset,it=u.length;for(ft<it&&(it=ft),ft-=it,u.length-=it;ut[dt++]=Nt[kt++],--it;);u.length===0&&(u.mode=21);break;case 26:if(ft===0)break t;ut[dt++]=u.length,ft--,u.mode=21;break;case 27:if(u.wrap){for(;M<32;){if(K===0)break t;K--,F|=H[G++]<<M,M+=8}if(st-=ft,C.total_out+=st,u.total+=st,st&&(C.adler=u.check=u.flags?o(u.check,ut,st,dt-st):s(u.check,ut,st,dt-st)),st=ft,(u.flags?F:w(F))!==u.check){C.msg="incorrect data check",u.mode=30;break}M=F=0}u.mode=28;case 28:if(u.wrap&&u.flags){for(;M<32;){if(K===0)break t;K--,F+=H[G++]<<M,M+=8}if(F!==(4294967295&u.total)){C.msg="incorrect length check",u.mode=30;break}M=F=0}u.mode=29;case 29:q=1;break t;case 30:q=-3;break t;case 31:return-4;case 32:default:return f}return C.next_out=dt,C.avail_out=ft,C.next_in=G,C.avail_in=K,u.hold=F,u.bits=M,(u.wsize||st!==C.avail_out&&u.mode<30&&(u.mode<27||j!==4))&&at(C,C.output,C.next_out,st-C.avail_out)?(u.mode=31,-4):(ct-=C.avail_in,st-=C.avail_out,C.total_in+=ct,C.total_out+=st,u.total+=st,u.wrap&&st&&(C.adler=u.check=u.flags?o(u.check,ut,st,C.next_out-st):s(u.check,ut,st,C.next_out-st)),C.data_type=u.bits+(u.last?64:0)+(u.mode===12?128:0)+(u.mode===20||u.mode===15?256:0),(ct==0&&st===0||j===4)&&q===b&&(q=-5),q)},i.inflateEnd=function(C){if(!C||!C.state)return f;var j=C.state;return j.window&&(j.window=null),C.state=null,b},i.inflateGetHeader=function(C,j){var u;return C&&C.state?(2&(u=C.state).wrap)==0?f:((u.head=j).done=!1,b):f},i.inflateSetDictionary=function(C,j){var u,H=j.length;return C&&C.state?(u=C.state).wrap!==0&&u.mode!==11?f:u.mode===11&&s(1,j,H,0)!==u.check?-3:at(C,j,H,H)?(u.mode=31,-4):(u.havedict=1,b):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,n,i){var r=e("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(m,l,b,f,v,d,y,w){var E,T,A,k,z,D,W,B,Y,at=w.bits,C=0,j=0,u=0,H=0,ut=0,G=0,dt=0,K=0,ft=0,F=0,M=null,ct=0,st=new r.Buf16(16),it=new r.Buf16(16),kt=null,Nt=0;for(C=0;C<=15;C++)st[C]=0;for(j=0;j<f;j++)st[l[b+j]]++;for(ut=at,H=15;1<=H&&st[H]===0;H--);if(H<ut&&(ut=H),H===0)return v[d++]=20971520,v[d++]=20971520,w.bits=1,0;for(u=1;u<H&&st[u]===0;u++);for(ut<u&&(ut=u),C=K=1;C<=15;C++)if(K<<=1,(K-=st[C])<0)return-1;if(0<K&&(m===0||H!==1))return-1;for(it[1]=0,C=1;C<15;C++)it[C+1]=it[C]+st[C];for(j=0;j<f;j++)l[b+j]!==0&&(y[it[l[b+j]]++]=j);if(D=m===0?(M=kt=y,19):m===1?(M=s,ct-=257,kt=o,Nt-=257,256):(M=a,kt=c,-1),C=u,z=d,dt=j=F=0,A=-1,k=(ft=1<<(G=ut))-1,m===1&&852<ft||m===2&&592<ft)return 1;for(;;){for(W=C-dt,Y=y[j]<D?(B=0,y[j]):y[j]>D?(B=kt[Nt+y[j]],M[ct+y[j]]):(B=96,0),E=1<<C-dt,u=T=1<<G;v[z+(F>>dt)+(T-=E)]=W<<24|B<<16|Y|0,T!==0;);for(E=1<<C-1;F&E;)E>>=1;if(E!==0?(F&=E-1,F+=E):F=0,j++,--st[C]==0){if(C===H)break;C=l[b+y[j]]}if(ut<C&&(F&k)!==A){for(dt===0&&(dt=ut),z+=u,K=1<<(G=C-dt);G+dt<H&&!((K-=st[G+dt])<=0);)G++,K<<=1;if(ft+=1<<G,m===1&&852<ft||m===2&&592<ft)return 1;v[A=F&k]=ut<<24|G<<16|z-d|0}}return F!==0&&(v[z+F]=C-dt<<24|64<<16|0),w.bits=ut,0}},{"../utils/common":41}],51:[function(e,n,i){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,n,i){var r=e("../utils/common"),s=0,o=1;function a(x){for(var O=x.length;0<=--O;)x[O]=0}var c=0,m=29,l=256,b=l+1+m,f=30,v=19,d=2*b+1,y=15,w=16,E=7,T=256,A=16,k=17,z=18,D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],W=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],at=new Array(2*(b+2));a(at);var C=new Array(2*f);a(C);var j=new Array(512);a(j);var u=new Array(256);a(u);var H=new Array(m);a(H);var ut,G,dt,K=new Array(f);function ft(x,O,Z,$,P){this.static_tree=x,this.extra_bits=O,this.extra_base=Z,this.elems=$,this.max_length=P,this.has_stree=x&&x.length}function F(x,O){this.dyn_tree=x,this.max_code=0,this.stat_desc=O}function M(x){return x<256?j[x]:j[256+(x>>>7)]}function ct(x,O){x.pending_buf[x.pending++]=255&O,x.pending_buf[x.pending++]=O>>>8&255}function st(x,O,Z){x.bi_valid>w-Z?(x.bi_buf|=O<<x.bi_valid&65535,ct(x,x.bi_buf),x.bi_buf=O>>w-x.bi_valid,x.bi_valid+=Z-w):(x.bi_buf|=O<<x.bi_valid&65535,x.bi_valid+=Z)}function it(x,O,Z){st(x,Z[2*O],Z[2*O+1])}function kt(x,O){for(var Z=0;Z|=1&x,x>>>=1,Z<<=1,0<--O;);return Z>>>1}function Nt(x,O,Z){var $,P,Q=new Array(y+1),rt=0;for($=1;$<=y;$++)Q[$]=rt=rt+Z[$-1]<<1;for(P=0;P<=O;P++){var et=x[2*P+1];et!==0&&(x[2*P]=kt(Q[et]++,et))}}function gt(x){var O;for(O=0;O<b;O++)x.dyn_ltree[2*O]=0;for(O=0;O<f;O++)x.dyn_dtree[2*O]=0;for(O=0;O<v;O++)x.bl_tree[2*O]=0;x.dyn_ltree[2*T]=1,x.opt_len=x.static_len=0,x.last_lit=x.matches=0}function yt(x){8<x.bi_valid?ct(x,x.bi_buf):0<x.bi_valid&&(x.pending_buf[x.pending++]=x.bi_buf),x.bi_buf=0,x.bi_valid=0}function It(x,O,Z,$){var P=2*O,Q=2*Z;return x[P]<x[Q]||x[P]===x[Q]&&$[O]<=$[Z]}function St(x,O,Z){for(var $=x.heap[Z],P=Z<<1;P<=x.heap_len&&(P<x.heap_len&&It(O,x.heap[P+1],x.heap[P],x.depth)&&P++,!It(O,$,x.heap[P],x.depth));)x.heap[Z]=x.heap[P],Z=P,P<<=1;x.heap[Z]=$}function Lt(x,O,Z){var $,P,Q,rt,et=0;if(x.last_lit!==0)for(;$=x.pending_buf[x.d_buf+2*et]<<8|x.pending_buf[x.d_buf+2*et+1],P=x.pending_buf[x.l_buf+et],et++,$===0?it(x,P,O):(it(x,(Q=u[P])+l+1,O),(rt=D[Q])!==0&&st(x,P-=H[Q],rt),it(x,Q=M(--$),Z),(rt=W[Q])!==0&&st(x,$-=K[Q],rt)),et<x.last_lit;);it(x,T,O)}function Ot(x,O){var Z,$,P,Q=O.dyn_tree,rt=O.stat_desc.static_tree,et=O.stat_desc.has_stree,lt=O.stat_desc.elems,wt=-1;for(x.heap_len=0,x.heap_max=d,Z=0;Z<lt;Z++)Q[2*Z]!==0?(x.heap[++x.heap_len]=wt=Z,x.depth[Z]=0):Q[2*Z+1]=0;for(;x.heap_len<2;)Q[2*(P=x.heap[++x.heap_len]=wt<2?++wt:0)]=1,x.depth[P]=0,x.opt_len--,et&&(x.static_len-=rt[2*P+1]);for(O.max_code=wt,Z=x.heap_len>>1;1<=Z;Z--)St(x,Q,Z);for(P=lt;Z=x.heap[1],x.heap[1]=x.heap[x.heap_len--],St(x,Q,1),$=x.heap[1],x.heap[--x.heap_max]=Z,x.heap[--x.heap_max]=$,Q[2*P]=Q[2*Z]+Q[2*$],x.depth[P]=(x.depth[Z]>=x.depth[$]?x.depth[Z]:x.depth[$])+1,Q[2*Z+1]=Q[2*$+1]=P,x.heap[1]=P++,St(x,Q,1),2<=x.heap_len;);x.heap[--x.heap_max]=x.heap[1],function(mt,Rt){var qt,Dt,Ht,xt,Vt,se,jt=Rt.dyn_tree,te=Rt.max_code,ce=Rt.stat_desc.static_tree,Se=Rt.stat_desc.has_stree,Mt=Rt.stat_desc.extra_bits,ue=Rt.stat_desc.extra_base,Xt=Rt.stat_desc.max_length,Kt=0;for(xt=0;xt<=y;xt++)mt.bl_count[xt]=0;for(jt[2*mt.heap[mt.heap_max]+1]=0,qt=mt.heap_max+1;qt<d;qt++)Xt<(xt=jt[2*jt[2*(Dt=mt.heap[qt])+1]+1]+1)&&(xt=Xt,Kt++),jt[2*Dt+1]=xt,te<Dt||(mt.bl_count[xt]++,Vt=0,ue<=Dt&&(Vt=Mt[Dt-ue]),se=jt[2*Dt],mt.opt_len+=se*(xt+Vt),Se&&(mt.static_len+=se*(ce[2*Dt+1]+Vt)));if(Kt!==0){do{for(xt=Xt-1;mt.bl_count[xt]===0;)xt--;mt.bl_count[xt]--,mt.bl_count[xt+1]+=2,mt.bl_count[Xt]--,Kt-=2}while(0<Kt);for(xt=Xt;xt!==0;xt--)for(Dt=mt.bl_count[xt];Dt!==0;)te<(Ht=mt.heap[--qt])||(jt[2*Ht+1]!==xt&&(mt.opt_len+=(xt-jt[2*Ht+1])*jt[2*Ht],jt[2*Ht+1]=xt),Dt--)}}(x,O),Nt(Q,wt,x.bl_count)}function h(x,O,Z){var $,P,Q=-1,rt=O[1],et=0,lt=7,wt=4;for(rt===0&&(lt=138,wt=3),O[2*(Z+1)+1]=65535,$=0;$<=Z;$++)P=rt,rt=O[2*($+1)+1],++et<lt&&P===rt||(et<wt?x.bl_tree[2*P]+=et:P!==0?(P!==Q&&x.bl_tree[2*P]++,x.bl_tree[2*A]++):et<=10?x.bl_tree[2*k]++:x.bl_tree[2*z]++,Q=P,wt=(et=0)===rt?(lt=138,3):P===rt?(lt=6,3):(lt=7,4))}function q(x,O,Z){var $,P,Q=-1,rt=O[1],et=0,lt=7,wt=4;for(rt===0&&(lt=138,wt=3),$=0;$<=Z;$++)if(P=rt,rt=O[2*($+1)+1],!(++et<lt&&P===rt)){if(et<wt)for(;it(x,P,x.bl_tree),--et!=0;);else P!==0?(P!==Q&&(it(x,P,x.bl_tree),et--),it(x,A,x.bl_tree),st(x,et-3,2)):et<=10?(it(x,k,x.bl_tree),st(x,et-3,3)):(it(x,z,x.bl_tree),st(x,et-11,7));Q=P,wt=(et=0)===rt?(lt=138,3):P===rt?(lt=6,3):(lt=7,4)}}a(K);var U=!1;function S(x,O,Z,$){st(x,(c<<1)+($?1:0),3),function(P,Q,rt,et){yt(P),ct(P,rt),ct(P,~rt),r.arraySet(P.pending_buf,P.window,Q,rt,P.pending),P.pending+=rt}(x,O,Z)}i._tr_init=function(x){U||(function(){var O,Z,$,P,Q,rt=new Array(y+1);for(P=$=0;P<m-1;P++)for(H[P]=$,O=0;O<1<<D[P];O++)u[$++]=P;for(u[$-1]=P,P=Q=0;P<16;P++)for(K[P]=Q,O=0;O<1<<W[P];O++)j[Q++]=P;for(Q>>=7;P<f;P++)for(K[P]=Q<<7,O=0;O<1<<W[P]-7;O++)j[256+Q++]=P;for(Z=0;Z<=y;Z++)rt[Z]=0;for(O=0;O<=143;)at[2*O+1]=8,O++,rt[8]++;for(;O<=255;)at[2*O+1]=9,O++,rt[9]++;for(;O<=279;)at[2*O+1]=7,O++,rt[7]++;for(;O<=287;)at[2*O+1]=8,O++,rt[8]++;for(Nt(at,b+1,rt),O=0;O<f;O++)C[2*O+1]=5,C[2*O]=kt(O,5);ut=new ft(at,D,l+1,b,y),G=new ft(C,W,0,f,y),dt=new ft(new Array(0),B,0,v,E)}(),U=!0),x.l_desc=new F(x.dyn_ltree,ut),x.d_desc=new F(x.dyn_dtree,G),x.bl_desc=new F(x.bl_tree,dt),x.bi_buf=0,x.bi_valid=0,gt(x)},i._tr_stored_block=S,i._tr_flush_block=function(x,O,Z,$){var P,Q,rt=0;0<x.level?(x.strm.data_type===2&&(x.strm.data_type=function(et){var lt,wt=4093624447;for(lt=0;lt<=31;lt++,wt>>>=1)if(1&wt&&et.dyn_ltree[2*lt]!==0)return s;if(et.dyn_ltree[18]!==0||et.dyn_ltree[20]!==0||et.dyn_ltree[26]!==0)return o;for(lt=32;lt<l;lt++)if(et.dyn_ltree[2*lt]!==0)return o;return s}(x)),Ot(x,x.l_desc),Ot(x,x.d_desc),rt=function(et){var lt;for(h(et,et.dyn_ltree,et.l_desc.max_code),h(et,et.dyn_dtree,et.d_desc.max_code),Ot(et,et.bl_desc),lt=v-1;3<=lt&&et.bl_tree[2*Y[lt]+1]===0;lt--);return et.opt_len+=3*(lt+1)+5+5+4,lt}(x),P=x.opt_len+3+7>>>3,(Q=x.static_len+3+7>>>3)<=P&&(P=Q)):P=Q=Z+5,Z+4<=P&&O!==-1?S(x,O,Z,$):x.strategy===4||Q===P?(st(x,2+($?1:0),3),Lt(x,at,C)):(st(x,4+($?1:0),3),function(et,lt,wt,mt){var Rt;for(st(et,lt-257,5),st(et,wt-1,5),st(et,mt-4,4),Rt=0;Rt<mt;Rt++)st(et,et.bl_tree[2*Y[Rt]+1],3);q(et,et.dyn_ltree,lt-1),q(et,et.dyn_dtree,wt-1)}(x,x.l_desc.max_code+1,x.d_desc.max_code+1,rt+1),Lt(x,x.dyn_ltree,x.dyn_dtree)),gt(x),$&&yt(x)},i._tr_tally=function(x,O,Z){return x.pending_buf[x.d_buf+2*x.last_lit]=O>>>8&255,x.pending_buf[x.d_buf+2*x.last_lit+1]=255&O,x.pending_buf[x.l_buf+x.last_lit]=255&Z,x.last_lit++,O===0?x.dyn_ltree[2*Z]++:(x.matches++,O--,x.dyn_ltree[2*(u[Z]+l+1)]++,x.dyn_dtree[2*M(O)]++),x.last_lit===x.lit_bufsize-1},i._tr_align=function(x){st(x,2,3),it(x,T,at),function(O){O.bi_valid===16?(ct(O,O.bi_buf),O.bi_buf=0,O.bi_valid=0):8<=O.bi_valid&&(O.pending_buf[O.pending++]=255&O.bi_buf,O.bi_buf>>=8,O.bi_valid-=8)}(x)}},{"../utils/common":41}],53:[function(e,n,i){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,n,i){(function(r){(function(s,o){if(!s.setImmediate){var a,c,m,l,b=1,f={},v=!1,d=s.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(s);y=y&&y.setTimeout?y:s,a={}.toString.call(s.process)==="[object process]"?function(A){process.nextTick(function(){E(A)})}:function(){if(s.postMessage&&!s.importScripts){var A=!0,k=s.onmessage;return s.onmessage=function(){A=!1},s.postMessage("","*"),s.onmessage=k,A}}()?(l="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",T,!1):s.attachEvent("onmessage",T),function(A){s.postMessage(l+A,"*")}):s.MessageChannel?((m=new MessageChannel).port1.onmessage=function(A){E(A.data)},function(A){m.port2.postMessage(A)}):d&&"onreadystatechange"in d.createElement("script")?(c=d.documentElement,function(A){var k=d.createElement("script");k.onreadystatechange=function(){E(A),k.onreadystatechange=null,c.removeChild(k),k=null},c.appendChild(k)}):function(A){setTimeout(E,0,A)},y.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var k=new Array(arguments.length-1),z=0;z<k.length;z++)k[z]=arguments[z+1];var D={callback:A,args:k};return f[b]=D,a(b),b++},y.clearImmediate=w}function w(A){delete f[A]}function E(A){if(v)setTimeout(E,0,A);else{var k=f[A];if(k){v=!0;try{(function(z){var D=z.callback,W=z.args;switch(W.length){case 0:D();break;case 1:D(W[0]);break;case 2:D(W[0],W[1]);break;case 3:D(W[0],W[1],W[2]);break;default:D.apply(o,W)}})(k)}finally{w(A),v=!1}}}}function T(A){A.source===s&&typeof A.data=="string"&&A.data.indexOf(l)===0&&E(+A.data.slice(l.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof Pt<"u"?Pt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(fn)),fn.exports}var co=lo();const xi=be(co);class uo extends er{constructor(){super(),this.createInstance()}createInstance(){if(xi)this.instance=new xi;else throw new Error("JSZip lib not loaded")}open(t,e){if(e==="base64"){const n=t.split(",");t=n.length===2?n[1]:t}return this.instance.loadAsync(t,{base64:e==="base64"})}clear(){const t=this.instance.files;Object.keys(t).forEach(e=>this.instance.remove(e))}async openUrl(t,e){return ve(t,"binary").then(n=>this.instance.loadAsync(n,{base64:e}))}get(t){const e=window.decodeURIComponent(t.substring(1));return this.instance.file(e)}async getBlob(t,e){const n=this.get(t);if(n){const i=e||ne.lookup(n.name);return n.async("uint8array").then(r=>new Blob([r],{type:i}))}else return new Promise(i=>{i(null)})}async getText(t){const e=this.get(t);return e?e.async("string").then(n=>n):new Promise(n=>{n(null)})}async getBase64(t,e){const n=this.get(t);if(n){const i=e||ne.lookup(n.name);return n.async("base64").then(r=>"data:"+i+";base64,"+r)}else return new Promise(i=>{i(null)})}}var dn={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/var ki;function fo(){return ki||(ki=1,function(p,t){(function(e){p.exports=e()})(function(){return function e(n,i,r){function s(c,m){if(!i[c]){if(!n[c]){var l=typeof $t=="function"&&$t;if(!m&&l)return l(c,!0);if(o)return o(c,!0);var b=new Error("Cannot find module '"+c+"'");throw b.code="MODULE_NOT_FOUND",b}var f=i[c]={exports:{}};n[c][0].call(f.exports,function(v){var d=n[c][1][v];return s(d||v)},f,f.exports,e,n,i,r)}return i[c].exports}for(var o=typeof $t=="function"&&$t,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(e,n,i){(function(r){var s=r.MutationObserver||r.WebKitMutationObserver,o;if(s){var a=0,c=new s(v),m=r.document.createTextNode("");c.observe(m,{characterData:!0}),o=function(){m.data=a=++a%2}}else if(!r.setImmediate&&typeof r.MessageChannel<"u"){var l=new r.MessageChannel;l.port1.onmessage=v,o=function(){l.port2.postMessage(0)}}else"document"in r&&"onreadystatechange"in r.document.createElement("script")?o=function(){var y=r.document.createElement("script");y.onreadystatechange=function(){v(),y.onreadystatechange=null,y.parentNode.removeChild(y),y=null},r.document.documentElement.appendChild(y)}:o=function(){setTimeout(v,0)};var b,f=[];function v(){b=!0;for(var y,w,E=f.length;E;){for(w=f,f=[],y=-1;++y<E;)w[y]();E=f.length}b=!1}n.exports=d;function d(y){f.push(y)===1&&!b&&o()}}).call(this,typeof Pt<"u"?Pt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(e,n,i){var r=e(1);function s(){}var o={},a=["REJECTED"],c=["FULFILLED"],m=["PENDING"];n.exports=l;function l(k){if(typeof k!="function")throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,k!==s&&d(this,k)}l.prototype.catch=function(k){return this.then(null,k)},l.prototype.then=function(k,z){if(typeof k!="function"&&this.state===c||typeof z!="function"&&this.state===a)return this;var D=new this.constructor(s);if(this.state!==m){var W=this.state===c?k:z;f(D,W,this.outcome)}else this.queue.push(new b(D,k,z));return D};function b(k,z,D){this.promise=k,typeof z=="function"&&(this.onFulfilled=z,this.callFulfilled=this.otherCallFulfilled),typeof D=="function"&&(this.onRejected=D,this.callRejected=this.otherCallRejected)}b.prototype.callFulfilled=function(k){o.resolve(this.promise,k)},b.prototype.otherCallFulfilled=function(k){f(this.promise,this.onFulfilled,k)},b.prototype.callRejected=function(k){o.reject(this.promise,k)},b.prototype.otherCallRejected=function(k){f(this.promise,this.onRejected,k)};function f(k,z,D){r(function(){var W;try{W=z(D)}catch(B){return o.reject(k,B)}W===k?o.reject(k,new TypeError("Cannot resolve promise with itself")):o.resolve(k,W)})}o.resolve=function(k,z){var D=y(v,z);if(D.status==="error")return o.reject(k,D.value);var W=D.value;if(W)d(k,W);else{k.state=c,k.outcome=z;for(var B=-1,Y=k.queue.length;++B<Y;)k.queue[B].callFulfilled(z)}return k},o.reject=function(k,z){k.state=a,k.outcome=z;for(var D=-1,W=k.queue.length;++D<W;)k.queue[D].callRejected(z);return k};function v(k){var z=k&&k.then;if(k&&(typeof k=="object"||typeof k=="function")&&typeof z=="function")return function(){z.apply(k,arguments)}}function d(k,z){var D=!1;function W(C){D||(D=!0,o.reject(k,C))}function B(C){D||(D=!0,o.resolve(k,C))}function Y(){z(B,W)}var at=y(Y);at.status==="error"&&W(at.value)}function y(k,z){var D={};try{D.value=k(z),D.status="success"}catch(W){D.status="error",D.value=W}return D}l.resolve=w;function w(k){return k instanceof this?k:o.resolve(new this(s),k)}l.reject=E;function E(k){var z=new this(s);return o.reject(z,k)}l.all=T;function T(k){var z=this;if(Object.prototype.toString.call(k)!=="[object Array]")return this.reject(new TypeError("must be an array"));var D=k.length,W=!1;if(!D)return this.resolve([]);for(var B=new Array(D),Y=0,at=-1,C=new this(s);++at<D;)j(k[at],at);return C;function j(u,H){z.resolve(u).then(ut,function(G){W||(W=!0,o.reject(C,G))});function ut(G){B[H]=G,++Y===D&&!W&&(W=!0,o.resolve(C,B))}}}l.race=A;function A(k){var z=this;if(Object.prototype.toString.call(k)!=="[object Array]")return this.reject(new TypeError("must be an array"));var D=k.length,W=!1;if(!D)return this.resolve([]);for(var B=-1,Y=new this(s);++B<D;)at(k[B]);return Y;function at(C){z.resolve(C).then(function(j){W||(W=!0,o.resolve(Y,j))},function(j){W||(W=!0,o.reject(Y,j))})}}},{1:1}],3:[function(e,n,i){(function(r){typeof r.Promise!="function"&&(r.Promise=e(2))}).call(this,typeof Pt<"u"?Pt:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(e,n,i){var r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g};function s(g,I){if(!(g instanceof I))throw new TypeError("Cannot call a class as a function")}function o(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var a=o();function c(){try{if(!a||!a.open)return!1;var g=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),I=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!g||I)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function m(g,I){g=g||[],I=I||{};try{return new Blob(g,I)}catch(N){if(N.name!=="TypeError")throw N;for(var _=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,R=new _,L=0;L<g.length;L+=1)R.append(g[L]);return R.getBlob(I.type)}}typeof Promise>"u"&&e(3);var l=Promise;function b(g,I){I&&g.then(function(_){I(null,_)},function(_){I(_)})}function f(g,I,_){typeof I=="function"&&g.then(I),typeof _=="function"&&g.catch(_)}function v(g){return typeof g!="string"&&(console.warn(g+" used as a key, but it is not a string."),g=String(g)),g}function d(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var y="local-forage-detect-blob-support",w=void 0,E={},T=Object.prototype.toString,A="readonly",k="readwrite";function z(g){for(var I=g.length,_=new ArrayBuffer(I),R=new Uint8Array(_),L=0;L<I;L++)R[L]=g.charCodeAt(L);return _}function D(g){return new l(function(I){var _=g.transaction(y,k),R=m([""]);_.objectStore(y).put(R,"key"),_.onabort=function(L){L.preventDefault(),L.stopPropagation(),I(!1)},_.oncomplete=function(){var L=navigator.userAgent.match(/Chrome\/(\d+)/),N=navigator.userAgent.match(/Edge\//);I(N||!L||parseInt(L[1],10)>=43)}}).catch(function(){return!1})}function W(g){return typeof w=="boolean"?l.resolve(w):D(g).then(function(I){return w=I,w})}function B(g){var I=E[g.name],_={};_.promise=new l(function(R,L){_.resolve=R,_.reject=L}),I.deferredOperations.push(_),I.dbReady?I.dbReady=I.dbReady.then(function(){return _.promise}):I.dbReady=_.promise}function Y(g){var I=E[g.name],_=I.deferredOperations.pop();if(_)return _.resolve(),_.promise}function at(g,I){var _=E[g.name],R=_.deferredOperations.pop();if(R)return R.reject(I),R.promise}function C(g,I){return new l(function(_,R){if(E[g.name]=E[g.name]||M(),g.db)if(I)B(g),g.db.close();else return _(g.db);var L=[g.name];I&&L.push(g.version);var N=a.open.apply(a,L);I&&(N.onupgradeneeded=function(V){var X=N.result;try{X.createObjectStore(g.storeName),V.oldVersion<=1&&X.createObjectStore(y)}catch(J){if(J.name==="ConstraintError")console.warn('The database "'+g.name+'" has been upgraded from version '+V.oldVersion+" to version "+V.newVersion+', but the storage "'+g.storeName+'" already exists.');else throw J}}),N.onerror=function(V){V.preventDefault(),R(N.error)},N.onsuccess=function(){var V=N.result;V.onversionchange=function(X){X.target.close()},_(V),Y(g)}})}function j(g){return C(g,!1)}function u(g){return C(g,!0)}function H(g,I){if(!g.db)return!0;var _=!g.db.objectStoreNames.contains(g.storeName),R=g.version<g.db.version,L=g.version>g.db.version;if(R&&(g.version!==I&&console.warn('The database "'+g.name+`" can't be downgraded from version `+g.db.version+" to version "+g.version+"."),g.version=g.db.version),L||_){if(_){var N=g.db.version+1;N>g.version&&(g.version=N)}return!0}return!1}function ut(g){return new l(function(I,_){var R=new FileReader;R.onerror=_,R.onloadend=function(L){var N=btoa(L.target.result||"");I({__local_forage_encoded_blob:!0,data:N,type:g.type})},R.readAsBinaryString(g)})}function G(g){var I=z(atob(g.data));return m([I],{type:g.type})}function dt(g){return g&&g.__local_forage_encoded_blob}function K(g){var I=this,_=I._initReady().then(function(){var R=E[I._dbInfo.name];if(R&&R.dbReady)return R.dbReady});return f(_,g,g),_}function ft(g){B(g);for(var I=E[g.name],_=I.forages,R=0;R<_.length;R++){var L=_[R];L._dbInfo.db&&(L._dbInfo.db.close(),L._dbInfo.db=null)}return g.db=null,j(g).then(function(N){return g.db=N,H(g)?u(g):N}).then(function(N){g.db=I.db=N;for(var V=0;V<_.length;V++)_[V]._dbInfo.db=N}).catch(function(N){throw at(g,N),N})}function F(g,I,_,R){R===void 0&&(R=1);try{var L=g.db.transaction(g.storeName,I);_(null,L)}catch(N){if(R>0&&(!g.db||N.name==="InvalidStateError"||N.name==="NotFoundError"))return l.resolve().then(function(){if(!g.db||N.name==="NotFoundError"&&!g.db.objectStoreNames.contains(g.storeName)&&g.version<=g.db.version)return g.db&&(g.version=g.db.version+1),u(g)}).then(function(){return ft(g).then(function(){F(g,I,_,R-1)})}).catch(_);_(N)}}function M(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function ct(g){var I=this,_={db:null};if(g)for(var R in g)_[R]=g[R];var L=E[_.name];L||(L=M(),E[_.name]=L),L.forages.push(I),I._initReady||(I._initReady=I.ready,I.ready=K);var N=[];function V(){return l.resolve()}for(var X=0;X<L.forages.length;X++){var J=L.forages[X];J!==I&&N.push(J._initReady().catch(V))}var tt=L.forages.slice(0);return l.all(N).then(function(){return _.db=L.db,j(_)}).then(function(nt){return _.db=nt,H(_,I._defaultConfig.version)?u(_):nt}).then(function(nt){_.db=L.db=nt,I._dbInfo=_;for(var ht=0;ht<tt.length;ht++){var pt=tt[ht];pt!==I&&(pt._dbInfo.db=_.db,pt._dbInfo.version=_.version)}})}function st(g,I){var _=this;g=v(g);var R=new l(function(L,N){_.ready().then(function(){F(_._dbInfo,A,function(V,X){if(V)return N(V);try{var J=X.objectStore(_._dbInfo.storeName),tt=J.get(g);tt.onsuccess=function(){var nt=tt.result;nt===void 0&&(nt=null),dt(nt)&&(nt=G(nt)),L(nt)},tt.onerror=function(){N(tt.error)}}catch(nt){N(nt)}})}).catch(N)});return b(R,I),R}function it(g,I){var _=this,R=new l(function(L,N){_.ready().then(function(){F(_._dbInfo,A,function(V,X){if(V)return N(V);try{var J=X.objectStore(_._dbInfo.storeName),tt=J.openCursor(),nt=1;tt.onsuccess=function(){var ht=tt.result;if(ht){var pt=ht.value;dt(pt)&&(pt=G(pt));var bt=g(pt,ht.key,nt++);bt!==void 0?L(bt):ht.continue()}else L()},tt.onerror=function(){N(tt.error)}}catch(ht){N(ht)}})}).catch(N)});return b(R,I),R}function kt(g,I,_){var R=this;g=v(g);var L=new l(function(N,V){var X;R.ready().then(function(){return X=R._dbInfo,T.call(I)==="[object Blob]"?W(X.db).then(function(J){return J?I:ut(I)}):I}).then(function(J){F(R._dbInfo,k,function(tt,nt){if(tt)return V(tt);try{var ht=nt.objectStore(R._dbInfo.storeName);J===null&&(J=void 0);var pt=ht.put(J,g);nt.oncomplete=function(){J===void 0&&(J=null),N(J)},nt.onabort=nt.onerror=function(){var bt=pt.error?pt.error:pt.transaction.error;V(bt)}}catch(bt){V(bt)}})}).catch(V)});return b(L,_),L}function Nt(g,I){var _=this;g=v(g);var R=new l(function(L,N){_.ready().then(function(){F(_._dbInfo,k,function(V,X){if(V)return N(V);try{var J=X.objectStore(_._dbInfo.storeName),tt=J.delete(g);X.oncomplete=function(){L()},X.onerror=function(){N(tt.error)},X.onabort=function(){var nt=tt.error?tt.error:tt.transaction.error;N(nt)}}catch(nt){N(nt)}})}).catch(N)});return b(R,I),R}function gt(g){var I=this,_=new l(function(R,L){I.ready().then(function(){F(I._dbInfo,k,function(N,V){if(N)return L(N);try{var X=V.objectStore(I._dbInfo.storeName),J=X.clear();V.oncomplete=function(){R()},V.onabort=V.onerror=function(){var tt=J.error?J.error:J.transaction.error;L(tt)}}catch(tt){L(tt)}})}).catch(L)});return b(_,g),_}function yt(g){var I=this,_=new l(function(R,L){I.ready().then(function(){F(I._dbInfo,A,function(N,V){if(N)return L(N);try{var X=V.objectStore(I._dbInfo.storeName),J=X.count();J.onsuccess=function(){R(J.result)},J.onerror=function(){L(J.error)}}catch(tt){L(tt)}})}).catch(L)});return b(_,g),_}function It(g,I){var _=this,R=new l(function(L,N){if(g<0){L(null);return}_.ready().then(function(){F(_._dbInfo,A,function(V,X){if(V)return N(V);try{var J=X.objectStore(_._dbInfo.storeName),tt=!1,nt=J.openKeyCursor();nt.onsuccess=function(){var ht=nt.result;if(!ht){L(null);return}g===0||tt?L(ht.key):(tt=!0,ht.advance(g))},nt.onerror=function(){N(nt.error)}}catch(ht){N(ht)}})}).catch(N)});return b(R,I),R}function St(g){var I=this,_=new l(function(R,L){I.ready().then(function(){F(I._dbInfo,A,function(N,V){if(N)return L(N);try{var X=V.objectStore(I._dbInfo.storeName),J=X.openKeyCursor(),tt=[];J.onsuccess=function(){var nt=J.result;if(!nt){R(tt);return}tt.push(nt.key),nt.continue()},J.onerror=function(){L(J.error)}}catch(nt){L(nt)}})}).catch(L)});return b(_,g),_}function Lt(g,I){I=d.apply(this,arguments);var _=this.config();g=typeof g!="function"&&g||{},g.name||(g.name=g.name||_.name,g.storeName=g.storeName||_.storeName);var R=this,L;if(!g.name)L=l.reject("Invalid arguments");else{var N=g.name===_.name&&R._dbInfo.db,V=N?l.resolve(R._dbInfo.db):j(g).then(function(X){var J=E[g.name],tt=J.forages;J.db=X;for(var nt=0;nt<tt.length;nt++)tt[nt]._dbInfo.db=X;return X});g.storeName?L=V.then(function(X){if(X.objectStoreNames.contains(g.storeName)){var J=X.version+1;B(g);var tt=E[g.name],nt=tt.forages;X.close();for(var ht=0;ht<nt.length;ht++){var pt=nt[ht];pt._dbInfo.db=null,pt._dbInfo.version=J}var bt=new l(function(_t,At){var Ct=a.open(g.name,J);Ct.onerror=function(zt){var ae=Ct.result;ae.close(),At(zt)},Ct.onupgradeneeded=function(){var zt=Ct.result;zt.deleteObjectStore(g.storeName)},Ct.onsuccess=function(){var zt=Ct.result;zt.close(),_t(zt)}});return bt.then(function(_t){tt.db=_t;for(var At=0;At<nt.length;At++){var Ct=nt[At];Ct._dbInfo.db=_t,Y(Ct._dbInfo)}}).catch(function(_t){throw(at(g,_t)||l.resolve()).catch(function(){}),_t})}}):L=V.then(function(X){B(g);var J=E[g.name],tt=J.forages;X.close();for(var nt=0;nt<tt.length;nt++){var ht=tt[nt];ht._dbInfo.db=null}var pt=new l(function(bt,_t){var At=a.deleteDatabase(g.name);At.onerror=function(){var Ct=At.result;Ct&&Ct.close(),_t(At.error)},At.onblocked=function(){console.warn('dropInstance blocked for database "'+g.name+'" until all open connections are closed')},At.onsuccess=function(){var Ct=At.result;Ct&&Ct.close(),bt(Ct)}});return pt.then(function(bt){J.db=bt;for(var _t=0;_t<tt.length;_t++){var At=tt[_t];Y(At._dbInfo)}}).catch(function(bt){throw(at(g,bt)||l.resolve()).catch(function(){}),bt})})}return b(L,I),L}var Ot={_driver:"asyncStorage",_initStorage:ct,_support:c(),iterate:it,getItem:st,setItem:kt,removeItem:Nt,clear:gt,length:yt,key:It,keys:St,dropInstance:Lt};function h(){return typeof openDatabase=="function"}var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U="~~local_forage_type~",S=/^~~local_forage_type~([^~]+)~/,x="__lfsc__:",O=x.length,Z="arbf",$="blob",P="si08",Q="ui08",rt="uic8",et="si16",lt="si32",wt="ur16",mt="ui32",Rt="fl32",qt="fl64",Dt=O+Z.length,Ht=Object.prototype.toString;function xt(g){var I=g.length*.75,_=g.length,R,L=0,N,V,X,J;g[g.length-1]==="="&&(I--,g[g.length-2]==="="&&I--);var tt=new ArrayBuffer(I),nt=new Uint8Array(tt);for(R=0;R<_;R+=4)N=q.indexOf(g[R]),V=q.indexOf(g[R+1]),X=q.indexOf(g[R+2]),J=q.indexOf(g[R+3]),nt[L++]=N<<2|V>>4,nt[L++]=(V&15)<<4|X>>2,nt[L++]=(X&3)<<6|J&63;return tt}function Vt(g){var I=new Uint8Array(g),_="",R;for(R=0;R<I.length;R+=3)_+=q[I[R]>>2],_+=q[(I[R]&3)<<4|I[R+1]>>4],_+=q[(I[R+1]&15)<<2|I[R+2]>>6],_+=q[I[R+2]&63];return I.length%3===2?_=_.substring(0,_.length-1)+"=":I.length%3===1&&(_=_.substring(0,_.length-2)+"=="),_}function se(g,I){var _="";if(g&&(_=Ht.call(g)),g&&(_==="[object ArrayBuffer]"||g.buffer&&Ht.call(g.buffer)==="[object ArrayBuffer]")){var R,L=x;g instanceof ArrayBuffer?(R=g,L+=Z):(R=g.buffer,_==="[object Int8Array]"?L+=P:_==="[object Uint8Array]"?L+=Q:_==="[object Uint8ClampedArray]"?L+=rt:_==="[object Int16Array]"?L+=et:_==="[object Uint16Array]"?L+=wt:_==="[object Int32Array]"?L+=lt:_==="[object Uint32Array]"?L+=mt:_==="[object Float32Array]"?L+=Rt:_==="[object Float64Array]"?L+=qt:I(new Error("Failed to get type for BinaryArray"))),I(L+Vt(R))}else if(_==="[object Blob]"){var N=new FileReader;N.onload=function(){var V=U+g.type+"~"+Vt(this.result);I(x+$+V)},N.readAsArrayBuffer(g)}else try{I(JSON.stringify(g))}catch(V){console.error("Couldn't convert value into a JSON string: ",g),I(null,V)}}function jt(g){if(g.substring(0,O)!==x)return JSON.parse(g);var I=g.substring(Dt),_=g.substring(O,Dt),R;if(_===$&&S.test(I)){var L=I.match(S);R=L[1],I=I.substring(L[0].length)}var N=xt(I);switch(_){case Z:return N;case $:return m([N],{type:R});case P:return new Int8Array(N);case Q:return new Uint8Array(N);case rt:return new Uint8ClampedArray(N);case et:return new Int16Array(N);case wt:return new Uint16Array(N);case lt:return new Int32Array(N);case mt:return new Uint32Array(N);case Rt:return new Float32Array(N);case qt:return new Float64Array(N);default:throw new Error("Unkown type: "+_)}}var te={serialize:se,deserialize:jt,stringToBuffer:xt,bufferToString:Vt};function ce(g,I,_,R){g.executeSql("CREATE TABLE IF NOT EXISTS "+I.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],_,R)}function Se(g){var I=this,_={db:null};if(g)for(var R in g)_[R]=typeof g[R]!="string"?g[R].toString():g[R];var L=new l(function(N,V){try{_.db=openDatabase(_.name,String(_.version),_.description,_.size)}catch(X){return V(X)}_.db.transaction(function(X){ce(X,_,function(){I._dbInfo=_,N()},function(J,tt){V(tt)})},V)});return _.serializer=te,L}function Mt(g,I,_,R,L,N){g.executeSql(_,R,L,function(V,X){X.code===X.SYNTAX_ERR?V.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[I.storeName],function(J,tt){tt.rows.length?N(J,X):ce(J,I,function(){J.executeSql(_,R,L,N)},N)},N):N(V,X)},N)}function ue(g,I){var _=this;g=v(g);var R=new l(function(L,N){_.ready().then(function(){var V=_._dbInfo;V.db.transaction(function(X){Mt(X,V,"SELECT * FROM "+V.storeName+" WHERE key = ? LIMIT 1",[g],function(J,tt){var nt=tt.rows.length?tt.rows.item(0).value:null;nt&&(nt=V.serializer.deserialize(nt)),L(nt)},function(J,tt){N(tt)})})}).catch(N)});return b(R,I),R}function Xt(g,I){var _=this,R=new l(function(L,N){_.ready().then(function(){var V=_._dbInfo;V.db.transaction(function(X){Mt(X,V,"SELECT * FROM "+V.storeName,[],function(J,tt){for(var nt=tt.rows,ht=nt.length,pt=0;pt<ht;pt++){var bt=nt.item(pt),_t=bt.value;if(_t&&(_t=V.serializer.deserialize(_t)),_t=g(_t,bt.key,pt+1),_t!==void 0){L(_t);return}}L()},function(J,tt){N(tt)})})}).catch(N)});return b(R,I),R}function Kt(g,I,_,R){var L=this;g=v(g);var N=new l(function(V,X){L.ready().then(function(){I===void 0&&(I=null);var J=I,tt=L._dbInfo;tt.serializer.serialize(I,function(nt,ht){ht?X(ht):tt.db.transaction(function(pt){Mt(pt,tt,"INSERT OR REPLACE INTO "+tt.storeName+" (key, value) VALUES (?, ?)",[g,nt],function(){V(J)},function(bt,_t){X(_t)})},function(pt){if(pt.code===pt.QUOTA_ERR){if(R>0){V(Kt.apply(L,[g,J,_,R-1]));return}X(pt)}})})}).catch(X)});return b(N,_),N}function ir(g,I,_){return Kt.apply(this,[g,I,_,1])}function rr(g,I){var _=this;g=v(g);var R=new l(function(L,N){_.ready().then(function(){var V=_._dbInfo;V.db.transaction(function(X){Mt(X,V,"DELETE FROM "+V.storeName+" WHERE key = ?",[g],function(){L()},function(J,tt){N(tt)})})}).catch(N)});return b(R,I),R}function sr(g){var I=this,_=new l(function(R,L){I.ready().then(function(){var N=I._dbInfo;N.db.transaction(function(V){Mt(V,N,"DELETE FROM "+N.storeName,[],function(){R()},function(X,J){L(J)})})}).catch(L)});return b(_,g),_}function or(g){var I=this,_=new l(function(R,L){I.ready().then(function(){var N=I._dbInfo;N.db.transaction(function(V){Mt(V,N,"SELECT COUNT(key) as c FROM "+N.storeName,[],function(X,J){var tt=J.rows.item(0).c;R(tt)},function(X,J){L(J)})})}).catch(L)});return b(_,g),_}function ar(g,I){var _=this,R=new l(function(L,N){_.ready().then(function(){var V=_._dbInfo;V.db.transaction(function(X){Mt(X,V,"SELECT key FROM "+V.storeName+" WHERE id = ? LIMIT 1",[g+1],function(J,tt){var nt=tt.rows.length?tt.rows.item(0).key:null;L(nt)},function(J,tt){N(tt)})})}).catch(N)});return b(R,I),R}function hr(g){var I=this,_=new l(function(R,L){I.ready().then(function(){var N=I._dbInfo;N.db.transaction(function(V){Mt(V,N,"SELECT key FROM "+N.storeName,[],function(X,J){for(var tt=[],nt=0;nt<J.rows.length;nt++)tt.push(J.rows.item(nt).key);R(tt)},function(X,J){L(J)})})}).catch(L)});return b(_,g),_}function lr(g){return new l(function(I,_){g.transaction(function(R){R.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(L,N){for(var V=[],X=0;X<N.rows.length;X++)V.push(N.rows.item(X).name);I({db:g,storeNames:V})},function(L,N){_(N)})},function(R){_(R)})})}function cr(g,I){I=d.apply(this,arguments);var _=this.config();g=typeof g!="function"&&g||{},g.name||(g.name=g.name||_.name,g.storeName=g.storeName||_.storeName);var R=this,L;return g.name?L=new l(function(N){var V;g.name===_.name?V=R._dbInfo.db:V=openDatabase(g.name,"","",0),g.storeName?N({db:V,storeNames:[g.storeName]}):N(lr(V))}).then(function(N){return new l(function(V,X){N.db.transaction(function(J){function tt(bt){return new l(function(_t,At){J.executeSql("DROP TABLE IF EXISTS "+bt,[],function(){_t()},function(Ct,zt){At(zt)})})}for(var nt=[],ht=0,pt=N.storeNames.length;ht<pt;ht++)nt.push(tt(N.storeNames[ht]));l.all(nt).then(function(){V()}).catch(function(bt){X(bt)})},function(J){X(J)})})}):L=l.reject("Invalid arguments"),b(L,I),L}var ur={_driver:"webSQLStorage",_initStorage:Se,_support:h(),iterate:Xt,getItem:ue,setItem:ir,removeItem:rr,clear:sr,length:or,key:ar,keys:hr,dropInstance:cr};function fr(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function An(g,I){var _=g.name+"/";return g.storeName!==I.storeName&&(_+=g.storeName+"/"),_}function dr(){var g="_localforage_support_test";try{return localStorage.setItem(g,!0),localStorage.removeItem(g),!1}catch{return!0}}function pr(){return!dr()||localStorage.length>0}function mr(g){var I=this,_={};if(g)for(var R in g)_[R]=g[R];return _.keyPrefix=An(g,I._defaultConfig),pr()?(I._dbInfo=_,_.serializer=te,l.resolve()):l.reject()}function gr(g){var I=this,_=I.ready().then(function(){for(var R=I._dbInfo.keyPrefix,L=localStorage.length-1;L>=0;L--){var N=localStorage.key(L);N.indexOf(R)===0&&localStorage.removeItem(N)}});return b(_,g),_}function vr(g,I){var _=this;g=v(g);var R=_.ready().then(function(){var L=_._dbInfo,N=localStorage.getItem(L.keyPrefix+g);return N&&(N=L.serializer.deserialize(N)),N});return b(R,I),R}function yr(g,I){var _=this,R=_.ready().then(function(){for(var L=_._dbInfo,N=L.keyPrefix,V=N.length,X=localStorage.length,J=1,tt=0;tt<X;tt++){var nt=localStorage.key(tt);if(nt.indexOf(N)===0){var ht=localStorage.getItem(nt);if(ht&&(ht=L.serializer.deserialize(ht)),ht=g(ht,nt.substring(V),J++),ht!==void 0)return ht}}});return b(R,I),R}function br(g,I){var _=this,R=_.ready().then(function(){var L=_._dbInfo,N;try{N=localStorage.key(g)}catch{N=null}return N&&(N=N.substring(L.keyPrefix.length)),N});return b(R,I),R}function wr(g){var I=this,_=I.ready().then(function(){for(var R=I._dbInfo,L=localStorage.length,N=[],V=0;V<L;V++){var X=localStorage.key(V);X.indexOf(R.keyPrefix)===0&&N.push(X.substring(R.keyPrefix.length))}return N});return b(_,g),_}function _r(g){var I=this,_=I.keys().then(function(R){return R.length});return b(_,g),_}function Er(g,I){var _=this;g=v(g);var R=_.ready().then(function(){var L=_._dbInfo;localStorage.removeItem(L.keyPrefix+g)});return b(R,I),R}function xr(g,I,_){var R=this;g=v(g);var L=R.ready().then(function(){I===void 0&&(I=null);var N=I;return new l(function(V,X){var J=R._dbInfo;J.serializer.serialize(I,function(tt,nt){if(nt)X(nt);else try{localStorage.setItem(J.keyPrefix+g,tt),V(N)}catch(ht){(ht.name==="QuotaExceededError"||ht.name==="NS_ERROR_DOM_QUOTA_REACHED")&&X(ht),X(ht)}})})});return b(L,_),L}function kr(g,I){if(I=d.apply(this,arguments),g=typeof g!="function"&&g||{},!g.name){var _=this.config();g.name=g.name||_.name,g.storeName=g.storeName||_.storeName}var R=this,L;return g.name?L=new l(function(N){g.storeName?N(An(g,R._defaultConfig)):N(g.name+"/")}).then(function(N){for(var V=localStorage.length-1;V>=0;V--){var X=localStorage.key(V);X.indexOf(N)===0&&localStorage.removeItem(X)}}):L=l.reject("Invalid arguments"),b(L,I),L}var Sr={_driver:"localStorageWrapper",_initStorage:mr,_support:fr(),iterate:yr,getItem:vr,setItem:xr,removeItem:Er,clear:gr,length:_r,key:br,keys:wr,dropInstance:kr},Tr=function(I,_){return I===_||typeof I=="number"&&typeof _=="number"&&isNaN(I)&&isNaN(_)},Cr=function(I,_){for(var R=I.length,L=0;L<R;){if(Tr(I[L],_))return!0;L++}return!1},Nn=Array.isArray||function(g){return Object.prototype.toString.call(g)==="[object Array]"},oe={},Rn={},ee={INDEXEDDB:Ot,WEBSQL:ur,LOCALSTORAGE:Sr},Ir=[ee.INDEXEDDB._driver,ee.WEBSQL._driver,ee.LOCALSTORAGE._driver],fe=["dropInstance"],Te=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(fe),Ar={description:"",driver:Ir.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Nr(g,I){g[I]=function(){var _=arguments;return g.ready().then(function(){return g[I].apply(g,_)})}}function Ce(){for(var g=1;g<arguments.length;g++){var I=arguments[g];if(I)for(var _ in I)I.hasOwnProperty(_)&&(Nn(I[_])?arguments[0][_]=I[_].slice():arguments[0][_]=I[_])}return arguments[0]}var Rr=function(){function g(I){s(this,g);for(var _ in ee)if(ee.hasOwnProperty(_)){var R=ee[_],L=R._driver;this[_]=L,oe[L]||this.defineDriver(R)}this._defaultConfig=Ce({},Ar),this._config=Ce({},this._defaultConfig,I),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return g.prototype.config=function(_){if((typeof _>"u"?"undefined":r(_))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var R in _){if(R==="storeName"&&(_[R]=_[R].replace(/\W/g,"_")),R==="version"&&typeof _[R]!="number")return new Error("Database version must be a number.");this._config[R]=_[R]}return"driver"in _&&_.driver?this.setDriver(this._config.driver):!0}else return typeof _=="string"?this._config[_]:this._config},g.prototype.defineDriver=function(_,R,L){var N=new l(function(V,X){try{var J=_._driver,tt=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!_._driver){X(tt);return}for(var nt=Te.concat("_initStorage"),ht=0,pt=nt.length;ht<pt;ht++){var bt=nt[ht],_t=!Cr(fe,bt);if((_t||_[bt])&&typeof _[bt]!="function"){X(tt);return}}var At=function(){for(var ae=function(Lr){return function(){var zr=new Error("Method "+Lr+" is not implemented by the current driver"),On=l.reject(zr);return b(On,arguments[arguments.length-1]),On}},Ie=0,Dr=fe.length;Ie<Dr;Ie++){var Ae=fe[Ie];_[Ae]||(_[Ae]=ae(Ae))}};At();var Ct=function(ae){oe[J]&&console.info("Redefining LocalForage driver: "+J),oe[J]=_,Rn[J]=ae,V()};"_support"in _?_._support&&typeof _._support=="function"?_._support().then(Ct,X):Ct(!!_._support):Ct(!0)}catch(zt){X(zt)}});return f(N,R,L),N},g.prototype.driver=function(){return this._driver||null},g.prototype.getDriver=function(_,R,L){var N=oe[_]?l.resolve(oe[_]):l.reject(new Error("Driver not found."));return f(N,R,L),N},g.prototype.getSerializer=function(_){var R=l.resolve(te);return f(R,_),R},g.prototype.ready=function(_){var R=this,L=R._driverSet.then(function(){return R._ready===null&&(R._ready=R._initDriver()),R._ready});return f(L,_,_),L},g.prototype.setDriver=function(_,R,L){var N=this;Nn(_)||(_=[_]);var V=this._getSupportedDrivers(_);function X(){N._config.driver=N.driver()}function J(ht){return N._extend(ht),X(),N._ready=N._initStorage(N._config),N._ready}function tt(ht){return function(){var pt=0;function bt(){for(;pt<ht.length;){var _t=ht[pt];return pt++,N._dbInfo=null,N._ready=null,N.getDriver(_t).then(J).catch(bt)}X();var At=new Error("No available storage method found.");return N._driverSet=l.reject(At),N._driverSet}return bt()}}var nt=this._driverSet!==null?this._driverSet.catch(function(){return l.resolve()}):l.resolve();return this._driverSet=nt.then(function(){var ht=V[0];return N._dbInfo=null,N._ready=null,N.getDriver(ht).then(function(pt){N._driver=pt._driver,X(),N._wrapLibraryMethodsWithReady(),N._initDriver=tt(V)})}).catch(function(){X();var ht=new Error("No available storage method found.");return N._driverSet=l.reject(ht),N._driverSet}),f(this._driverSet,R,L),this._driverSet},g.prototype.supports=function(_){return!!Rn[_]},g.prototype._extend=function(_){Ce(this,_)},g.prototype._getSupportedDrivers=function(_){for(var R=[],L=0,N=_.length;L<N;L++){var V=_[L];this.supports(V)&&R.push(V)}return R},g.prototype._wrapLibraryMethodsWithReady=function(){for(var _=0,R=Te.length;_<R;_++)Nr(this,Te[_])},g.prototype.createInstance=function(_){return new g(_)},g}(),Or=new Rr;n.exports=Or},{3:3}]},{},[4])(4)})}(dn)),dn.exports}var po=fo();const Si=be(po);class nr extends er{constructor(t){super(),this.name=t,this.online=window.navigator.onLine}createInstance(){if(Si)this.instance=Si.createInstance({name:this.name}),this.appendListeners();else throw new TypeError("LocalForage lib not loaded")}appendListeners(){window.addEventListener("online",this.status.bind(this)),window.addEventListener("offline",this.status.bind(this))}removeListeners(){window.removeEventListener("online",this.status.bind(this)),window.removeEventListener("offline",this.status.bind(this))}status(t){this.online=t.type==="online",this.online?this.emit("online"):this.emit("offline")}async get(t){const e=this.getKey(t);return this.instance.getItem(e)}async set(t,e){const n=this.getKey(t);return this.instance.setItem(n,e)}async put(t){return this.get(t).then(e=>e||ve(t,"binary").then(n=>this.set(t,n)))}async dispatch(t,e,n,i){if(this.online){const r=[];return r.push(ve(t,e,n,i)),r.push(this.put(t)),Promise.all(r).then(s=>s[0]||null)}else return this.request(t,e)}getKey(t){let e;return typeof t=="string"?e=t:e=`book-${t}`,e}async getBlob(t,e){return this.get(t).then(n=>{if(!n)return null;const i=e||ne.lookup(t);return new Blob([n],{type:i})})}async getText(t,e){return this.get(t).then(n=>{if(!n)return null;const i=new Et,r=new FileReader,s=e||ne.lookup(t),o=new Blob([n],{type:s});return r.onloadend=()=>{i.resolve(r.result)},r.readAsText(o,s),i.promise})}async getBase64(t,e){return this.get(t).then(n=>{if(!n)return null;const i=new Et,r=new FileReader,s=e||ne.lookup(t),o=new Blob([n],{type:s});return r.onloadend=()=>{i.resolve(r.result)},r.readAsDataURL(o,s),i.promise})}destroy(){super.destroy(),this.removeListeners()}}Bt(nr.prototype);class mo{constructor(t,e){this.idref=t.idref,this.linear=t.linear==="yes",this.index=t.index,this.href=t.href,this.url=t.url,this.canonical=t.canonical,this.cfiBase=t.cfiBase,this.next=t.next,this.prev=t.prev,this.properties=t.properties,this.hooks=e,this.document=void 0,this.contents=void 0,this.output=void 0}load(t){const e=new Et;return this.contents?e.resolve(this.contents):t(this.url).then(n=>(this.document=n,this.contents=n.documentElement,this.hooks.content.trigger(this.document,this))).then(()=>{e.resolve(this.contents)}).catch(n=>{e.reject(n)}),e.promise}render(t){const e=new Et;return this.load(t).then(n=>{const i=new XMLSerializer;return this.output=i.serializeToString(n),this.output}).then(()=>this.hooks.serialize.trigger(this.output,this)).then(()=>{e.resolve(this.output)}).catch(n=>{e.reject(n)}),e.promise}find(t){const e=this,n=[],i=t.toLowerCase(),r=s=>{const o=s.textContent.toLowerCase(),a=150;let c,m=-1;for(;c!==-1;){if(c=o.indexOf(i,m+1),c!==-1){const l=e.document.createRange();l.setStart(s,c),l.setEnd(s,c+i.length);const b=e.cfiFromRange(l);let f;s.textContent.length<a?f=s.textContent:(f=s.textContent.substring(c-a/2,c+a/2),f="..."+f+"..."),n.push({cfi:b,excerpt:f})}m=c}};return Bi(e.document,s=>r(s)),n}search(t,e=5){if(typeof document.createTreeWalker>"u")return this.find(t);const n=[],i=150,r=this,s=t.toLowerCase(),o=l=>{const v=l.reduce((d,y)=>d+y.textContent,"").toLowerCase().indexOf(s);if(v!==-1){const y=v+s.length;let w=0,E=0;if(v<l[0].length){for(;w<l.length-1&&(E+=l[w].length,!(y<=E));)w+=1;const T=l[0],A=l[w],k=r.document.createRange();k.setStart(T,v);const z=l.slice(0,w).reduce((B,Y)=>B+Y.textContent.length,0);k.setEnd(A,z>y?y:y-z);const D=r.cfiFromRange(k);let W=l.slice(0,w+1).reduce((B,Y)=>B+Y.textContent,"");W.length>i&&(W=W.substring(v-i/2,v+i/2),W="..."+W+"..."),n.push({cfi:D,excerpt:W})}}},a=document.createTreeWalker(r.document,NodeFilter.SHOW_TEXT,null,!1);let c,m=[];for(;c=a.nextNode();)m.push(c),m.length==e&&(o(m.slice(0,e)),m=m.slice(1,e));return m.length>0&&o(m),n}cfiFromRange(t){return new vt(t,this.cfiBase).toString()}cfiFromElement(t){return new vt(t,this.cfiBase).toString()}unload(){this.document=void 0,this.contents=void 0,this.output=void 0}destroy(){this.unload(),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.idref=void 0,this.linear=void 0,this.properties=void 0,this.index=void 0,this.href=void 0,this.url=void 0,this.next=void 0,this.prev=void 0,this.cfiBase=void 0}}class go extends Map{constructor(){super(),this.hooks={content:new Zt(this),serialize:new Zt(this)},this.hooks.content.register(ti),this.hooks.content.register(ni),this.hooks.content.register(ei),this.points={},this.nav=void 0,this.pkg=void 0}clear(){this.forEach(t=>t.destroy()),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks.content.register(ti),this.hooks.content.register(ni),this.hooks.content.register(ei),this.points={},super.clear()}get(t){let e;if(typeof t>"u")e=this.first();else if(typeof t=="number"&&isNaN(t)===!1)e=[...this.values()][t];else if(typeof t=="string")if(vt.prototype.isCfiString(t)){const i=new vt(t).spinePos;e=[...this.values()][i]}else t.indexOf("#")===0?(e=this.pkg.spine.get(t.substring(1)))&&(e=[...this.values()][e.index]):(e=this.nav.toc.get(t))?e=super.get(e.bind):(t=t.split("#")[0],e=super.get(t));return e||null}first(){return this.points.first||null}last(){return this.points.last||null}unpack(t,e,n,i){this.pkg=t,this.nav=e;const r=t.manifest,s=t.spine,o=e.toc;if(s.forEach((a,c)=>{const m=r.get(c),l={};if(l.cfiBase=vt.prototype.generateChapterComponent(s.nodeIndex,a.index,a.id),m){const f=o.get(m.href);l.bind=f?f.bind:m.href,l.href=m.href,l.url=n(m.href,!0),l.canonical=i(m.href),l.properties=[],m.properties.length&&l.properties.push.apply(l.properties,m.properties)}l.idref=a.idref,l.index=a.index,l.linear=a.linear,l.linear==="yes"?(l.next=()=>{let f=l.index;for(;f<this.size-1;){let v=this.get(f+1);if(v&&v.linear)return v;f+=1}return null},l.prev=()=>{let f=l.index;for(;f>0;){let v=this.get(f-1);if(v&&v.linear)return v;f-=1}return null}):(l.prev=()=>null,l.next=()=>null);const b=new mo(l,this.hooks);this.set(l.bind,b)}),this.size){let a=0;for(;a<this.size;){let c=this.get(a);if(c&&c.linear){this.points.first=c;break}a+=1}}if(this.size){let a=this.size;for(;a>0;){let c=this.get(a-1);if(c&&c.linear){this.points.last=c;break}a-=1}}return Promise.resolve(this)}destroy(){this.clear(),this.hooks=void 0,this.points=void 0,this.nav=void 0,this.pkg=void 0}}const Ti="META-INF/container.xml",vo="META-INF/container.json",Jt={BINARY:"binary",BASE64:"base64",EPUB:"epub",DIRECTORY:"directory"};class In{constructor(t,e){typeof e>"u"&&typeof t!="string"&&!(t instanceof Blob)&&!(t instanceof ArrayBuffer)&&(e=t,t=void 0),this.settings=Ut({canonical:void 0,encoding:void 0,replacements:null,request:{method:void 0,withCredentials:!1,headers:[]},store:null},e||{}),this.request=this.settings.request.method||ve,this.archive=void 0,this.storage=new nr(this.settings.store),this.rendition=void 0,this.container=new ms,this.packaging=new bs,this.resources=new Ns(this.request.bind(this),this.resolve.bind(this),this.settings.replacements),this.sections=new go,this.locations=new Fi(this.sections,this.load.bind(this)),this.navigation=new xs,this.url=void 0,this.settings.store&&this.storage.createInstance(),t&&this.open(t).catch(n=>{this.emit(ot.BOOK.OPEN_FAILED,n)})}init(){this.archived=!1,this.cover=null,this.path=void 0,this.isOpen=!1,this.opening=new Et,this.opened=this.opening.promise,this.loading={packaging:new Et,resources:new Et,navigation:new Et,sections:new Et,cover:new Et},this.loaded={packaging:this.loading.packaging.promise,resources:this.loading.resources.promise,navigation:this.loading.navigation.promise,sections:this.loading.sections.promise,cover:this.loading.cover.promise}}clear(){this.container.clear(),this.packaging.clear(),this.resources.clear(),this.navigation.clear(),this.sections.clear(),this.locations.clear(),this.archive&&this.archive.clear()}async open(t,e){this.init();const n=e||this.determineType(t);this.settings.store&&this.store(t);let i;if(n===Jt.BINARY)this.archived=!0,this.url=new Qt("/",""),i=this.openEpub(t);else if(n===Jt.BASE64)this.archived=!0,this.url=new Qt("/",""),i=this.openEpub(t,n);else if(n===Jt.EPUB)this.archived=!0,this.url=new Qt("/",""),i=this.request(t,"binary",this.settings.request.withCredentials,this.settings.request.headers).then(this.openEpub.bind(this));else{this.url=new Qt(t);let r;this.settings.format==="json"?r=vo:r=Ti,i=this.openContainer(r,n)}return i}async openEpub(t,e){const n=e||this.settings.encoding;return this.unarchive(t,n).then(()=>this.openContainer(Ti))}async openContainer(t){return this.load(t).then(e=>this.settings.format==="json"?this.container.load(e):this.container.parse(e)).then(e=>{const n=this.resolve(e.fullPath);return this.openPackaging(n)})}async openPackaging(t){return this.path=new Yt(t),this.load(t).then(e=>this.settings.format==="json"?this.packaging.load(e):this.packaging.parse(e)).then(()=>this.loadNavigation()).then(()=>this.unpack())}load(t,e=null){const n=this.resolve(t);return this.archived?this.archive.request(n):this.request(n,e,this.settings.request.withCredentials,this.settings.request.headers)}resolve(t,e=!1){if(!t)return;if(t.indexOf("://")>-1)return t;let n=t;return this.path&&(n=this.path.resolve(this.path.directory,t)),e===!1&&this.url&&(n=this.url.resolve(n)),n}canonical(t){if(!t)return"";let e;return this.settings.canonical?e=this.settings.canonical(t):e=this.resolve(t,!0),e}determineType(t){if(this.settings.encoding==="base64")return Jt.BASE64;if(typeof t!="string")return Jt.BINARY;let n=new Qt(t).path.extension;return n&&(n=n.replace(/\?.*$/,"")),n==="epub"?Jt.EPUB:Jt.DIRECTORY}async unpack(){this.loading.packaging.resolve(this.packaging),this.loading.navigation.resolve(this.navigation),this.resources.unpack(this.packaging.manifest,this.archive,this.storage).then(e=>{this.loading.resources.resolve(e)}),this.sections.unpack(this.packaging,this.navigation,this.resolve.bind(this),this.canonical.bind(this)).then(e=>{this.loading.sections.resolve(e)}),this.resources.replacements&&this.sections.hooks.serialize.register(this.resources.substitute.bind(this.resources)),this.packaging.manifest.coverPath&&(this.cover=this.resolve(this.packaging.manifest.coverPath)),this.loading.cover.resolve(this.cover);const t=[...Object.values(this.loaded)];return Promise.all(t).then(()=>(this.isOpen=!0,this.opening.resolve(this),this.opened))}async loadNavigation(){const t=this.packaging.manifest.navPath;return t?this.load(t).then(e=>this.settings.format==="json"?this.navigation.load(e):this.navigation.parse(e)):Promise.resolve(this.navigation)}section(t){return this.sections.get(t)}renderTo(t,e){const n="blobUrl";return this.settings.replacements===n&&(e=Ut({method:n},e||{})),this.rendition=new Cn(this,e),this.rendition.attachTo(t),this.rendition}setRequestCredentials(t){this.settings.request.withCredentials=t}setRequestHeaders(t){this.settings.request.headers=t}unarchive(t,e){return this.archive=new uo,this.archive.open(t,e)}store(t){typeof t=="string"&&(this.request=this.storage.dispatch.bind(this.storage))}async coverUrl(){return this.loaded.cover.then(()=>this.archived&&this.cover?this.resources.createUrl(this.cover):this.cover)}async getRange(t){const e=new vt(t),n=this.sections.get(e.spinePos),i=this.load.bind(this);return n?n.load(i).then(r=>e.toRange(n.document)):new Promise((r,s)=>{s(new Error("CFI could not be found"))})}key(t){const e=t||this.packaging.metadata.get("identifier")||this.url.filename;return`epubjs:${Ee}:${e}`}destroy(){this.isOpen=void 0,this.opened=void 0,this.loaded=void 0,this.opening=void 0,this.loading=void 0,this.archive&&this.archive.destroy(),this.storage&&this.storage.destroy(),this.sections&&this.sections.destroy(),this.locations&&this.locations.destroy(),this.resources&&this.resources.destroy(),this.container&&this.container.destroy(),this.packaging&&this.packaging.destroy(),this.rendition&&this.rendition.destroy(),this.navigation&&this.navigation.destroy(),this.archive=void 0,this.storage=void 0,this.archived=void 0,this.sections=void 0,this.locations=void 0,this.resources=void 0,this.container=void 0,this.packaging=void 0,this.rendition=void 0,this.navigation=void 0,this.url=void 0,this.path=void 0,this.cover=void 0,this.request=void 0,this.settings=void 0}}Bt(In.prototype);function Wt(p,t){return new In(p,t)}Wt.VERSION=Ee;typeof global<"u"&&(global.EPUBJS_VERSION=Ee);Wt.Book=In;Wt.Rendition=Cn;Wt.Contents=xe;Wt.EpubCFI=vt;Wt.manager=p=>{let t;switch(p){default:t=ke;break;case"continuous":t=Ji;break}return t};Wt.view=p=>{let t;switch(p){default:t=Zi;break;case"inline":t=Yi;break}return t};Wt.utils=ds;let Ci=Wt({}),ye,Ii;console.log("epubView file loaded");window.loadBook=async function(p){let t=new Uint8Array(p);await Ci.open(t),ye=Ci.renderTo("reader",{height:"100%",manager:"default",sandbox:["allow-same-origin","allow-scripts"]}),Ii=ye.display(),Ii.then(()=>{EpubChannel.postMessage("Book loaded")})};window.nextPage=function(){ye.next()};window.previousPage=function(){ye.prev()};</script>
  </head>
  <body>
    <div id="reader"></div>
  </body>
</html>
